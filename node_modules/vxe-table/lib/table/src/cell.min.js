"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Cell=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools"),_utils=require("../../tools/src/utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function ownKeys(l,e){var r,t=Object.keys(l);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(l),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(l,e).enumerable})),t.push.apply(t,r)),t}function _objectSpread(l){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(l,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(l,e,Object.getOwnPropertyDescriptor(r,e))})}return l}function _defineProperty(e,l,r){return l in e?Object.defineProperty(e,l,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[l]=r,e}function renderHelpIcon(e,l){var r=l.$table,t=l.column.titleHelp;return t?[e("i",{class:["vxe-cell-help-icon",t.icon||_conf.default.icon.TABLE_HELP],on:{mouseenter:function(e){r.triggerHeaderHelpEvent(e,l)},mouseleave:function(e){r.handleTargetLeaveEvent(e)}}})]:[]}function renderTitleContent(e,l,r){var t=l.$table,n=l.column,o=n.type,c=n.showHeaderOverflow,i=t.showHeaderOverflow,a=t.tooltipOpts,d=a.showAll||a.enabled,c=_xeUtils.default.isUndefined(c)||_xeUtils.default.isNull(c)?i:c,s="title"===c,u=!0===c||"tooltip"===c,c={};return(s||u||d)&&(c.mouseenter=function(e){t._isResize||(s?_tools.DomTools.updateCellTitle(e.currentTarget,n):(u||d)&&t.triggerHeaderTooltipEvent(e,l))}),(u||d)&&(c.mouseleave=function(e){t._isResize||(u||d)&&t.handleTargetLeaveEvent(e)}),["html"===o&&_xeUtils.default.isString(r)?e("span",{class:"vxe-cell--title",domProps:{innerHTML:r},on:c}):e("span",{class:"vxe-cell--title",on:c},r)]}function getFooterContent(e,l){var r=l.$table,t=l.column,n=l._columnIndex,o=l.items,c=t.slots,i=t.editRender,t=t.cellRender,t=i||t;if(c&&c.footer)return r.callSlot(c.footer,l,e);if(t){c=_vXETable.default.renderer.get(t.name);if(c&&c.renderFooter)return c.renderFooter.call(r,e,t,l)}return[_tools.UtilTools.formatText(o[n],1)]}function getDefaultCellLabel(e){var l=e.$table,r=e.row,e=e.column;return _tools.UtilTools.formatText(l.getCellLabel(r,e),1)}var Cell={createColumn:function(e,l){var r=l.type,t=l.sortable,n=l.remoteSort,o=l.filters,c=l.editRender,i=l.treeNode,a=e.editConfig,d=e.editOpts,s=e.checkboxOpts,u={renderHeader:this.renderDefaultHeader,renderCell:i?this.renderTreeCell:this.renderDefaultCell,renderFooter:this.renderDefaultFooter};switch(r){case"seq":u.renderHeader=this.renderIndexHeader,u.renderCell=i?this.renderTreeIndexCell:this.renderIndexCell;break;case"radio":u.renderHeader=this.renderRadioHeader,u.renderCell=i?this.renderTreeRadioCell:this.renderRadioCell;break;case"checkbox":u.renderHeader=this.renderSelectionHeader,u.renderCell=s.checkField?i?this.renderTreeSelectionCellByProp:this.renderSelectionCellByProp:i?this.renderTreeSelectionCell:this.renderSelectionCell;break;case"expand":u.renderCell=this.renderExpandCell,u.renderData=this.renderExpandData;break;case"html":u.renderCell=i?this.renderTreeHTMLCell:this.renderHTMLCell,o&&(t||n)?u.renderHeader=this.renderSortAndFilterHeader:t||n?u.renderHeader=this.renderSortHeader:o&&(u.renderHeader=this.renderFilterHeader);break;default:a&&c?(u.renderHeader=this.renderEditHeader,u.renderCell="cell"===d.mode?i?this.renderTreeCellEdit:this.renderCellEdit:i?this.renderTreeRowEdit:this.renderRowEdit):o&&(t||n)?u.renderHeader=this.renderSortAndFilterHeader:t||n?u.renderHeader=this.renderSortHeader:o&&(u.renderHeader=this.renderFilterHeader)}return _tools.UtilTools.getColumnConfig(e,l,u)},renderHeaderTitle:function(e,l){var r=l.$table,t=l.column,n=t.slots,o=t.editRender,c=t.cellRender,c=o||c;if(n&&n.header)return renderTitleContent(e,l,r.callSlot(n.header,l,e));if(c){n=_vXETable.default.renderer.get(c.name);if(n&&n.renderHeader)return renderTitleContent(e,l,n.renderHeader.call(r,e,c,l))}return renderTitleContent(e,l,_tools.UtilTools.formatText(t.getTitle(),1))},renderDefaultHeader:function(e,l){return renderHelpIcon(e,l).concat(Cell.renderHeaderTitle(e,l))},renderDefaultCell:function(e,l){var r=l.$table,t=l.row,n=l.column,o=n.slots,c=n.editRender,i=n.cellRender,a=c||i;if(o&&o.default)return r.callSlot(o.default,l,e);if(a){i=c?"renderCell":"renderDefault",o=_vXETable.default.renderer.get(a.name);if(o&&o[i])return o[i].call(r,e,a,Object.assign({$type:c?"edit":"cell"},l))}t=r.getCellLabel(t,n),n=c?c.placeholder:"";return[e("span",{class:"vxe-cell--label"},c&&(0,_utils.eqEmptyValue)(t)?[e("span",{class:"vxe-cell--placeholder"},_tools.UtilTools.formatText(_tools.UtilTools.getFuncText(n),1))]:_tools.UtilTools.formatText(t,1))]},renderTreeCell:function(e,l){return Cell.renderTreeIcon(e,l,Cell.renderDefaultCell.call(this,e,l))},renderDefaultFooter:function(e,l){return[e("span",{class:"vxe-cell--item"},getFooterContent(e,l))]},renderTreeIcon:function(e,l,r){var t=l.$table,n=l.isHidden,o=t.treeOpts,c=t.treeExpandeds,i=t.treeLazyLoadeds,a=l.row,d=l.column,s=l.level,u=d.slots,f=o.children,x=o.hasChild,b=o.indent,h=o.lazy,v=o.trigger,p=o.iconLoaded,C=o.showIcon,T=o.iconOpen,_=o.iconClose,E=a[f],m=!1,d=!1,o=!1,f={};return u&&u.icon?t.callSlot(u.icon,l,e,r):(n||(d=-1<c.indexOf(a),h&&(o=-1<i.indexOf(a),m=a[x])),v&&"default"!==v||(f.click=function(e){return t.triggerTreeExpandEvent(e,l)}),[e("div",{class:["vxe-cell--tree-node",{"is--active":d}],style:{paddingLeft:"".concat(s*b,"px")}},[C&&(E&&E.length||m)?[e("div",{class:"vxe-tree--btn-wrapper",on:f},[e("i",{class:["vxe-tree--node-btn",o?p||_conf.default.icon.TABLE_TREE_LOADED:d?T||_conf.default.icon.TABLE_TREE_OPEN:_||_conf.default.icon.TABLE_TREE_CLOSE]})])]:null,e("div",{class:"vxe-tree-cell"},r)])])},renderIndexHeader:function(e,l){var r=l.$table,t=l.column,n=t.slots;return renderTitleContent(e,l,n&&n.header?r.callSlot(n.header,l,e):_tools.UtilTools.formatText(t.getTitle(),1))},renderIndexCell:function(e,l){var r=l.$table,t=l.column,n=r.seqOpts,o=t.slots;if(o&&o.default)return r.callSlot(o.default,l,e);t=l.$seq,r=l.seq,o=l.level,e=n.seqMethod;return[_tools.UtilTools.formatText(e?e(l):o?"".concat(t,".").concat(r):n.startIndex+r,1)]},renderTreeIndexCell:function(e,l){return Cell.renderTreeIcon(e,l,Cell.renderIndexCell(e,l))},renderRadioHeader:function(e,l){var r=l.$table,t=l.column,n=t.slots,o=n?n.header:null,n=n?n.title:null;return renderTitleContent(e,l,o?r.callSlot(o,l,e):[e("span",{class:"vxe-radio--label"},n?r.callSlot(n,l,e):_tools.UtilTools.formatText(t.getTitle(),1))])},renderRadioCell:function(e,l){var r,t=l.$table,n=l.column,o=l.isHidden,c=t.radioOpts,i=t.selectRow,a=n.slots,d=c.labelField,s=c.checkMethod,n=l.row,c=a?a.default:null,a=a?a.radio:null,i=n===i,u=!!s;o||(r={click:function(e){u||t.triggerRadioRowEvent(e,l)}},s&&(u=!s({row:n})));s=_objectSpread(_objectSpread({},l),{},{checked:i,disabled:u});return a?t.callSlot(a,s,e):[e("span",{class:["vxe-cell--radio",{"is--checked":i,"is--disabled":u}],on:r},[e("span",{class:"vxe-radio--icon vxe-radio--checked-icon"}),e("span",{class:"vxe-radio--icon vxe-radio--unchecked-icon"})].concat(c||d?[e("span",{class:"vxe-radio--label"},c?t.callSlot(c,s,e):_xeUtils.default.get(n,d))]:[]))]},renderTreeRadioCell:function(e,l){return Cell.renderTreeIcon(e,l,Cell.renderRadioCell(e,l))},renderSelectionHeader:function(e,l){var r,t=l.$table,n=l.column,o=l.isHidden,c=t.isIndeterminate,i=t.isAllCheckboxDisabled,a=n.slots,d=a?a.header:null,s=a?a.title:null,a=t.checkboxOpts,n=n.getTitle(),u=!1;o||(u=!i&&t.isAllSelected,r={click:function(e){i||t.triggerCheckAllEvent(e,!u)}});l=_objectSpread(_objectSpread({},l),{},{checked:u,disabled:i,indeterminate:c});return d?renderTitleContent(e,l,t.callSlot(d,l,e)):(a.checkStrictly?a.showHeader:!1!==a.showHeader)?renderTitleContent(e,l,[e("span",{class:["vxe-cell--checkbox",{"is--checked":u,"is--disabled":i,"is--indeterminate":c}],attrs:{title:_conf.default.i18n("vxe.table.allTitle")},on:r},[e("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"})].concat(s||n?[e("span",{class:"vxe-checkbox--label"},s?t.callSlot(s,l,e):n)]:[]))]):renderTitleContent(e,l,[e("span",{class:"vxe-checkbox--label"},s?t.callSlot(s,l,e):n)])},renderSelectionCell:function(e,l){var r,t=l.$table,n=l.row,o=l.column,c=l.isHidden,i=t.treeConfig,a=t.treeIndeterminates,d=t.checkboxOpts,s=d.labelField,u=d.checkMethod,f=o.slots,d=f?f.default:null,o=f?f.checkbox:null,f=!1,x=!1,b=!!u;c||(x=-1<t.selection.indexOf(n),r={click:function(e){b||t.triggerCheckRowEvent(e,l,!x)}},u&&(b=!u({row:n})),i&&(f=-1<a.indexOf(n)));a=_objectSpread(_objectSpread({},l),{},{checked:x,disabled:b,indeterminate:f});return o?t.callSlot(o,a,e):[e("span",{class:["vxe-cell--checkbox",{"is--checked":x,"is--disabled":b,"is--indeterminate":f}],on:r},[e("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"})].concat(d||s?[e("span",{class:"vxe-checkbox--label"},d?t.callSlot(d,a,e):_xeUtils.default.get(n,s))]:[]))]},renderTreeSelectionCell:function(e,l){return Cell.renderTreeIcon(e,l,Cell.renderSelectionCell(e,l))},renderSelectionCellByProp:function(e,l){var r,t=l.$table,n=l.row,o=l.column,c=l.isHidden,i=t.treeConfig,a=t.treeIndeterminates,d=t.checkboxOpts,s=d.labelField,u=d.checkField,f=d.halfField,x=d.checkMethod,b=o.slots,d=b?b.default:null,o=b?b.checkbox:null,b=!1,h=!1,v=!!x;c||(h=_xeUtils.default.get(n,u),r={click:function(e){v||t.triggerCheckRowEvent(e,l,!h)}},x&&(v=!x({row:n})),i&&(b=-1<a.indexOf(n)));a=_objectSpread(_objectSpread({},l),{},{checked:h,disabled:v,indeterminate:b});return o?t.callSlot(o,a,e):[e("span",{class:["vxe-cell--checkbox",{"is--checked":h,"is--disabled":v,"is--indeterminate":f&&!h?n[f]:b}],on:r},[e("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),e("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"})].concat(d||s?[e("span",{class:"vxe-checkbox--label"},d?t.callSlot(d,a,e):_xeUtils.default.get(n,s))]:[]))]},renderTreeSelectionCellByProp:function(e,l){return Cell.renderTreeIcon(e,l,Cell.renderSelectionCellByProp(e,l))},renderExpandCell:function(e,l){var r=l.$table,t=l.isHidden,n=l.row,o=l.column,c=r.expandOpts,i=r.rowExpandeds,a=r.expandLazyLoadeds,d=c.lazy,s=c.labelField,u=c.iconLoaded,f=c.showIcon,x=c.iconOpen,b=c.iconClose,h=c.visibleMethod,v=o.slots,p=v?v.default:null,c=!1,o=!1;return v&&v.icon?r.callSlot(v.icon,l,e):(t||(c=-1<i.indexOf(l.row),d&&(o=-1<a.indexOf(n))),[!f||h&&!h(l)?null:e("span",{class:["vxe-table--expanded",{"is--active":c}],on:{click:function(e){r.triggerRowExpandEvent(e,l)}}},[e("i",{class:["vxe-table--expand-btn",o?u||_conf.default.icon.TABLE_EXPAND_LOADED:c?x||_conf.default.icon.TABLE_EXPAND_OPEN:b||_conf.default.icon.TABLE_EXPAND_CLOSE]})]),p||s?e("span",{class:"vxe-table--expand-label"},p?r.callSlot(p,l,e):_xeUtils.default.get(n,s)):null])},renderExpandData:function(e,l){var r=l.$table,t=l.column,n=t.slots,t=t.contentRender;if(n&&n.content)return r.callSlot(n.content,l,e);if(t){n=_vXETable.default.renderer.get(t.name);if(n&&n.renderExpand)return n.renderExpand.call(r,e,t,l)}return[]},renderHTMLCell:function(e,l){var r=l.$table,t=l.column.slots;return t&&t.default?r.callSlot(t.default,l,e):[e("span",{class:"vxe-cell--html",domProps:{innerHTML:getDefaultCellLabel(l)}})]},renderTreeHTMLCell:function(e,l){return Cell.renderTreeIcon(e,l,Cell.renderHTMLCell(e,l))},renderSortAndFilterHeader:function(e,l){return Cell.renderDefaultHeader(e,l).concat(Cell.renderSortIcon(e,l)).concat(Cell.renderFilterIcon(e,l))},renderSortHeader:function(e,l){return Cell.renderDefaultHeader(e,l).concat(Cell.renderSortIcon(e,l))},renderSortIcon:function(e,l){var r=l.$table,t=l.column,n=r.sortOpts,o=n.showIcon,l=n.iconAsc,n=n.iconDesc;return o?[e("span",{class:"vxe-cell--sort"},[e("i",{class:["vxe-sort--asc-btn",l||_conf.default.icon.TABLE_SORT_ASC,{"sort--active":"asc"===t.order}],attrs:{title:_conf.default.i18n("vxe.table.sortAsc")},on:{click:function(e){r.triggerSortEvent(e,t,"asc")}}}),e("i",{class:["vxe-sort--desc-btn",n||_conf.default.icon.TABLE_SORT_DESC,{"sort--active":"desc"===t.order}],attrs:{title:_conf.default.i18n("vxe.table.sortDesc")},on:{click:function(e){r.triggerSortEvent(e,t,"desc")}}})])]:[]},renderFilterHeader:function(e,l){return Cell.renderDefaultHeader(e,l).concat(Cell.renderFilterIcon(e,l))},renderFilterIcon:function(e,l){var r=l.$table,t=l.column,n=l.hasFilter,o=r.filterStore,c=r.filterOpts,i=c.showIcon,a=c.iconNone,c=c.iconMatch;return i?[e("span",{class:["vxe-cell--filter",{"is--active":o.visible&&o.column===t}]},[e("i",{class:["vxe-filter--btn",n?c||_conf.default.icon.TABLE_FILTER_MATCH:a||_conf.default.icon.TABLE_FILTER_NONE],attrs:{title:_conf.default.i18n("vxe.table.filter")},on:{click:function(e){r.triggerFilterEvent(e,l.column,l)}}})])]:[]},renderEditHeader:function(e,l){var r=l.$table,t=l.column,n=r.editConfig,o=r.editRules,c=r.editOpts,i=t.sortable,a=t.remoteSort,d=t.filters,r=t.editRender,t=!1;return!o||(o=_xeUtils.default.get(o,l.column.property))&&(t=o.some(function(e){return e.required})),((0,_utils.isEnableConf)(n)?[t&&c.showAsterisk?e("i",{class:"vxe-cell--required-icon"}):null,(0,_utils.isEnableConf)(r)&&c.showIcon?e("i",{class:["vxe-cell--edit-icon",c.icon||_conf.default.icon.TABLE_EDIT]}):null]:[]).concat(Cell.renderDefaultHeader(e,l)).concat(i||a?Cell.renderSortIcon(e,l):[]).concat(d?Cell.renderFilterIcon(e,l):[])},renderRowEdit:function(e,l){var r=l.$table,t=l.column.editRender,r=r.editStore.actived;return Cell.runRenderer(e,l,this,(0,_utils.isEnableConf)(t)&&r&&r.row===l.row)},renderTreeRowEdit:function(e,l){return Cell.renderTreeIcon(e,l,Cell.renderRowEdit(e,l))},renderCellEdit:function(e,l){var r=l.$table,t=l.column.editRender,r=r.editStore.actived;return Cell.runRenderer(e,l,this,(0,_utils.isEnableConf)(t)&&r&&r.row===l.row&&r.column===l.column)},renderTreeCellEdit:function(e,l){return Cell.renderTreeIcon(e,l,Cell.renderCellEdit(e,l))},runRenderer:function(e,l,r,t){var n=l.$table,o=l.column,c=o.slots,i=o.editRender,a=o.formatter,o=_vXETable.default.renderer.get(i.name);return t?c&&c.edit?n.callSlot(c.edit,l,e):o&&o.renderEdit?o.renderEdit.call(n,e,i,Object.assign({$type:"edit"},l)):[]:c&&c.default?n.callSlot(c.default,l,e):a?[e("span",{class:"vxe-cell--label"},[getDefaultCellLabel(l)])]:Cell.renderDefaultCell.call(r,e,l)}},_default=exports.Cell=Cell;exports.default=Cell;