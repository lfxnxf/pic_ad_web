{"remainingRequest":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhang/canteen_manage/src/views/statistics/stat-order/components/form.vue?vue&type=style&index=0&id=51e3afe5&lang=less&scoped=true&","dependencies":[{"path":"/Users/zhang/canteen_manage/src/views/statistics/stat-order/components/form.vue","mtime":1638355006817},{"path":"/Users/zhang/canteen_manage/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouY2FyZHsKICBwYWRkaW5nLWJvdHRvbTogMCAhaW1wb3J0YW50OwogIC8vIG1pbi1oZWlnaHQ6IDc2cHg7CiAgLy8gbWF4LWhlaWdodDogMTMzcHg7Cn0KCg=="},{"version":3,"sources":["form.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgLA;AACA;AACA;AACA;AACA","file":"form.vue","sourceRoot":"src/views/statistics/stat-order/components","sourcesContent":["<!-- 就餐统计数据 -->\n<template>\n  <div class=\"card\">\n    <Form inline ref=\"form\" :model=\"form\" label-colon>\n      <FormItem label=\"汇总方式\">\n        <RadioGroup v-model=\"form.unit\">\n          <Radio label=\"day\">按日期</Radio>\n          <Radio label=\"month\">按月</Radio>\n        </RadioGroup>\n      </FormItem>\n      <FormItem label=\"汇总日期起止\" v-if=\"form.unit == 'day'\">\n        <DatePicker @keyup.enter.native=\"queryStat()\" v-model=\"form.date\" type=\"daterange\" format=\"yyyy/MM/dd\" placeholder=\"汇总日期起止\" style=\"width: 200px\"></DatePicker>\n        <Input type=\"text\" v-show=\"false\" style=\"width: 1px;\"/>\n      </FormItem>\n      <FormItem label=\"汇总月份起止\" v-if=\"form.unit == 'month'\">\n        <DatePicker class=\"margin-right-5\" @keyup.enter.native=\"queryStat()\" v-model=\"form.startMonth\" type=\"month\" format=\"yyyy-MM\" placeholder=\"汇总月份起\" style=\"width:100px\"></DatePicker>-\n        <DatePicker @keyup.enter.native=\"queryStat()\" v-model=\"form.endMonth\" type=\"month\" format=\"yyyy-MM\" placeholder=\"汇总月份止\" style=\"width:100px\"></DatePicker>\n      </FormItem>\n      <FormItem>\n        <Select placeholder=\"用餐时段\" @keyup.enter.native=\"queryStat()\" v-model=\"form.time_type\"  style=\"min-width: 110px;\">\n          <Option value=\"-1\" >全部时段</Option>\n          <Option :disabled=\"form.time_type=='-1'\" value=\"breakfast\">早餐</Option>\n          <Option :disabled=\"form.time_type=='-1'\" value=\"nooning\">午餐</Option>\n          <Option :disabled=\"form.time_type=='-1'\" value=\"dinner\">晚餐</Option>\n        </Select>\n      </FormItem>\n      <FormItem>\n        <Button type='primary' icon=\"md-search\" @click=\"queryStat()\">查询</Button>\n        <Button class=\"margin-left-10\" type='primary' ghost icon=\"md-download\" @click=\"exportDinner\">导出EXCEL</Button>\n      </FormItem>\n\n    </Form>\n  </div>\n</template>\n<script>\nimport _ from 'underscore';\nimport moment from \"moment-timezone\";\n\nexport default {\n  name: 'searchForm',\n  data() {\n    return {\n      form: {\n        date: [moment().format('YYYY-MM-DD'), moment().format('YYYY-MM-DD')],\n        unit: 'day',\n        startMonth: moment().format('YYYY-MM'),\n        endMonth: moment().format('YYYY-MM'),\n        time_type: [],\n      },\n      export_excel_params: {},\n    };\n  },\n\n  computed: {\n    resultForm(){\n      let data = {\n        unit: this.form.unit,\n        time_type: this.form.time_type[0]=='-1'? '':this.form.time_type.toString(),\n        start: moment(this.form.date[0]).format('YYYY-MM-DD'),\n        end: moment(this.form.date[1]).format('YYYY-MM-DD'),\n      }\n\n      if (this.form.unit == 'month'){\n        data.start = moment(this.form.startMonth).format('YYYY-MM');\n        data.end = moment(this.form.endMonth).format('YYYY-MM');\n      }\n      return data;\n    },\n\n  },\n\n  methods: {\n\n    queryStat: async function(page) {\n      this.$store.commit('TABLE_LOADING', true);\n      let startDate = this.resultForm.start || '';\n      let endDate = this.resultForm.end || '';\n      if (startDate == '' || startDate == 'Invalid date' || endDate == '' || endDate == 'Invalid date'){\n        this.$Message.error(\"请选择就餐统计日期起止！\");\n        return;\n      }\n      this.$emit('getDate', this.resultForm);\n      // // this.$store.commit('setEmployeeListLoading', true);\n      let params = {\n        merchant_id: this.$store.state.user.curMerchantId,\n        sessionid: this.$store.state.user.token,\n        page: page || 1,\n        page_size: this.$parent.page_size,\n        ...this.resultForm\n      };\n      console.log(\"queryStat===params>>>\" + JSON.stringify(params));\n      let res = this.$store.dispatch('statisticsOrder', params);\n      console.log(\"queryStat===res>>>\" + JSON.stringify(res));\n      this.$refs['form'].resetFields();\n    },\n\n    exportDinner: async function() {\n      let fileName = '就餐列表';\n      this.$store.commit('TABLE_LOADING', true);\n      let startDate = this.resultForm.start_date || '';\n      let endDate = this.resultForm.end_date || '';\n      if (startDate == '' || startDate == 'Invalid date' || endDate == '' || endDate == 'Invalid date'){\n        this.$Message.error(\"请选择就餐统计日期起止！\");\n        return;\n      }\n      // this.$emit('getDate', this.resultForm);\n      let params = {\n        merchant_id: this.$store.state.user.curMerchantId,\n        ...this.resultForm\n      };\n      let queryArray = params.departments || '';\n      if (queryArray !== ''){\n        let stringResult = queryArray.split(',');\n        let departArray = buildChildDepartmentArray(stringResult,this.$store.state.user.departmentList);\n        let arrayResult = departArray.join(',');\n        params.departments = arrayResult;\n      }\n      let res = await this.$store.dispatch('statisticsDinnerExport', params);\n      if (res.return_code == 0){\n        let fileUrl = res.data.url;\n        this.download(fileUrl);\n      }\n      this.$store.commit('TABLE_LOADING', false);\n    },\n\n\n    // 下载文件\n    download(fileUrl) {\n      if (!fileUrl) {\n        return;\n      }\n\n      let link = document.createElement(\"a\");\n      link.style.display = \"none\";\n      link.href = fileUrl;\n      link.setAttribute(\"download\", fileUrl);\n      document.body.appendChild(link);\n      link.click();\n      // this.$Message.success(\"下载完成！\");\n    },\n\n    //数据导出\n    listResultExport: async function(pageSize) {\n      this.$store.commit('TABLE_LOADING', true);\n      let startDate = this.resultForm.start_date || '';\n      let endDate = this.resultForm.end_date || '';\n      if (startDate == '' || startDate == 'Invalid date' || endDate == '' || endDate == 'Invalid date'){\n        this.$Message.error(\"请选择就餐日期起止！\");\n        return;\n      }\n\n      let maxPageSize = pageSize ? pageSize : this.$parent.page_size;\n      let params = {\n        merchant_id: this.$store.state.user.curMerchantId,\n        page: 1,\n        page_size: maxPageSize,\n        ...this.resultForm\n      };\n\n      let res = await this.$store.dispatch('orderListExport', params);\n    },\n\n    //多选select\n    handleSelect(val, name){\n      if(_.indexOf(val, '-1') != -1){\n        this.form[name] = ['-1'];\n      }\n    },\n\n  },\n  async mounted() {\n    this.queryStat();\n  }\n}\n</script>\n<style lang='less' scoped>\n.card{\n  padding-bottom: 0 !important;\n  // min-height: 76px;\n  // max-height: 133px;\n}\n\n</style>\n"]}]}