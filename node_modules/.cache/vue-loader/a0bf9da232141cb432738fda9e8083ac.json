{"remainingRequest":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhang/canteen_manage/src/views/staff-management/dining-staff/components/add-department-modal.vue?vue&type=style&index=0&id=36f82b69&lang=less&scoped=true&","dependencies":[{"path":"/Users/zhang/canteen_manage/src/views/staff-management/dining-staff/components/add-department-modal.vue","mtime":1638523312498},{"path":"/Users/zhang/canteen_manage/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKQGltcG9ydCAnLi4vc3R5bGUnOwovZGVlcC8uaXZ1LW1vZGFsLWhlYWRlcnsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgYm9yZGVyLWJvdHRvbTogMDsKICBwYWRkaW5nOiAxNHB4IDE2cHggMDsKICA+ZGl2ewogICAgY29sb3I6ICMyN2ExNjM7CiAgfQogIAp9Ci8vIC9kZWVwLy5pdnUtaW5wdXR7Ci8vICAgdGV4dC1hbGlnbjogcmlnaHQ7Ci8vIH0KL2RlZXAvLmZvcm0td3JhcHBlci5pdnUtZm9ybSB7CiAgcGFkZGluZzogMCAzMCU7CiAgLnRyZWV7CiAgICB3aWR0aDogbWluLWNvbnRlbnQ7CiAgICBtaW4td2lkdGg6IDM1MHB4OwogICAgLml2dS1mb3JtLWl0ZW0tY29udGVudHsKICAgICAgbWF4LWhlaWdodDogNDAwcHg7CiAgICAgIG92ZXJmbG93LXk6IGF1dG87CiAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNkY2RlZTI7CiAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgcGFkZGluZzogMCA4cHg7IAogICAgfQogIH0KCgp9Ci9kZWVwLy5pdnUtdHJlZXsKICBsaXsKICAgIG1hcmdpbjogMCAhaW1wb3J0YW50OwogICAgbGluZS1oZWlnaHQ6IDMycHg7CiAgfQp9Cgo="},{"version":3,"sources":["add-department-modal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA","file":"add-department-modal.vue","sourceRoot":"src/views/staff-management/dining-staff/components","sourcesContent":["<!-- 配置人员类型餐种 -->\n<template>\n  <Modal v-model=\"departmentModal\" width=\"1020px\" :footer-hide=\"true\" title=\"添加用户\">\n    <div>\n      <Tabs v-model=\"cur_tab\" type=\"card\">\n        <TabPane label=\"按部门添加\" name=\"name1\">\n          <Form class=\"margin-top-20 form-wrapper\" :label-width=\"100\">\n            <FormItem label=\"商户名称：\">\n              <span class=\"font-blod\">{{ merchant_name }}</span>\n            </FormItem>\n            <FormItem label=\"人员类型：\">\n              <Select placeholder=\"选择就餐人员类型\" v-model=\"role_id\" style=\"width:250px\">\n                <Option v-for=\"item in roleList\" :key=\"item.role_id\" :value=\"item.role_id\" :label=\"item.name\">\n                  {{ item.name }}\n                </Option>\n              </Select>\n            </FormItem>\n            <FormItem class=\"tree\" label=\"选择部门：\">\n              <Tree :data=\"treeData\" @on-check-change=\"choiceAll\" ref=\"tree3\" show-checkbox multiple></Tree>\n            </FormItem>\n          </Form>\n          <div class=\"border-top-0 text-center margin-top-20 margin-bottom-30\">\n            <Button class=\"margin-right-20\" @click=\"resetForm\">重置</Button>\n            <Button type=\"primary\" :loading=\"btnLoading\" @click=\"handleSave\">提交</Button>\n          </div>\n        </TabPane>\n        <TabPane label=\"从用户中心添加\" name=\"name2\">\n          <add-employee></add-employee>\n        </TabPane>\n        <TabPane label=\"自定义添加\" name=\"name3\">\n          <add-otheruser></add-otheruser>\n        </TabPane>\n      </Tabs>      \n\n    </div>\n  </Modal>\n</template>\n\n<script>\nimport * as dataConfig from '../dataConfig';\nimport md5 from 'js-md5';\nimport _ from 'underscore';\nimport {buildDepartmentTree, buildTree} from \"@/libs/util\";\nimport addEmployee from './add-employee';\nimport addOtheruser from './add-otheruser';\nexport default {\n  name: 'departmentModal',\n  data() {\n    return {\n      cur_tab: 'name1',\n      btnLoading: false,\n      isEdit: false,\n      merchant_name: '',\n      columns: [],\n      role_id: undefined,\n      tableData: [],\n      treeData: [],\n      departments: [],\n      departmentIds: [],\n    };\n  },\n\n  components: { addEmployee, addOtheruser },\n\n  computed: {\n    loading() {\n      return this.$store.state.user.userLoading;\n    },\n    currentMerchantId(){\n      return this.$store.state.user.curMerchantId;\n    },\n    currentMerchantName(){\n      return this.$store.state.user.curMerchantName;\n    },\n    currentOrgId() {\n      return this.$store.state.user.curOrgId;\n    },\n    sessionId() {\n      return this.$store.state.user.token;\n    },\n    empUserCode() {\n      return this.$store.state.user.empUserCode;\n    },\n    departmentModal:{\n      get(){\n        return this.$store.state.user.departmentModal;\n      },\n      set(val){\n        this.$store.commit('setDepartmentModal', val)\n      }\n    },\n\n    //部门列表\n    departmentList() {\n      return this.$store.state.user.merchantDepartmentList;\n    },\n    roleList() {\n      return this.$store.state.role.roleList.result;\n    },\n  },\n\n  methods: {\n    initData() {\n      this.columns = dataConfig.departmentColumns;\n      this.merchant_name = this.currentMerchantName;\n      this.getDepartmentList();\n      // this.queryDepartmentList();\n    },\n    resetForm(){\n      this.role_id='';\n    },\n    async handleSave(){\n      let roleid = this.role_id || 0;\n      if (roleid == 0){\n        this.$Message.error('请选择人员类型！');\n        return;\n      }else{\n        this.btnLoading = true;\n        let params = {\n          sessionid: this.sessionId,\n          org_id: this.currentOrgId,\n          usercode: this.empUserCode,\n          merchant_id: this.$store.state.user.curMerchantId,\n          role_id: this.role_id,\n          department_id: '',\n        };\n       \n        params.department_id = this.departmentIds.join(',');\n\n        await this.$store.dispatch('userAddByDepartment', params).then(res=>{\n          if(res.return_code==0){\n            this.btnLoading = false;\n            this.$Message.success('添加部门人员成功！');\n            this.$store.commit('setDepartmentModal', false);\n            this.queryEmpUserList();\n            this.$parent.getMerchantChildDepartment();\n          }\n        }).catch(err=>{\n          this.btnLoading = false;\n        });\n      }\n    },\n\n    getDepartmentList() {\n      let params = {\n        merchant_id: this.currentMerchantId,\n        level: 1,\n      };\n      // console.log(params)\n      this.$store.dispatch('getMerchantDepartmentList', params).then(res=>{\n        if(res.return_code==0){\n          this.treeData = res.data;\n        }        \n      }).catch(err=>{});\n    },\n\n    choiceAll(data){\n      let choicesData=this.$refs.tree3.getCheckedNodes(); //方法的运用 getSelectedNodes也是如此用法\n      console.log(\"choiceAll===choiceAll====>>>>>\" + JSON.stringify(choicesData));\n      this.departmentIds = _.pluck(choicesData, 'department_id');\n      console.log(\"choiceAll===departmentIds====>>>>>\" + JSON.stringify(this.departmentIds));\n    },\n\n    queryEmpUserList: async function(page, page_size) {\n      let params = {\n        merchant_id: this.currentMerchantId,\n        page: page || 1,\n        page_size: page_size || this.$parent.page_size\n      };\n      await this.$store.dispatch('staffList', params);\n    },\n\n\n  },\n\n  mounted(){\n    this.initData();\n  },\n\n  watch: {\n    departmentModal(val){\n      if(!val){\n        this.btnLoading = false;\n      }\n    }\n  }\n};\n</script>\n<style lang='less' scoped>\n@import '../style';\n/deep/.ivu-modal-header{\n  text-align: center;\n  border-bottom: 0;\n  padding: 14px 16px 0;\n  >div{\n    color: #27a163;\n  }\n  \n}\n// /deep/.ivu-input{\n//   text-align: right;\n// }\n/deep/.form-wrapper.ivu-form {\n  padding: 0 30%;\n  .tree{\n    width: min-content;\n    min-width: 350px;\n    .ivu-form-item-content{\n      max-height: 400px;\n      overflow-y: auto;\n      background-color: #fff;\n      border: 1px solid #dcdee2;\n      border-radius: 4px;\n      padding: 0 8px; \n    }\n  }\n\n\n}\n/deep/.ivu-tree{\n  li{\n    margin: 0 !important;\n    line-height: 32px;\n  }\n}\n\n</style>\n"]}]}