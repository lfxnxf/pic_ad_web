{"remainingRequest":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhang/canteen_manage/src/views/business-information/basic-information/components/add-modal.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhang/canteen_manage/src/views/business-information/basic-information/components/add-modal.vue","mtime":1644998572166},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7bG9jYWxSZWFkfSBmcm9tICJAL2xpYnMvdXRpbCI7CmltcG9ydCBfIGZyb20gInVuZGVyc2NvcmUiOwoKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEgKCkgewogICAgcmV0dXJuIHsKICAgICAgYnRuTG9hZGluZzogZmFsc2UsCiAgICAgIHNob3dDb250YWN0OiBmYWxzZSwKICAgICAgc2hvd0FkbWluVXNlcjogZmFsc2UsCiAgICAgIGZvcm06IHsKICAgICAgICBvcmdfaWQ6ICcnLAogICAgICAgIG1lcmNoYW50X25hbWU6ICcnLAogICAgICAgIGNvbnRhY3Q6ICcnLAogICAgICAgIHVzZXJuYW1lOiAnJywKICAgICAgICBhZG1pbl9uYW1lOiAnJywKICAgICAgICBhZG1pbl91c2VyOiAnJywKICAgICAgICBsaW5rX3RlbDogJycsCiAgICAgIH0sCiAgICAgIHJ1bGVGb3JtOiB7CiAgICAgICAgbWVyY2hhbnRfbmFtZTogWwogICAgICAgICAgeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+ivt+i+k+WFpeWVhuaIt+WQjeensCcsIHRyaWdnZXI6ICdibHVyJyB9CiAgICAgICAgXSwKICAgICAgICB1c2VybmFtZTogWwogICAgICAgICAgeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+ivt+i+k+WFpeWVhuaIt+eUqOaIt+WQjScsIHRyaWdnZXI6ICdibHVyJyB9CiAgICAgICAgXSwKICAgICAgICBhZG1pbl91c2VyOiBbCiAgICAgICAgICB7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn6K+36YCJ5oup566h55CG5ZGYJywgdHJpZ2dlcjogJ2JsdXInIH0KICAgICAgICBdLAogICAgICB9LAogICAgICBzZWxlY3RDb250YWN0OiB7fSwKICAgICAgY29udGFjdExpc3Q6IFtdLAogICAgICBpbnB1dF9kaXNhYmxlZDogZmFsc2UKICAgIH07CiAgfSwKCiAgY29tcG9uZW50czoge30sCgogIGNvbXB1dGVkOiB7CiAgICBhZGRNb2RhbDp7CiAgICAgIGdldCgpewogICAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5tZXJjaGFudC5hZGRNZXJjaGFudE1vZGFsOwogICAgICB9LAogICAgICBzZXQodmFsKXsKICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldEFkZE1lcmNoYW50TW9kYWwnLCB2YWwpCiAgICAgIH0KICAgIH0sCiAgICBnZXRPcmdJZCgpewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUudXNlci5jdXJPcmdJZDsKICAgIH0KCiAgfSwKCiAgbWV0aG9kczogewogICAgYWRkTWVyY2hhbnQ6IGFzeW5jIGZ1bmN0aW9uKCl7CiAgICAgIHRoaXMuJHJlZnMuYWRkTW9kYWwudmFsaWRhdGUoKHZhbGlkKSA9PiB7CiAgICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgICB0aGlzLmJ0bkxvYWRpbmcgPSB0cnVlOwogICAgICAgICAgbGV0IHBhcmFtcyA9IHsKICAgICAgICAgICAgLi4udGhpcy5mb3JtLAogICAgICAgICAgICBwYXltZW50X3R5cGU6ICdQQl9TTVQnLAogICAgICAgICAgICBvcmdfaWQ6IHRoaXMuZ2V0T3JnSWQsCiAgICAgICAgICB9CiAgICAgICAgICBwYXJhbXMuY29udGFjdCA9IHRoaXMuc2VsZWN0Q29udGFjdC5uYW1lOwogICAgICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21lcmNoYW50QWRkJywgcGFyYW1zKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgIGlmIChyZXMucmV0dXJuX2NvZGUgPT0gMCkgewogICAgICAgICAgICAgIHRoaXMuJE1lc3NhZ2Uuc3VjY2Vzcygn5re75Yqg5ZWG5oi35oiQ5Yqf77yBJykKICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWVyY2hhbnRMaXN0Jywge29yZ19pZDogdGhpcy5nZXRPcmdJZCwgcGFnZV9zaXplOiB0aGlzLiRwYXJlbnQucGFnZV9zaXplfSk7CiAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRBZGRNZXJjaGFudE1vZGFsJywgZmFsc2UpOwogICAgICAgICAgICAgIHRoaXMuJHJlZnMuYWRkTW9kYWwucmVzZXRGaWVsZHMoKTsKICAgICAgICAgICAgICB0aGlzLmZvcm0gPSB7CiAgICAgICAgICAgICAgICBvcmdfaWQ6ICcnLAogICAgICAgICAgICAgICAgbWVyY2hhbnRfbmFtZTogJycsCiAgICAgICAgICAgICAgICBjb250YWN0OiAnJywKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiAnJywKICAgICAgICAgICAgICAgIGFkbWluX3VzZXI6ICcnLAogICAgICAgICAgICAgICAgbGlua190ZWw6ICcnLAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZXJyPT57CiAgICAgICAgICAgIHRoaXMuYnRuTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgLy/mn6Xor6LkvIHkuJrlkZjlt6Xkv6Hmga8KICAgIHF1ZXJ5RW1wbG95ZWVMaXN0OiBhc3luYyBmdW5jdGlvbigpIHsKICAgICAgbGV0IGFkbWlubmFtZSA9IHRoaXMuZm9ybS5hZG1pbl9uYW1lIHx8ICcnOwogICAgICBpZiAoYWRtaW5uYW1lLmxlbmd0aCA9PSAwKXsKICAgICAgICB0aGlzLiRNZXNzYWdlLmVycm9yKCfor7fovpPlhaXnrqHnkIblkZjkv6Hmga/vvIEnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGxldCBwYXJhbXMgPSB7CiAgICAgICAgc2Vzc2lvbmlkOiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLnRva2VuLAogICAgICAgIG9yZ19pZDogdGhpcy4kc3RvcmUuc3RhdGUudXNlci5jdXJPcmdJZCwKICAgICAgICB1c2VyY29kZTogdGhpcy4kc3RvcmUuc3RhdGUudXNlci5lbXBVc2VyQ29kZSwKICAgICAgICBxdWVyeTogdGhpcy5mb3JtLmFkbWluX25hbWUsCiAgICAgICAgc3RhdHVzOiAxLAogICAgICAgIGxpbWl0OiAxMDAwCiAgICAgIH07CiAgICAgIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdlbXBsb3llZUxpc3QnLCBwYXJhbXMpLnRoZW4ocmVzID0+IHsKICAgICAgICB0aGlzLnNob3dDb250YWN0ID0gdHJ1ZTsKICAgICAgICB0aGlzLmNvbnRhY3RMaXN0ID0gcmVzLnJvd3M7CiAgICAgICAgaWYgKHRoaXMuY29udGFjdExpc3QubGVuZ3RoID4gMCl7CiAgICAgICAgICB0aGlzLmZvcm0uY29udGFjdCA9IHRoaXMuY29udGFjdExpc3RbMF0udXNlcmNvZGU7CiAgICAgICAgICAvLyB0aGlzLnNlbGVjdGVkQ29udGFjdCh0aGlzLmZvcm0uY29udGFjdCk7CiAgICAgICAgICB0aGlzLmZvcm0uYWRtaW5fdXNlciA9IHRoaXMuY29udGFjdExpc3RbMF0udXNlcmNvZGU7CiAgICAgICAgICB0aGlzLmlucHV0X2Rpc2FibGVkID0gdHJ1ZTsKICAgICAgICAgIGxldCByZXN1bHQgPSBfLmZpbmQodGhpcy5jb250YWN0TGlzdCwgY3VyPT57CiAgICAgICAgICAgIHJldHVybiBjdXIudXNlcmNvZGUgPT0gdGhpcy5jb250YWN0TGlzdFswXS51c2VyY29kZTsKICAgICAgICAgIH0pCiAgICAgICAgICB0aGlzLmZvcm0ubGlua190ZWwgPSByZXN1bHQucGhvbmVzOwogICAgICAgICAgdGhpcy5zZWxlY3RDb250YWN0ID0gcmVzdWx0OwogICAgICAgICAgdGhpcy5zaG93QWRtaW5Vc2VyID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICB0aGlzLmZvcm0uY29udGFjdCA9ICcnOwogICAgICAgICAgdGhpcy5mb3JtLmFkbWluX3VzZXIgPSAnJzsKICAgICAgICAgIHRoaXMuZm9ybS5saW5rX3RlbCA9ICcnOwogICAgICAgICAgdGhpcy5zZWxlY3RDb250YWN0ID0ge307CiAgICAgICAgfQoKICAgICAgfSk7CgoKICAgIH0sCgogICAgLy/pgInkuK3ogZTns7vkurrlkI4KICAgIHNlbGVjdGVkQ29udGFjdCh2YWwpewogICAgICBjb25zb2xlLmxvZygic2VsZWN0ZWRDb250YWN0PT09dmFsPj4+IiArIEpTT04uc3RyaW5naWZ5KHZhbCkpCiAgICAgIGNvbnNvbGUubG9nKCJzZWxlY3RlZENvbnRhY3Q9PT0+Pj4iICsgSlNPTi5zdHJpbmdpZnkodGhpcy5mb3JtLmNvbnRhY3QpKQogICAgICB0aGlzLmZvcm0uYWRtaW5fdXNlciA9IHZhbC52YWx1ZTsKICAgICAgdGhpcy5pbnB1dF9kaXNhYmxlZCA9IHRydWU7CiAgICAgIGxldCByZXN1bHQgPSBfLmZpbmQodGhpcy5jb250YWN0TGlzdCwgY3VyPT57CiAgICAgICAgcmV0dXJuIGN1ci51c2VyY29kZSA9PSB2YWwudmFsdWU7CiAgICAgIH0pCiAgICAgIHRoaXMuZm9ybS5saW5rX3RlbCA9IHJlc3VsdC5waG9uZXM7CiAgICAgIHRoaXMuc2VsZWN0Q29udGFjdCA9IHJlc3VsdDsKICAgICAgdGhpcy5zaG93QWRtaW5Vc2VyID0gdHJ1ZTsKCiAgICB9LAoKICAgIC8v6YCJ5Lit6IGU57O75Lq65ZCOCiAgICAvLyBzZWxlY3RlZFVzZXIodXNlcil7CiAgICAvLyAgIHRoaXMuZm9ybS5hZG1pbl91c2VyID0gdXNlci51c2VyY29kZTsKICAgIC8vICAgdGhpcy5mb3JtLmFkbWluX25hbWUgPSB1c2VyLm5hbWU7CiAgICAvLyAgIHRoaXMuaW5wdXRfZGlzYWJsZWQgPSB0cnVlOwogICAgLy8gICB0aGlzLmZvcm0ubGlua190ZWwgPSB1c2VyLnBob25lczsKICAgIC8vICAgdGhpcy5zZWxlY3RDb250YWN0ID0gdXNlcjsKCiAgICAvLyB9LAogICAgLy/ogZTns7vkurrngrnlh7vmuIXnqboKICAgIGhhbmRsZUNsZWFyKCl7CiAgICAgIHRoaXMuZm9ybS5hZG1pbl91c2VyID0gJyc7CiAgICAgIHRoaXMuZm9ybS5saW5rX3RlbCA9ICcnOwogICAgICB0aGlzLmZvcm0uY29udGFjdCA9ICcnOwogICAgICB0aGlzLmlucHV0X2Rpc2FibGVkID0gZmFsc2U7CiAgICB9CiAgfSwKCiAgd2F0Y2g6ewogICAgYWRkTW9kYWwodmFsKXsKICAgICAgaWYodmFsKXsKICAgICAgICAvLyB0aGlzLnF1ZXJ5RW1wbG95ZWVMaXN0KCk7CiAgICAgIH0KICAgIH0KICB9Cn0KCg=="},{"version":3,"sources":["add-modal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiDA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"add-modal.vue","sourceRoot":"src/views/business-information/basic-information/components","sourcesContent":["<!-- 新增商户信息 -->\n<template>\n  <Modal\n    v-model=\"addModal\"\n    title=\"新增商户\"\n    :footer-hide=\"true\"\n    width=\"540px\">\n    <Form :model=\"form\" :label-width=\"120\" ref=\"addModal\" :rules=\"ruleForm\">\n      <FormItem label=\"商户名称\" prop=\"merchant_name\">\n        <Input v-model=\"form.merchant_name\" style=\"width: 340px\" placeholder=\"请输入商户名称，如市公安局\" />\n      </FormItem>\n      <FormItem label=\"商户用户名\" prop=\"username\">\n        <Input v-model=\"form.username\" style=\"width: 340px\" placeholder=\"需注册钱包账号，如shigonganju\" />\n      </FormItem>\n      <Divider>添加管理员，请先查找管理员，再下拉选择管理员信息</Divider>\n      <FormItem label=\"管理员查询\">\n        <Input v-model=\"form.admin_name\" style=\"width: 280px\" placeholder=\"按管理员姓名、手机号查找\" />\n        <Button type=\"primary\" @click=\"queryEmployeeList\">查询</Button>\n      </FormItem>\n      <FormItem label=\"选择管理员\">\n        <Select\n          v-model=\"form.contact\"\n          filterable\n          clearable\n          placeholder=\"选择管理员\"\n          @on-select=\"selectedContact\"\n          @on-clear=\"handleClear\"\n          style=\"width: 340px\">\n          <Option v-for=\"item of contactList\" :value=\"item.usercode\" :key=\"item.id\">\n            {{ `${item.name} [ ${item.department_name?item.department_name:''}-${item.phones?item.phones:''} ]` }}\n          </Option>\n        </Select>\n      </FormItem>\n      <FormItem label=\"管理员账号\" prop=\"admin_user\">\n        <Input v-model=\"form.admin_user\" style=\"width: 340px\" :disabled=\"true\" placeholder=\"管理员账号（选择管理员，自动填写）\" />\n      </FormItem>\n\n      <FormItem label=\"联系电话\">\n        <Input v-model=\"form.link_tel\" style=\"width: 340px\" placeholder=\"联系人电话\" />\n      </FormItem>\n      <div class=\"text-center margin-bottom-20 margin-top-30\">\n        <Button class=\"margin-right-20\" @click=\"$store.commit('setAddMerchantModal', false)\">取消</Button>\n        <Button type=\"primary\" :loading=\"btnLoading\" @click=\"addMerchant\">确定</Button>\n      </div>\n    </Form>\n  </Modal>\n</template>\n\n<script>\nimport {localRead} from \"@/libs/util\";\nimport _ from \"underscore\";\n\nexport default {\n  data () {\n    return {\n      btnLoading: false,\n      showContact: false,\n      showAdminUser: false,\n      form: {\n        org_id: '',\n        merchant_name: '',\n        contact: '',\n        username: '',\n        admin_name: '',\n        admin_user: '',\n        link_tel: '',\n      },\n      ruleForm: {\n        merchant_name: [\n          { required: true, message: '请输入商户名称', trigger: 'blur' }\n        ],\n        username: [\n          { required: true, message: '请输入商户用户名', trigger: 'blur' }\n        ],\n        admin_user: [\n          { required: true, message: '请选择管理员', trigger: 'blur' }\n        ],\n      },\n      selectContact: {},\n      contactList: [],\n      input_disabled: false\n    };\n  },\n\n  components: {},\n\n  computed: {\n    addModal:{\n      get(){\n        return this.$store.state.merchant.addMerchantModal;\n      },\n      set(val){\n        this.$store.commit('setAddMerchantModal', val)\n      }\n    },\n    getOrgId(){\n      return this.$store.state.user.curOrgId;\n    }\n\n  },\n\n  methods: {\n    addMerchant: async function(){\n      this.$refs.addModal.validate((valid) => {\n        if (valid) {\n          this.btnLoading = true;\n          let params = {\n            ...this.form,\n            payment_type: 'PB_SMT',\n            org_id: this.getOrgId,\n          }\n          params.contact = this.selectContact.name;\n          this.$store.dispatch('merchantAdd', params).then(res => {\n            if (res.return_code == 0) {\n              this.$Message.success('添加商户成功！')\n              this.$store.dispatch('merchantList', {org_id: this.getOrgId, page_size: this.$parent.page_size});\n              this.$store.commit('setAddMerchantModal', false);\n              this.$refs.addModal.resetFields();\n              this.form = {\n                org_id: '',\n                merchant_name: '',\n                contact: '',\n                username: '',\n                admin_user: '',\n                link_tel: '',\n              }\n            }\n          }).catch(err=>{\n            this.btnLoading = false;\n          });\n        }\n      });\n    },\n\n    //查询企业员工信息\n    queryEmployeeList: async function() {\n      let adminname = this.form.admin_name || '';\n      if (adminname.length == 0){\n        this.$Message.error('请输入管理员信息！');\n        return;\n      }\n\n      let params = {\n        sessionid: this.$store.state.user.token,\n        org_id: this.$store.state.user.curOrgId,\n        usercode: this.$store.state.user.empUserCode,\n        query: this.form.admin_name,\n        status: 1,\n        limit: 1000\n      };\n      await this.$store.dispatch('employeeList', params).then(res => {\n        this.showContact = true;\n        this.contactList = res.rows;\n        if (this.contactList.length > 0){\n          this.form.contact = this.contactList[0].usercode;\n          // this.selectedContact(this.form.contact);\n          this.form.admin_user = this.contactList[0].usercode;\n          this.input_disabled = true;\n          let result = _.find(this.contactList, cur=>{\n            return cur.usercode == this.contactList[0].usercode;\n          })\n          this.form.link_tel = result.phones;\n          this.selectContact = result;\n          this.showAdminUser = true;\n        }\n        else {\n          this.form.contact = '';\n          this.form.admin_user = '';\n          this.form.link_tel = '';\n          this.selectContact = {};\n        }\n\n      });\n\n\n    },\n\n    //选中联系人后\n    selectedContact(val){\n      console.log(\"selectedContact===val>>>\" + JSON.stringify(val))\n      console.log(\"selectedContact===>>>\" + JSON.stringify(this.form.contact))\n      this.form.admin_user = val.value;\n      this.input_disabled = true;\n      let result = _.find(this.contactList, cur=>{\n        return cur.usercode == val.value;\n      })\n      this.form.link_tel = result.phones;\n      this.selectContact = result;\n      this.showAdminUser = true;\n\n    },\n\n    //选中联系人后\n    // selectedUser(user){\n    //   this.form.admin_user = user.usercode;\n    //   this.form.admin_name = user.name;\n    //   this.input_disabled = true;\n    //   this.form.link_tel = user.phones;\n    //   this.selectContact = user;\n\n    // },\n    //联系人点击清空\n    handleClear(){\n      this.form.admin_user = '';\n      this.form.link_tel = '';\n      this.form.contact = '';\n      this.input_disabled = false;\n    }\n  },\n\n  watch:{\n    addModal(val){\n      if(val){\n        // this.queryEmployeeList();\n      }\n    }\n  }\n}\n\n</script>\n<style lang='less' scoped>\n/deep/.ivu-modal-header{\n  text-align: center;\n}\n</style>\n"]}]}