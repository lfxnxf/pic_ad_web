{"remainingRequest":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhang/canteen_manage/src/views/setting/department-setting/components/add-modal.vue?vue&type=style&index=0&id=7f321c59&lang=less&scoped=true&","dependencies":[{"path":"/Users/zhang/canteen_manage/src/views/setting/department-setting/components/add-modal.vue","mtime":1638523446917},{"path":"/Users/zhang/canteen_manage/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgovZGVlcC8uaXZ1LWNhcmR7CiAgaGVpZ2h0OiB+Jy13ZWJraXQtY2FsYygxMDB2aCAtIDQwcHggLSAzNnB4KSc7CiAgaGVpZ2h0OiB+Jy1tb3otY2FsYygxMDB2aCAtIDQwcHggLSAzNnB4KSc7CiAgaGVpZ2h0OiB+Jy1tcy1jYWxjKDEwMHZoIC0gNDBweCAtIDM2cHgpJzsKICBoZWlnaHQ6IH4nLW8tY2FsYygxMDB2aCAtIDQwcHggLSAzNnB4KSc7CiAgaGVpZ2h0OiBjYWxjKDEwMHZoIC0gNDBweCAtIDM2cHgpOwoKfQoKL2RlZXAvLml2dS1pbnB1dHsKICB0ZXh0LWFsaWduOiByaWdodDsKfQovZGVlcC8uaXZ1LWZvcm0gLnRyZWV7CiAgLml2dS1mb3JtLWl0ZW0tY29udGVudHsKICAgIG1heC1oZWlnaHQ6IDUwMHB4OwogICAgb3ZlcmZsb3cteTogYXV0bzsKICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgICBib3JkZXI6IDFweCBzb2xpZCAjZGNkZWUyOwogICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgcGFkZGluZzogMCA4cHg7CiAgICBtYXJnaW4tbGVmdDogMCAhaW1wb3J0YW50OwogIH0KICArLml2dS1mb3JtLWl0ZW0gLml2dS1mb3JtLWl0ZW0tY29udGVudHsKICAgIG1hcmdpbi1sZWZ0OiAwICFpbXBvcnRhbnQ7CiAgfQogIC5pdnUtYnRuewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgcmlnaHQ6IDA7CiAgICB0b3A6IDA7CiAgfQp9Ci9kZWVwLy5pdnUtdHJlZXsKICBsaXsKICAgIG1hcmdpbjogMCAhaW1wb3J0YW50OwogICAgbGluZS1oZWlnaHQ6IDMycHg7CiAgfQp9Cgo="},{"version":3,"sources":["add-modal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuNA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"add-modal.vue","sourceRoot":"src/views/setting/department-setting/components","sourcesContent":["<!-- 同步部门信息 -->\n<template>\n  <Row :gutter=\"15\">\n    <Col span=\"12\">\n      <Card title=\"设置商户部门\">\n\n          <Form class=\"margin-top-20\" :label-width=\"100\">\n            <FormItem label=\"商户名称：\">\n              <span class=\"font-blod\" style=\"padding-left:12px\">{{ merchant_name }}</span>\n            </FormItem>\n            <Form inline :label-width=\"100\">\n              <FormItem class=\"tree\" label=\"选择部门：\">\n                <Tree :data=\"treeData\" @on-check-change=\"choiceAll\" ref=\"tree3\" show-checkbox multiple></Tree>\n              </FormItem>\n              <FormItem>\n                <Button type=\"primary\" :loading=\"btnLoading\" @click=\"syncDepartmentList\">提交</Button>\n              </FormItem>\n            </Form>\n          </Form>\n\n      </Card>\n    </Col>\n    <Col span=\"12\">\n      <Card title=\"同步云门户数据到用户中心\">\n\n          <Form class=\"margin-top-20\" :label-width=\"100\">\n\n            <FormItem class=\"margin-bottom-40\" label=\"同步部门：\">\n              <Button class=\"margin-right-20\" type='primary' :loading=\"btnLoading2\" icon=\"md-refresh\"\n                      @click=\"syncEmployee('department')\">同步部门\n              </Button>\n              <!-- <span class=\"orange-color\"><Icon class=\"margin-right-5\" type=\"md-information-circle\"/>同步部门数据</span> -->\n            </FormItem>\n          </Form>\n          <Form class=\"margin-top-20\" :label-width=\"100\">\n\n            <FormItem class=\"margin-bottom-40\" label=\"同步人员：\">\n              <Button class=\"margin-right-20\" type='primary' :loading=\"btnLoading3\" icon=\"md-refresh\"\n                      @click=\"syncEmployee('employee')\">同步人员\n              </Button>\n              <!-- <span class=\"orange-color\"><Icon class=\"margin-right-5\" type=\"md-information-circle\"/>同步人员数据</span> -->\n            </FormItem>\n\n          </Form>\n\n      </Card>\n    </Col>\n  </Row>\n\n</template>\n\n<script>\nimport _ from 'underscore';\nimport {getTreeNodes, buildTree, buildTreeChecked} from \"@/libs/util\";\nexport default {\n  data() {\n    return {\n      btnLoading: false,\n      btnLoading2: false,\n      btnLoading3: false,\n      isEdit: false,\n      merchant_name: '',\n      tableData: [],\n      treeData: [],\n      departments: [],\n      departmentIds: [],\n    };\n  },\n\n  components: {},\n\n  computed: {\n    loading() {\n      return this.$store.state.user.userLoading;\n    },\n    currentMerchantId(){\n      return this.$store.state.user.curMerchantId;\n    },\n    currentMerchantName(){\n      return this.$store.state.user.curMerchantName;\n    },\n    currentOrgId() {\n      return this.$store.state.user.curOrgId;\n    },\n    sessionId() {\n      return this.$store.state.user.token;\n    },\n    empUserCode() {\n      return this.$store.state.user.empUserCode;\n    },\n\n    //部门列表\n    departmentList() {\n      return this.$store.state.user.departmentList;\n    },\n\n  },\n\n  methods: {\n    initData: async function() {\n      this.merchant_name = this.currentMerchantName;\n      let res = await this.getDepartmentList();\n      await this.queryDepartmentList(res);\n    },\n\n    //获取企业部门列表\n    async queryDepartmentList(strChecked) {\n      let res = await this.$store.dispatch('departmentList', { org_id: this.currentOrgId, sessionid: this.sessionId,limit: 2000 });\n      // console.log(\"queryDepartmentList===res>>>\" + JSON.stringify(res));\n      let validRes = _.filter(res, cur => {return cur.status == 1 });\n      // console.log(\"queryDepartmentList===validRes>>>\" + JSON.stringify(validRes));\n      await this.$store.commit(\"UpdateEmpDepartmentList\", validRes);\n      if (validRes.length > 0) {\n        this.treeData = buildTreeChecked(validRes, {}, 'department_id', 'parentid', 'children', '0', strChecked);\n      }\n    },\n\n    choiceAll(data){\n      let choicesData = this.$refs.tree3.getCheckedAndIndeterminateNodes();\n      this.departments = _.map(choicesData, function(item){ return {name: item.name, org_id: item.org_id, parentid: item.parentid, department_id: item.department_id}; });\n    },\n\n    syncDepartmentList: async function() {\n      this.btnLoading = true;\n      //给部门添加跟节点；\n      let rootTree={\n        department_id: '0',\n        parentid: \"\",\n        name: \"全部部门\",\n        org_id: this.currentOrgId,\n      };\n\n      let findItem = _.find(this.departments, cur=>{return cur.department_id == '0' });\n\n      if (findItem == undefined){\n        this.departments.push(rootTree);\n      }\n      else{\n        findItem['org_id'] = this.currentOrgId;\n      }\n\n      let Base64 = require('js-base64').Base64;\n\n      let params = {\n        merchant_id: this.currentMerchantId,\n        departments: Base64.encode(JSON.stringify(this.departments)),\n      };\n\n      await this.$store.dispatch('syncDepartments', params).then(res=>{\n        if(res.return_code==0){\n          this.btnLoading = false;\n          this.$Message.success('同步部门信息成功！');\n        }\n      }).catch(err=>{\n        this.btnLoading = false;\n      });\n    },\n\n    getDepartmentList: async function() {\n\n      let params = {\n        merchant_id: this.currentMerchantId,\n        level: 1,\n      };\n\n      let res = await this.$store.dispatch('getMerchantDepartmentList', params);\n      if(res.return_code==0){\n          this.$Message.success('获取部门信息成功！');\n          let resTree = getTreeNodes(res.data, 'department_id',  'children');\n          return resTree;\n      }\n    },\n    // 同步员工\n    async syncEmployee(entityData) {\n      try {\n        if(entityData=='department'){\n          this.btnLoading2 = true;\n        }else if(entityData=='employee'){\n          this.btnLoading3 = true;\n        }\n\n        let res = await this.$store.dispatch('icloudSync', { org_id: this.$store.state.user.curOrgId, entity: entityData });\n        if (res.return_code !== 0) {\n          this.$Message.error(res.return_message);\n          return;\n        }\n        this.btnLoading2 = false;\n        this.btnLoading3 = false;\n\n        this.$Message.success('同步数据命令发送成功，请稍后查看同步数据结果！');\n      } catch (e) {\n        // console.log(e);\n        this.btnLoading2 = false;\n        this.btnLoading3 = false;\n      }\n    },\n\n\n  },\n\n  mounted(){\n    this.initData();\n  },\n\n  watch: {\n    departmentModal(val){\n      if(!val){\n        this.btnLoading = false;\n        this.btnLoading2 = false;\n      }\n    }\n  }\n};\n</script>\n<style lang='less' scoped>\n/deep/.ivu-card{\n  height: ~'-webkit-calc(100vh - 40px - 36px)';\n  height: ~'-moz-calc(100vh - 40px - 36px)';\n  height: ~'-ms-calc(100vh - 40px - 36px)';\n  height: ~'-o-calc(100vh - 40px - 36px)';\n  height: calc(100vh - 40px - 36px);\n\n}\n\n/deep/.ivu-input{\n  text-align: right;\n}\n/deep/.ivu-form .tree{\n  .ivu-form-item-content{\n    max-height: 500px;\n    overflow-y: auto;\n    background-color: #fff;\n    border: 1px solid #dcdee2;\n    border-radius: 4px;\n    padding: 0 8px;\n    margin-left: 0 !important;\n  }\n  +.ivu-form-item .ivu-form-item-content{\n    margin-left: 0 !important;\n  }\n  .ivu-btn{\n    position: absolute;\n    right: 0;\n    top: 0;\n  }\n}\n/deep/.ivu-tree{\n  li{\n    margin: 0 !important;\n    line-height: 32px;\n  }\n}\n\n</style>\n"]}]}