{"remainingRequest":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhang/canteen_manage/src/views/staff-management/dining-staff/components/add-employee.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhang/canteen_manage/src/views/staff-management/dining-staff/components/add-employee.vue","mtime":1639449930006},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCAqIGFzIGRhdGFDb25maWcgZnJvbSAnLi4vZGF0YUNvbmZpZyc7CmltcG9ydCBtZDUgZnJvbSAnanMtbWQ1JzsKaW1wb3J0IF8gZnJvbSAndW5kZXJzY29yZSc7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ2VtcGxveWVlTW9kYWwnLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgYWRkVGV4dDogIua3u+WKoCIsCiAgICAgIGNvbHVtbnM6IFtdLAogICAgICB0YWJsZURhdGE6IFtdLAogICAgICBmb3JtVmFsaWRhdGU6IHsKICAgICAgICBxdWVyeTogJycsCiAgICAgICAgcm9sZV9pZDogdW5kZWZpbmVkLAogICAgICB9LAoKICAgIH07CiAgfSwKCiAgLy8gY3JlYXRlZCgpIHsKICAvLyAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgdGhpcy5oYW5kbGVLZXlEb3duLCB0cnVlKTsgLy/lvIDlkK/nm5HlkKzplK7nm5jmjInkuIvkuovku7YKICAvLyB9LAoKICBjb21wb25lbnRzOiB7fSwKCiAgY29tcHV0ZWQ6IHsKCiAgICBjdXJyZW50T3JnSWQoKSB7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLmN1ck9yZ0lkOwogICAgfSwKICAgIHNlc3Npb25JZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnVzZXIudG9rZW47CiAgICB9LAogICAgZW1wVXNlckNvZGUoKSB7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLmVtcFVzZXJDb2RlOwogICAgfSwKICAgIGN1cnJlbnRNZXJjaGFudElkKCl7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLmN1ck1lcmNoYW50SWQ7CiAgICB9LAogICAgY3VycmVudE1lcmNoYW50TmFtZSgpewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUudXNlci5jdXJNZXJjaGFudE5hbWU7CiAgICB9LAogICAgcm9sZUxpc3QoKXsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnJvbGUucm9sZUxpc3QucmVzdWx0OwogICAgfSwKCiAgfSwKCiAgbWV0aG9kczogewogICAgaGFuZGxlS2V5RG93bihlKSB7CiAgICAgIGxldCBrZXkgPSBudWxsOwogICAgICBpZiAod2luZG93LmV2ZW50ID09PSB1bmRlZmluZWQpIHsKICAgICAgICBrZXkgPSBlLmtleUNvZGU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAga2V5ID0gd2luZG93LmV2ZW50LmtleUNvZGU7CiAgICAgIH0KICAgICAgaWYgKGtleSA9PT0gMTMpIHsKICAgICAgICBjb25zb2xlLmxvZygiRW50ZXI9PT09Pj4+Pj4+IikKICAgICAgICAvL+inpuWPkeeahOS6i+S7tgogICAgICAgIHRoaXMucXVlcnlFbXBsb3llZUxpc3QoKTsKICAgICAgfQogICAgfSwKCiAgICAvL+afpeivouS8geS4muWRmOW3peS/oeaBrwogICAgcXVlcnlFbXBsb3llZUxpc3Q6IGFzeW5jIGZ1bmN0aW9uKCkgewogICAgICBjb25zb2xlLmxvZygiPT09PT1xdWVyeUVtcGxveWVlTGlzdD09PT09IikKICAgICAgbGV0IGFkbWlubmFtZSA9IHRoaXMuZm9ybVZhbGlkYXRlLnF1ZXJ5IHx8ICcnOwogICAgICBpZiAoYWRtaW5uYW1lLmxlbmd0aCA9PSAwKXsKICAgICAgICB0aGlzLiRNZXNzYWdlLmVycm9yKCfor7fovpPlhaXopoHmn6Xor6LkurrlkZjlp5PlkI3miJbmiYvmnLrlj7fkv6Hmga/vvIEnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7CiAgICAgIGxldCBwYXJhbXMgPSB7CiAgICAgICAgLi4udGhpcy5mb3JtVmFsaWRhdGUsCiAgICAgICAgc2Vzc2lvbmlkOiB0aGlzLnNlc3Npb25JZCwKICAgICAgICBvcmdfaWQ6IHRoaXMuY3VycmVudE9yZ0lkLAogICAgICAgIHVzZXJjb2RlOiB0aGlzLmVtcFVzZXJDb2RlLAogICAgICAgIHN0YXR1czogMSwKICAgICAgICBsaW1pdDogMTAwMAogICAgICB9OwoKICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2VtcGxveWVlTGlzdCcsIHBhcmFtcykudGhlbihyZXM9PnsKICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICB0aGlzLnRhYmxlRGF0YSA9IFtdOwogICAgICAgIGZvciAobGV0IGl0ZW0gb2YgcmVzLnJvd3MpewogICAgICAgICAgaXRlbVsncm9sZV9pZCddID0gMDsKICAgICAgICAgIHRoaXMudGFibGVEYXRhLnB1c2goaXRlbSk7CiAgICAgICAgfQoKICAgICAgfSkuY2F0Y2goZXJyPT57CiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwoKICAgIH0sCgogICAgaW5pdCgpIHsKICAgICAgdGhpcy5jb2x1bW5zID0gZGF0YUNvbmZpZy5lbXBsb3llZUNvbHVtbnM7CgogICAgfSwKICAgIGFkZEVtcGxveWVlVG9Vc2VyOiBhc3luYyBmdW5jdGlvbihlbXBsb3llZSl7CgogICAgICBjb25zb2xlLmxvZygn5re75Yqg5b2T5YmN6KGMLS0tcm93JyxlbXBsb3llZSkKICAgICAgbGV0IHBhcmFtcyA9IHsKICAgICAgICBtZXJjaGFudF9pZDogdGhpcy4kc3RvcmUuc3RhdGUudXNlci5jdXJNZXJjaGFudElkLAogICAgICAgIHVzZXJfdHlwZTogMSwKICAgICAgICByb2xlX2lkOiBlbXBsb3llZS5yb2xlX2lkLAogICAgICAgIGlkX25vOiBlbXBsb3llZS5pZF9ubywKICAgICAgICBjYXJkX25vOiAnJywKICAgICAgICBleHRfZW1wX2lkOiBlbXBsb3llZS5leHRfZW1wX2lkLAogICAgICAgIG5hbWU6IGVtcGxveWVlLm5hbWUsCiAgICAgICAgY191c2VyY29kZTogZW1wbG95ZWUuY191c2VyY29kZSwKICAgICAgICBjaXR5OiBlbXBsb3llZS5jaXR5LAogICAgICAgIHBob25lczogZW1wbG95ZWUucGhvbmVzLAogICAgICAgIGV4dF91c2VyX2lkOiBlbXBsb3llZS5leHRfdXNlcl9pZCwKICAgICAgICBvcmdfaWQ6IGVtcGxveWVlLm9yZ19pZCwKICAgICAgICBkZXBhcnRtZW50czogZW1wbG95ZWUuZGVwYXJ0bWVudHMsCiAgICAgICAgZGVwYXJ0bWVudDogZW1wbG95ZWUuZGVwYXJ0bWVudF9pZCwKICAgICAgICBkZXBhcnRtZW50X25hbWU6IGVtcGxveWVlLmRlcGFydG1lbnRfbmFtZSwKICAgICAgICB1c2VyY29kZTogZW1wbG95ZWUudXNlcmNvZGUsCiAgICAgICAgaXNfYWRtaW46IGVtcGxveWVlLmlzX2FkbWluLAogICAgICAgIGlzX3dhbGxldF9hZG1pbjogZW1wbG95ZWUuaXNfd2FsbGV0X2FkbWluLAogICAgICAgIG9yZ19uYW1lOiBlbXBsb3llZS5vcmdfbmFtZSwKICAgICAgICBlbWFpbHM6IGVtcGxveWVlLmVtYWlscywKICAgICAgfTsKCiAgICAgIGxldCBwYXJhbXNEYXRhID0gW107CiAgICAgIHBhcmFtc0RhdGEucHVzaChwYXJhbXMpOwoKICAgICAgbGV0IEJhc2U2NCA9IHJlcXVpcmUoJ2pzLWJhc2U2NCcpLkJhc2U2NDsKICAgICAgbGV0IGRldGFpbHMgPSBCYXNlNjQuZW5jb2RlKEpTT04uc3RyaW5naWZ5KHBhcmFtc0RhdGEpKTsKCiAgICAgIGxldCByZXFQYXJhbXMgPSB7CiAgICAgICAgc2Vzc2lvbmlkOiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLnRva2VuLAogICAgICAgIHVzZXJfZGV0YWlsOiBkZXRhaWxzLAogICAgICB9OwoKICAgICAgdHJ5IHsKICAgICAgICBsZXQgcmVzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3VzZXJBZGQnLCByZXFQYXJhbXMpOwogICAgICAgIGlmKHJlcyAmJiBfLmhhcyhyZXMsICdyZXR1cm5fY29kZScpICYmIHJlcy5yZXR1cm5fY29kZT09MCl7CiAgICAgICAgICB0aGlzLiRNZXNzYWdlLnN1Y2Nlc3MoJ+a3u+WKoOWwsemkkOS6uuWRmOaIkOWKn++8gScpOwogICAgICAgICAgdGhpcy4kcGFyZW50LnF1ZXJ5KCk7CiAgICAgICAgICBhd2FpdCB0aGlzLiRwYXJlbnQuZ2V0TWVyY2hhbnRDaGlsZERlcGFydG1lbnQoKTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgIHRoaXMuJE1lc3NhZ2UuZXJyb3IoIumUmeivr+egge+8miIgKyByZXMucmV0dXJuX2NvZGUgKyAiLCDplJnor6/kv6Hmga/vvJoiICsgcmVzLnJldHVybl9tZXNzYWdlKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2goZSkgewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICB9CiAgICB9CgogIH0sCgogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmluaXQoKTsKCiAgfSwKCn0KCg=="},{"version":3,"sources":["add-employee.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA","file":"add-employee.vue","sourceRoot":"src/views/staff-management/dining-staff/components","sourcesContent":["<!-- 添加独立就餐人员 -->\n<template>\n  <div>\n    <div class=\"margin-top-10\">\n      <Form inline :model=\"formValidate\" label-colon @keyup.enter.prevent=''>\n        <FormItem label=\"关键字\">\n          <Input :style=\"{width: '310px'}\" clearable @keyup.enter.native=\"queryEmployeeList\" v-model=\"formValidate.query\" placeholder=\"用户姓名/手机号/数字账号/员工ID\" />\n          <Input type=\"text\" v-show=\"false\" style=\"width: 1px;\"/>\n        </FormItem>\n        <FormItem>\n          <Button type='primary' icon=\"md-search\" @click=\"queryEmployeeList()\">查询</Button>\n        </FormItem>\n      </Form>\n    </div>\n    <div>\n      <Table border stripe :columns='columns' :data='tableData' :loading=\"loading\">\n        <template slot=\"status\" slot-scope=\"{ row }\">\n          <Tag :color=\"row.status==1?'green':'volcano'\">{{row.status == 1 ? '正常' : '已删除'}}</Tag>\n        </template>\n        <template slot=\"userroletype\" slot-scope=\"{ row }\">\n          <Select placeholder=\"人员类型\" v-model=\"row.role_id\">\n            <Option v-for=\"item in roleList\" :key=\"item.role_id\" :value=\"item.role_id\" :label=\"item.name\">{{ item.name }}</Option>\n          </Select>\n        </template>\n        <template slot=\"handle\" slot-scope=\"{ row }\">\n          <Button type=\"success\" ghost size=\"small\" @click=\"addEmployeeToUser(row)\">{{addText}}</Button>\n        </template>\n      </Table>\n    </div>\n\n  </div>\n</template>\n\n<script>\nimport * as dataConfig from '../dataConfig';\nimport md5 from 'js-md5';\nimport _ from 'underscore';\n\nexport default {\n  name: 'employeeModal',\n  data() {\n    return {\n      loading: false,\n      addText: \"添加\",\n      columns: [],\n      tableData: [],\n      formValidate: {\n        query: '',\n        role_id: undefined,\n      },\n\n    };\n  },\n\n  // created() {\n  //   window.addEventListener(\"keydown\", this.handleKeyDown, true); //开启监听键盘按下事件\n  // },\n\n  components: {},\n\n  computed: {\n\n    currentOrgId() {\n      return this.$store.state.user.curOrgId;\n    },\n    sessionId() {\n      return this.$store.state.user.token;\n    },\n    empUserCode() {\n      return this.$store.state.user.empUserCode;\n    },\n    currentMerchantId(){\n      return this.$store.state.user.curMerchantId;\n    },\n    currentMerchantName(){\n      return this.$store.state.user.curMerchantName;\n    },\n    roleList(){\n      return this.$store.state.role.roleList.result;\n    },\n\n  },\n\n  methods: {\n    handleKeyDown(e) {\n      let key = null;\n      if (window.event === undefined) {\n        key = e.keyCode;\n      } else {\n        key = window.event.keyCode;\n      }\n      if (key === 13) {\n        console.log(\"Enter====>>>>>>\")\n        //触发的事件\n        this.queryEmployeeList();\n      }\n    },\n\n    //查询企业员工信息\n    queryEmployeeList: async function() {\n      console.log(\"=====queryEmployeeList=====\")\n      let adminname = this.formValidate.query || '';\n      if (adminname.length == 0){\n        this.$Message.error('请输入要查询人员姓名或手机号信息！');\n        return;\n      }\n\n      this.loading = true;\n      let params = {\n        ...this.formValidate,\n        sessionid: this.sessionId,\n        org_id: this.currentOrgId,\n        usercode: this.empUserCode,\n        status: 1,\n        limit: 1000\n      };\n\n      await this.$store.dispatch('employeeList', params).then(res=>{\n        this.loading = false;\n        this.tableData = [];\n        for (let item of res.rows){\n          item['role_id'] = 0;\n          this.tableData.push(item);\n        }\n\n      }).catch(err=>{\n        this.loading = false;\n      });\n\n    },\n\n    init() {\n      this.columns = dataConfig.employeeColumns;\n\n    },\n    addEmployeeToUser: async function(employee){\n\n      console.log('添加当前行---row',employee)\n      let params = {\n        merchant_id: this.$store.state.user.curMerchantId,\n        user_type: 1,\n        role_id: employee.role_id,\n        id_no: employee.id_no,\n        card_no: '',\n        ext_emp_id: employee.ext_emp_id,\n        name: employee.name,\n        c_usercode: employee.c_usercode,\n        city: employee.city,\n        phones: employee.phones,\n        ext_user_id: employee.ext_user_id,\n        org_id: employee.org_id,\n        departments: employee.departments,\n        department: employee.department_id,\n        department_name: employee.department_name,\n        usercode: employee.usercode,\n        is_admin: employee.is_admin,\n        is_wallet_admin: employee.is_wallet_admin,\n        org_name: employee.org_name,\n        emails: employee.emails,\n      };\n\n      let paramsData = [];\n      paramsData.push(params);\n\n      let Base64 = require('js-base64').Base64;\n      let details = Base64.encode(JSON.stringify(paramsData));\n\n      let reqParams = {\n        sessionid: this.$store.state.user.token,\n        user_detail: details,\n      };\n\n      try {\n        let res = await this.$store.dispatch('userAdd', reqParams);\n        if(res && _.has(res, 'return_code') && res.return_code==0){\n          this.$Message.success('添加就餐人员成功！');\n          this.$parent.query();\n          await this.$parent.getMerchantChildDepartment();\n        }\n        else{\n          this.$Message.error(\"错误码：\" + res.return_code + \", 错误信息：\" + res.return_message);\n        }\n      } catch(e) {\n        console.log(e);\n      }\n    }\n\n  },\n\n  mounted() {\n    this.init();\n\n  },\n\n}\n\n</script>\n\n<style lang='less' scoped>\n\n.ivu-table-wrapper{\n  // min-height: calc(80vh - 100px);\n  overflow: visible !important;\n}\n\n.ivu-form-item /deep/.ivu-form-item-content {\n  display: inline-block !important;\n}\n</style>\n"]}]}