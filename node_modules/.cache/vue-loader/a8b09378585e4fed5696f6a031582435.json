{"remainingRequest":"/Users/zhang/工作/pic_ad/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhang/工作/pic_ad/src/views/staff-management/dining-staff/components/modal.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhang/工作/pic_ad/src/views/staff-management/dining-staff/components/modal.vue","mtime":1638763012616},{"path":"/Users/zhang/工作/pic_ad/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/工作/pic_ad/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/zhang/工作/pic_ad/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/工作/pic_ad/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50LXRpbWV6b25lJzsKaW1wb3J0IF8gZnJvbSAndW5kZXJzY29yZSc7CmltcG9ydCBtZDUgZnJvbSAnanMtbWQ1JzsKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEgKCkgewogICAgcmV0dXJuIHsKICAgICAgdXBIZWFkZXJzOiB7CiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwnLAogICAgICB9LAogICAgICB1cEZpbGVOYW1lOiAnJywKICAgICAgdXBGaWxlU3RhdHVzOiAnJywKICAgICAgYnRuTG9hZGluZzogZmFsc2UsCiAgICAgIGZvcm1Nb2RhbDogewogICAgICAgIG9yZGVyX2RhdGU6IG1vbWVudCgpLmZvcm1hdCgnWVlZWS1NTS1ERCcpLAogICAgICAgIGdvb2RzX2lkOiAiIiwKICAgICAgfSwKICAgICAgcnVsZVNlbGVjdEZvcm06IHsKICAgICAgICBvcmRlcl9kYXRlOiBbCiAgICAgICAgICB7IHJlcXVpcmVkOiB0cnVlLCB0eXBlOiAnZGF0ZScsIG1lc3NhZ2U6ICfor7fpgInmi6nkuIvljZXml6XmnJ8nLCB0cmlnZ2VyOiAnY2hhbmdlJyB9CiAgICAgICAgXSwKICAgICAgICBnb29kc19pZDogWwogICAgICAgICAgeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+ivt+mAieaLqemkkOenjScsIHRyaWdnZXI6ICdjaGFuZ2UnIH0KICAgICAgICBdLAogICAgICB9CiAgICB9OwogIH0sCgogIGNvbXBvbmVudHM6IHt9LAoKICBjb21wdXRlZDogewogICAgc3VibWl0QmF0Y2hNb2RhbDogewogICAgICBnZXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLm9yZGVyLnN1Ym1pdEJhdGNoTW9kYWw7CiAgICAgIH0sCiAgICAgIHNldCh2YWwpIHsKICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldFN1Ym1pdEJhdGNoTW9kYWwnLCB2YWwpOwogICAgICB9CiAgICB9LAogICAgZ29vZHNMaXN0KCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUuZ29vZHMuZ29vZHNMaXN0OwogICAgfSwKICAgIHNlbGVjdGVkVXNlckxpc3QoKSB7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLnNlbGVjdGVkVXNlckxpc3Q7CiAgICB9CiAgfSwKCiAgbWV0aG9kczogewogICAgaGFuZGxlU3VibWl0ICgpIHsKCiAgICAgIHRoaXMuJHJlZnMuZm9ybU1vZGFsLnZhbGlkYXRlKCh2YWxpZCkgPT4gewogICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgdGhpcy5idG5Mb2FkaW5nID0gdHJ1ZTsKCiAgICAgICAgICAvLyBjb25zb2xlLmxvZygiLS0tLWhhbmRsZVN1Ym1pdC0tLXRoaXMudXBGaWxlTmFtZT4+PiIgKyB0aGlzLnVwRmlsZU5hbWUpOwogICAgICAgICAgaWYgKHRoaXMudXBGaWxlTmFtZS5sZW5ndGggPiAwKXsKICAgICAgICAgICAgbGV0IHBhcmFtcyA9IHsKICAgICAgICAgICAgICBmaWxlX25hbWU6IHRoaXMudXBGaWxlTmFtZSwKICAgICAgICAgICAgICBnb29kc19pZDogdGhpcy5mb3JtTW9kYWwuZ29vZHNfaWQsCiAgICAgICAgICAgICAgb3JkZXJfZGF0ZTogbW9tZW50KHRoaXMuZm9ybU1vZGFsLm9yZGVyX2RhdGUpLmZvcm1hdCgnWVlZWS1NTS1ERCcpCiAgICAgICAgICAgIH07CgogICAgICAgICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnc3VibWl0QmF0Y2hCeUZpbGUnLCBwYXJhbXMpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICBpZiAocmVzLnJldHVybl9jb2RlID09IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuYnRuTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy4kTWVzc2FnZS5zdWNjZXNzKHsKICAgICAgICAgICAgICAgICAgY29udGVudDogJ+S4i+WNleS7u+WKoeaPkOS6pOWQjuWPsOaIkOWKnyHor7fnqI3lkI7liLA86KGl5omj5LiO5YWF5YC86K6w5b2VPuS4reafpeeci+S6pOaYk+aYr+WQpuaIkOWKn++8gScsCiAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAxMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldFN1Ym1pdEJhdGNoTW9kYWwnLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB0aGlzLnVwRmlsZU5hbWUgPSAnJzsKICAgICAgICAgICAgICAgIHRoaXMudXBGaWxlU3RhdHVzID0gJyc7CiAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLnVwbG9hZEJ1dHRvbi5jbGVhckZpbGVzKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5jYXRjaChlcnIgPT4gewogICAgICAgICAgICAgIHRoaXMudXBGaWxlTmFtZSA9ICcnOwogICAgICAgICAgICAgIHRoaXMudXBGaWxlU3RhdHVzID0gJyc7CiAgICAgICAgICAgICAgdGhpcy4kcmVmcy51cGxvYWRCdXR0b24uY2xlYXJGaWxlcygpOwogICAgICAgICAgICAgIHRoaXMuYnRuTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLnVwRmlsZU5hbWUubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgbGV0IGRhdGEgPSBbXTsKICAgICAgICAgICAgZm9yKGxldCBpdGVtIG9mIHRoaXMuc2VsZWN0ZWRVc2VyTGlzdCl7CiAgICAgICAgICAgICAgbGV0IHRtcCA9IHsKICAgICAgICAgICAgICAgIHVzZXJjb2RlOiBpdGVtLnVzZXJjb2RlLAogICAgICAgICAgICAgICAgZ29vZHNfaWQ6IHRoaXMuZm9ybU1vZGFsLmdvb2RzX2lkLAogICAgICAgICAgICAgICAgb3JkZXJfZGF0ZTogbW9tZW50KHRoaXMuZm9ybU1vZGFsLm9yZGVyX2RhdGUpLmZvcm1hdCgnWVlZWS1NTS1ERCcpCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBkYXRhLnB1c2godG1wKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGRhdGEgPT0gdW5kZWZpbmVkIHx8IGRhdGEgPT0gbnVsbCB8fCBkYXRhLmxlbmd0aCA8PSAwKXsKICAgICAgICAgICAgICB0aGlzLiRNZXNzYWdlLmVycm9yKHsKICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICfor7flhYjkuIrkvKDmibnlpITnkIbmlofku7bmiJbku47lsLHppJDkurrlkZjliJfooajpgInmi6nopoHooaXmiaPkuIvljZXnmoTkurrlkZjvvIEnLAogICAgICAgICAgICAgICAgZHVyYXRpb246IDgsCiAgICAgICAgICAgICAgICBjbG9zYWJsZTogdHJ1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHRoaXMuYnRuTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGV0IHVzZXJDb2RlRGF0YSA9IF8ucGx1Y2soZGF0YSwgJ3VzZXJjb2RlJyk7CiAgICAgICAgICAgIGxldCBCYXNlNjQgPSByZXF1aXJlKCdqcy1iYXNlNjQnKS5CYXNlNjQ7CiAgICAgICAgICAgIGxldCBwYXJhbXMgPSBCYXNlNjQuZW5jb2RlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3N1Ym1pdEJhdGNoJywgcGFyYW1zKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgaWYgKHJlcy5yZXR1cm5fY29kZSA9PSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmJ0bkxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuJE1lc3NhZ2Uuc3VjY2Vzcyh7CiAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICfmibnph4/kuIvljZXmiJDlip8h6K+35YiwPOihpeaJo+S4juWFheWAvOiusOW9lT7kuK3mn6XnnIvkuqTmmJPmmK/lkKbmiJDlip/vvIEnLAogICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRTdWJtaXRCYXRjaE1vZGFsJywgZmFsc2UpOwogICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0aW9uJywgTWF0aC5yYW5kb20oKSAqIDgwICsgMTAsIHVzZXJDb2RlRGF0YS5qb2luKCcsJykpOwogICAgICAgICAgICAgICAgdGhpcy51cEZpbGVOYW1lID0gJyc7CiAgICAgICAgICAgICAgICB0aGlzLnVwRmlsZVN0YXR1cyA9ICcnOwogICAgICAgICAgICAgICAgdGhpcy4kcmVmcy51cGxvYWRCdXR0b24uY2xlYXJGaWxlcygpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuY2F0Y2goZXJyID0+IHsKICAgICAgICAgICAgICB0aGlzLmJ0bkxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KQogICAgfSwKCiAgICBoYW5kbGVVcGxvYWRTdWNjZXNzIChyZXMsIGZpbGUpIHsKICAgICAgaWYgKHJlcy5yZXR1cm5fY29kZSA9PSAwKXsKICAgICAgICB0aGlzLiRNZXNzYWdlLnN1Y2Nlc3MoIuaWh+S7tuS4iuS8oOaIkOWKn++8gSIpOwogICAgICAgIC8vIGNvbnNvbGUubG9nKCJoYW5kbGVVcGxvYWRTdWNjZXNzLS0tcmVzPj4+IiArIHJlcy5kYXRhLm5hbWUpOwogICAgICAgIHRoaXMudXBGaWxlTmFtZSA9IHJlcy5kYXRhLm5hbWU7CiAgICAgICAgdGhpcy51cEZpbGVTdGF0dXMgPSAi5paH5Lu25LiK5Lyg5oiQ5Yqf77yBIjsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICB0aGlzLiRNZXNzYWdlLmVycm9yKHJlcy5yZXR1cm5fbWVzc2FnZSk7CiAgICAgIH0KCgogICAgfSwKCiAgICBoYW5kbGVGb3JtYXRFcnJvcihmaWxlKXsKICAgICAgdGhpcy4kTm90aWNlLndhcm5pbmcoewogICAgICAgIHRpdGxlOiAn5paH5Lu25qC85byP5LiN5q2j56GuJywKICAgICAgICBkZXNjOiAn5paH5Lu2ICcgKyBmaWxlLm5hbWUgKyAnIOagvOW8j+S4jeato+ehru+8jOivt+S4iuS8oC54bHMsLnhsc3jmlofku7bjgIInCiAgICAgIH0pOwogICAgfSwKCiAgICBoYW5kbGVFcnJvcihlcnJvcixmaWxlKXsKICAgICAgdGhpcy4kTWVzc2FnZS5lcnJvcigi5pWw5o2u5a+85YWl5aSx6LSl77yBIik7CiAgICB9LAogIH0sCgogIHdhdGNoOnsKICAgIHN1Ym1pdEJhdGNoTW9kYWwodmFsKXsKICAgICAgaWYoIXZhbCl7CiAgICAgICAgdGhpcy5mb3JtTW9kYWwgPSB7CiAgICAgICAgICBvcmRlcl9kYXRlOiBuZXcgRGF0ZSgpLAogICAgICAgICAgZ29vZHNfaWQ6ICIiCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9Cgo="},{"version":3,"sources":["modal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"modal.vue","sourceRoot":"src/views/staff-management/dining-staff/components","sourcesContent":["<!-- 下单modal -->\n<template>\n  <Modal v-model=\"submitBatchModal\" title=\"批量下单\" :footer-hide=\"true\" width=\"600px\">\n    <Form ref=\"formModal\" :model=\"formModal\" :rules=\"ruleSelectForm\" :label-width=\"100\">\n      <FormItem label=\"就餐日期\" prop=\"order_date\">\n        <DatePicker type=\"date\" v-model=\"formModal.order_date\" placeholder=\"请选择下单日期\" format=\"yyyy-MM-dd\" style=\"width:200px\"></DatePicker>\n      </FormItem>\n      <FormItem label=\"餐种\" prop=\"goods_id\">\n        <Select v-model=\"formModal.goods_id\" style=\"width:200px\">\n           <Option\n            v-for=\"item in goodsList.result\"\n            :key=\"item.goods_id\"\n            placeholder=\"请选择餐种\"\n            :value=\"item.goods_id+''\">{{item.goods_name}}\n          </Option>\n        </Select>\n      </FormItem>\n      <FormItem label=\"上传下单文件\">\n        <Upload\n          ref=\"uploadButton\"\n          :on-success=\"handleUploadSuccess\"\n          :on-format-error=\"handleFormatError\"\n          :on-error=\"handleError\"\n          :format =\"['xlsx','xls']\"\n          type=\"drag\"\n          style=\"width:85%\"\n          action=\"/xdiningUpload\">\n          <div style=\"padding: 20px 0\">\n            <Icon type=\"ios-cloud-upload\" size=\"52\" style=\"color: #3399ff\"></Icon>\n            <p>点击或将文件拖拽到这里</p>\n          </div>\n        </Upload>\n\n        <p>{{upFileStatus}}</p>\n      </FormItem>\n\n      <div class=\"text-center margin-bottom-20 margin-top-30\">\n        <Button class=\"margin-right-20\" @click=\"$store.commit('setSubmitBatchModal', false)\">取消</Button>\n        <Button type=\"primary\" :loading=\"btnLoading\" @click=\"handleSubmit\">确认下单</Button>\n      </div>\n\n    </Form>\n  </Modal>\n</template>\n\n<script>\nimport moment from 'moment-timezone';\nimport _ from 'underscore';\nimport md5 from 'js-md5';\nexport default {\n  data () {\n    return {\n      upHeaders: {\n        'Content-Type': 'application/vnd.ms-excel',\n      },\n      upFileName: '',\n      upFileStatus: '',\n      btnLoading: false,\n      formModal: {\n        order_date: moment().format('YYYY-MM-DD'),\n        goods_id: \"\",\n      },\n      ruleSelectForm: {\n        order_date: [\n          { required: true, type: 'date', message: '请选择下单日期', trigger: 'change' }\n        ],\n        goods_id: [\n          { required: true, message: '请选择餐种', trigger: 'change' }\n        ],\n      }\n    };\n  },\n\n  components: {},\n\n  computed: {\n    submitBatchModal: {\n      get() {\n        return this.$store.state.order.submitBatchModal;\n      },\n      set(val) {\n        this.$store.commit('setSubmitBatchModal', val);\n      }\n    },\n    goodsList() {\n      return this.$store.state.goods.goodsList;\n    },\n    selectedUserList() {\n      return this.$store.state.user.selectedUserList;\n    }\n  },\n\n  methods: {\n    handleSubmit () {\n\n      this.$refs.formModal.validate((valid) => {\n        if (valid) {\n          this.btnLoading = true;\n\n          // console.log(\"----handleSubmit---this.upFileName>>>\" + this.upFileName);\n          if (this.upFileName.length > 0){\n            let params = {\n              file_name: this.upFileName,\n              goods_id: this.formModal.goods_id,\n              order_date: moment(this.formModal.order_date).format('YYYY-MM-DD')\n            };\n\n            this.$store.dispatch('submitBatchByFile', params).then(res => {\n              if (res.return_code == 0) {\n                this.btnLoading = false;\n                this.$Message.success({\n                  content: '下单任务提交后台成功!请稍后到<补扣与充值记录>中查看交易是否成功！',\n                  duration: 10\n                });\n                this.$store.commit('setSubmitBatchModal', false);\n                this.upFileName = '';\n                this.upFileStatus = '';\n                this.$refs.uploadButton.clearFiles();\n              }\n            }).catch(err => {\n              this.upFileName = '';\n              this.upFileStatus = '';\n              this.$refs.uploadButton.clearFiles();\n              this.btnLoading = false;\n            });\n          }\n          if (this.upFileName.length == 0) {\n            let data = [];\n            for(let item of this.selectedUserList){\n              let tmp = {\n                usercode: item.usercode,\n                goods_id: this.formModal.goods_id,\n                order_date: moment(this.formModal.order_date).format('YYYY-MM-DD')\n              };\n              data.push(tmp);\n            }\n\n            if (data == undefined || data == null || data.length <= 0){\n              this.$Message.error({\n                content: '请先上传批处理文件或从就餐人员列表选择要补扣下单的人员！',\n                duration: 8,\n                closable: true\n              });\n              this.btnLoading = false;\n              return;\n            }\n\n            let userCodeData = _.pluck(data, 'usercode');\n            let Base64 = require('js-base64').Base64;\n            let params = Base64.encode(JSON.stringify(data));\n            this.$store.dispatch('submitBatch', params).then(res => {\n              if (res.return_code == 0) {\n                this.btnLoading = false;\n                this.$Message.success({\n                  content: '批量下单成功!请到<补扣与充值记录>中查看交易是否成功！',\n                  duration: 10\n                });\n                this.$store.commit('setSubmitBatchModal', false);\n                this.$emit('selection', Math.random() * 80 + 10, userCodeData.join(','));\n                this.upFileName = '';\n                this.upFileStatus = '';\n                this.$refs.uploadButton.clearFiles();\n              }\n            }).catch(err => {\n              this.btnLoading = false;\n            });\n          }\n        }\n      })\n    },\n\n    handleUploadSuccess (res, file) {\n      if (res.return_code == 0){\n        this.$Message.success(\"文件上传成功！\");\n        // console.log(\"handleUploadSuccess---res>>>\" + res.data.name);\n        this.upFileName = res.data.name;\n        this.upFileStatus = \"文件上传成功！\";\n      }\n      else {\n        this.$Message.error(res.return_message);\n      }\n\n\n    },\n\n    handleFormatError(file){\n      this.$Notice.warning({\n        title: '文件格式不正确',\n        desc: '文件 ' + file.name + ' 格式不正确，请上传.xls,.xlsx文件。'\n      });\n    },\n\n    handleError(error,file){\n      this.$Message.error(\"数据导入失败！\");\n    },\n  },\n\n  watch:{\n    submitBatchModal(val){\n      if(!val){\n        this.formModal = {\n          order_date: new Date(),\n          goods_id: \"\"\n        }\n      }\n    }\n  }\n}\n\n</script>\n<style lang='less' scoped>\n</style>\n"]}]}