{"remainingRequest":"/Users/zhang/工作/pic_ad/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhang/工作/pic_ad/src/views/staff-management/dining-staff/components/add-employee-modal.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhang/工作/pic_ad/src/views/staff-management/dining-staff/components/add-employee-modal.vue","mtime":1638760834528},{"path":"/Users/zhang/工作/pic_ad/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/工作/pic_ad/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/zhang/工作/pic_ad/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/工作/pic_ad/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCAqIGFzIGRhdGFDb25maWcgZnJvbSAnLi4vZGF0YUNvbmZpZyc7CmltcG9ydCBtZDUgZnJvbSAnanMtbWQ1JzsKaW1wb3J0IF8gZnJvbSAndW5kZXJzY29yZSc7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ2VtcGxveWVlTW9kYWwnLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgYWRkVGV4dDogIua3u+WKoCIsCiAgICAgIGNvbHVtbnM6IFtdLAogICAgICB0YWJsZURhdGE6IFtdLAogICAgICBmb3JtVmFsaWRhdGU6IHsKICAgICAgICBxdWVyeTogJycsCiAgICAgICAgcm9sZV9pZDogdW5kZWZpbmVkLAogICAgICB9LAoKICAgIH07CiAgfSwKCiAgLy8gY3JlYXRlZCgpIHsKICAvLyAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgdGhpcy5oYW5kbGVLZXlEb3duLCB0cnVlKTsgLy/lvIDlkK/nm5HlkKzplK7nm5jmjInkuIvkuovku7YKICAvLyB9LAoKICBjb21wb25lbnRzOiB7fSwKCiAgY29tcHV0ZWQ6IHsKCiAgICBjdXJyZW50T3JnSWQoKSB7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLmN1ck9yZ0lkOwogICAgfSwKICAgIHNlc3Npb25JZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnVzZXIudG9rZW47CiAgICB9LAogICAgZW1wVXNlckNvZGUoKSB7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLmVtcFVzZXJDb2RlOwogICAgfSwKICAgIGN1cnJlbnRNZXJjaGFudElkKCl7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLmN1ck1lcmNoYW50SWQ7CiAgICB9LAogICAgY3VycmVudE1lcmNoYW50TmFtZSgpewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUudXNlci5jdXJNZXJjaGFudE5hbWU7CiAgICB9LAogICAgcm9sZUxpc3QoKXsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnJvbGUucm9sZUxpc3QucmVzdWx0OwogICAgfSwKICAgIGVtcGxveWVlTW9kYWw6ewogICAgICBnZXQoKXsKICAgICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUudXNlci5lbXBsb3llZU1vZGFsOwogICAgICB9LAogICAgICBzZXQodmFsKXsKICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldEVtcGxveWVlTW9kYWwnLCB2YWwpOwogICAgICAgIGlmICghdmFsKXsKICAgICAgICAgIHRoaXMudGFibGVEYXRhID0gW107CiAgICAgICAgICB0aGlzLmZvcm1WYWxpZGF0ZS5xdWVyeSA9ICcnOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICB9LAoKICBtZXRob2RzOiB7CiAgICBoYW5kbGVLZXlEb3duKGUpIHsKICAgICAgbGV0IGtleSA9IG51bGw7CiAgICAgIGlmICh3aW5kb3cuZXZlbnQgPT09IHVuZGVmaW5lZCkgewogICAgICAgIGtleSA9IGUua2V5Q29kZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBrZXkgPSB3aW5kb3cuZXZlbnQua2V5Q29kZTsKICAgICAgfQogICAgICBpZiAoa2V5ID09PSAxMykgewogICAgICAgIGNvbnNvbGUubG9nKCJFbnRlcj09PT0+Pj4+Pj4iKQogICAgICAgIC8v6Kem5Y+R55qE5LqL5Lu2CiAgICAgICAgdGhpcy5xdWVyeUVtcGxveWVlTGlzdCgpOwogICAgICB9CiAgICB9LAoKICAgIC8v5p+l6K+i5LyB5Lia5ZGY5bel5L+h5oGvCiAgICBxdWVyeUVtcGxveWVlTGlzdDogYXN5bmMgZnVuY3Rpb24oKSB7CiAgICAgIGNvbnNvbGUubG9nKCI9PT09PXF1ZXJ5RW1wbG95ZWVMaXN0PT09PT0iKQogICAgICBsZXQgYWRtaW5uYW1lID0gdGhpcy5mb3JtVmFsaWRhdGUucXVlcnkgfHwgJyc7CiAgICAgIGlmIChhZG1pbm5hbWUubGVuZ3RoID09IDApewogICAgICAgIHRoaXMuJE1lc3NhZ2UuZXJyb3IoJ+ivt+i+k+WFpeimgeafpeivouS6uuWRmOWnk+WQjeaIluaJi+acuuWPt+S/oeaBr++8gScpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKICAgICAgbGV0IHBhcmFtcyA9IHsKICAgICAgICAuLi50aGlzLmZvcm1WYWxpZGF0ZSwKICAgICAgICBzZXNzaW9uaWQ6IHRoaXMuc2Vzc2lvbklkLAogICAgICAgIG9yZ19pZDogdGhpcy5jdXJyZW50T3JnSWQsCiAgICAgICAgdXNlcmNvZGU6IHRoaXMuZW1wVXNlckNvZGUsCiAgICAgICAgc3RhdHVzOiAxLAogICAgICAgIGxpbWl0OiAxMDAwCiAgICAgIH07CgogICAgICBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnZW1wbG95ZWVMaXN0JywgcGFyYW1zKS50aGVuKHJlcz0+ewogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICAgIHRoaXMudGFibGVEYXRhID0gW107CiAgICAgICAgZm9yIChsZXQgaXRlbSBvZiByZXMucm93cyl7CiAgICAgICAgICBpdGVtWydyb2xlX2lkJ10gPSAwOwogICAgICAgICAgdGhpcy50YWJsZURhdGEucHVzaChpdGVtKTsKICAgICAgICB9CgogICAgICB9KS5jYXRjaChlcnI9PnsKICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CgogICAgfSwKCiAgICBpbml0KCkgewogICAgICB0aGlzLmNvbHVtbnMgPSBkYXRhQ29uZmlnLmVtcGxveWVlQ29sdW1uczsKCiAgICB9LAogICAgYWRkRW1wbG95ZWVUb1VzZXI6IGFzeW5jIGZ1bmN0aW9uKGVtcGxveWVlKXsKCiAgICAgIGNvbnNvbGUubG9nKCfmt7vliqDlvZPliY3ooYwtLS1yb3cnLGVtcGxveWVlKQogICAgICBsZXQgcGFyYW1zID0gewogICAgICAgIG1lcmNoYW50X2lkOiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLmN1ck1lcmNoYW50SWQsCiAgICAgICAgdXNlcl90eXBlOiAxLAogICAgICAgIHJvbGVfaWQ6IGVtcGxveWVlLnJvbGVfaWQsCiAgICAgICAgaWRfbm86IGVtcGxveWVlLmlkX25vLAogICAgICAgIGNhcmRfbm86ICcnLAogICAgICAgIGV4dF9lbXBfaWQ6IGVtcGxveWVlLmV4dF9lbXBfaWQsCiAgICAgICAgbmFtZTogZW1wbG95ZWUubmFtZSwKICAgICAgICBjX3VzZXJjb2RlOiBlbXBsb3llZS5jX3VzZXJjb2RlLAogICAgICAgIGNpdHk6IGVtcGxveWVlLmNpdHksCiAgICAgICAgcGhvbmVzOiBlbXBsb3llZS5waG9uZXMsCiAgICAgICAgZXh0X3VzZXJfaWQ6IGVtcGxveWVlLmV4dF91c2VyX2lkLAogICAgICAgIG9yZ19pZDogZW1wbG95ZWUub3JnX2lkLAogICAgICAgIGRlcGFydG1lbnRzOiBlbXBsb3llZS5kZXBhcnRtZW50cywKICAgICAgICBkZXBhcnRtZW50OiBlbXBsb3llZS5kZXBhcnRtZW50X2lkLAogICAgICAgIGRlcGFydG1lbnRfbmFtZTogZW1wbG95ZWUuZGVwYXJ0bWVudF9uYW1lLAogICAgICAgIHVzZXJjb2RlOiBlbXBsb3llZS51c2VyY29kZSwKICAgICAgICBpc19hZG1pbjogZW1wbG95ZWUuaXNfYWRtaW4sCiAgICAgICAgaXNfd2FsbGV0X2FkbWluOiBlbXBsb3llZS5pc193YWxsZXRfYWRtaW4sCiAgICAgICAgb3JnX25hbWU6IGVtcGxveWVlLm9yZ19uYW1lLAogICAgICAgIGVtYWlsczogZW1wbG95ZWUuZW1haWxzLAogICAgICB9OwoKICAgICAgbGV0IHBhcmFtc0RhdGEgPSBbXTsKICAgICAgcGFyYW1zRGF0YS5wdXNoKHBhcmFtcyk7CgogICAgICBsZXQgQmFzZTY0ID0gcmVxdWlyZSgnanMtYmFzZTY0JykuQmFzZTY0OwogICAgICBsZXQgZGV0YWlscyA9IEJhc2U2NC5lbmNvZGUoSlNPTi5zdHJpbmdpZnkocGFyYW1zRGF0YSkpOwoKICAgICAgbGV0IHJlcVBhcmFtcyA9IHsKICAgICAgICBzZXNzaW9uaWQ6IHRoaXMuJHN0b3JlLnN0YXRlLnVzZXIudG9rZW4sCiAgICAgICAgdXNlcl9kZXRhaWw6IGRldGFpbHMsCiAgICAgIH07CgogICAgICB0cnkgewogICAgICAgIGxldCByZXMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgndXNlckFkZCcsIHJlcVBhcmFtcyk7CiAgICAgICAgaWYocmVzICYmIF8uaGFzKHJlcywgJ3JldHVybl9jb2RlJykgJiYgcmVzLnJldHVybl9jb2RlPT0wKXsKICAgICAgICAgIHRoaXMuJE1lc3NhZ2Uuc3VjY2Vzcygn5re75Yqg5bCx6aSQ5Lq65ZGY5oiQ5Yqf77yBJyk7CiAgICAgICAgICB0aGlzLiRwYXJlbnQucXVlcnkoKTsKICAgICAgICAgIGF3YWl0IHRoaXMuJHBhcmVudC5nZXRNZXJjaGFudENoaWxkRGVwYXJ0bWVudCgpOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgdGhpcy4kTWVzc2FnZS5lcnJvcigi6ZSZ6K+v56CB77yaIiArIHJlcy5yZXR1cm5fY29kZSArICIsIOmUmeivr+S/oeaBr++8miIgKyByZXMucmV0dXJuX21lc3NhZ2UpOwogICAgICAgIH0KICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgIH0KICAgIH0KCiAgfSwKCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuaW5pdCgpOwogICAgLy8gbGV0IGRlcGFydG1lbnRJZCA9ICdGWmRrTk5Tb2Q4Ylg3SGFrWCc7CiAgICAvLyB0aGlzLnF1ZXJ5RW1wbG95ZWVMaXN0KGRlcGFydG1lbnRJZCk7CiAgfSwKCiAgLy8gZGVzdHJveWVkKCkgewogIC8vICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoImtleWRvd24iLCB0aGlzLmhhbmRsZUtleURvd24sIHRydWUpOwogIC8vIH0sCn0KCg=="},{"version":3,"sources":["add-employee-modal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"add-employee-modal.vue","sourceRoot":"src/views/staff-management/dining-staff/components","sourcesContent":["<!-- 添加独立就餐人员 -->\n<template>\n  <Modal v-model=\"employeeModal\" width=\"1020px\" :footer-hide=\"true\" title=\"添加就餐人员\">\n    <div class=\"margin-top-10\">\n      <Form inline :model=\"formValidate\" label-colon @keyup.enter.prevent=''>\n        <FormItem label=\"关键字\">\n          <Input :style=\"{width: '310px'}\" clearable @keyup.enter.native=\"queryEmployeeList\" v-model=\"formValidate.query\" placeholder=\"用户姓名/手机号/数字账号/员工ID\" />\n          <Input type=\"text\" v-show=\"false\" style=\"width: 1px;\"/>\n        </FormItem>\n        <FormItem>\n          <Button type='primary' icon=\"md-search\" @click=\"queryEmployeeList()\">查询</Button>\n        </FormItem>\n      </Form>\n    </div>\n    <div>\n      <Table border stripe :columns='columns' :data='tableData' :loading=\"loading\">\n        <template slot=\"status\" slot-scope=\"{ row }\">\n          <Tag :color=\"row.status==1?'green':'volcano'\">{{row.status == 1 ? '正常' : '已删除'}}</Tag>\n        </template>\n        <template slot=\"userroletype\" slot-scope=\"{ row }\">\n          <Select placeholder=\"人员类型\" v-model=\"row.role_id\">\n            <Option v-for=\"item in roleList\" :key=\"item.role_id\" :value=\"item.role_id\" :label=\"item.name\">{{ item.name }}</Option>\n          </Select>\n        </template>\n        <template slot=\"handle\" slot-scope=\"{ row }\">\n          <Button type=\"success\" ghost size=\"small\" @click=\"addEmployeeToUser(row)\">{{addText}}</Button>\n        </template>\n      </Table>\n    </div>\n\n  </Modal>\n</template>\n\n<script>\nimport * as dataConfig from '../dataConfig';\nimport md5 from 'js-md5';\nimport _ from 'underscore';\n\nexport default {\n  name: 'employeeModal',\n  data() {\n    return {\n      loading: false,\n      addText: \"添加\",\n      columns: [],\n      tableData: [],\n      formValidate: {\n        query: '',\n        role_id: undefined,\n      },\n\n    };\n  },\n\n  // created() {\n  //   window.addEventListener(\"keydown\", this.handleKeyDown, true); //开启监听键盘按下事件\n  // },\n\n  components: {},\n\n  computed: {\n\n    currentOrgId() {\n      return this.$store.state.user.curOrgId;\n    },\n    sessionId() {\n      return this.$store.state.user.token;\n    },\n    empUserCode() {\n      return this.$store.state.user.empUserCode;\n    },\n    currentMerchantId(){\n      return this.$store.state.user.curMerchantId;\n    },\n    currentMerchantName(){\n      return this.$store.state.user.curMerchantName;\n    },\n    roleList(){\n      return this.$store.state.role.roleList.result;\n    },\n    employeeModal:{\n      get(){\n        return this.$store.state.user.employeeModal;\n      },\n      set(val){\n        this.$store.commit('setEmployeeModal', val);\n        if (!val){\n          this.tableData = [];\n          this.formValidate.query = '';\n        }\n      }\n    },\n  },\n\n  methods: {\n    handleKeyDown(e) {\n      let key = null;\n      if (window.event === undefined) {\n        key = e.keyCode;\n      } else {\n        key = window.event.keyCode;\n      }\n      if (key === 13) {\n        console.log(\"Enter====>>>>>>\")\n        //触发的事件\n        this.queryEmployeeList();\n      }\n    },\n\n    //查询企业员工信息\n    queryEmployeeList: async function() {\n      console.log(\"=====queryEmployeeList=====\")\n      let adminname = this.formValidate.query || '';\n      if (adminname.length == 0){\n        this.$Message.error('请输入要查询人员姓名或手机号信息！');\n        return;\n      }\n\n      this.loading = true;\n      let params = {\n        ...this.formValidate,\n        sessionid: this.sessionId,\n        org_id: this.currentOrgId,\n        usercode: this.empUserCode,\n        status: 1,\n        limit: 1000\n      };\n\n      await this.$store.dispatch('employeeList', params).then(res=>{\n        this.loading = false;\n        this.tableData = [];\n        for (let item of res.rows){\n          item['role_id'] = 0;\n          this.tableData.push(item);\n        }\n\n      }).catch(err=>{\n        this.loading = false;\n      });\n\n    },\n\n    init() {\n      this.columns = dataConfig.employeeColumns;\n\n    },\n    addEmployeeToUser: async function(employee){\n\n      console.log('添加当前行---row',employee)\n      let params = {\n        merchant_id: this.$store.state.user.curMerchantId,\n        user_type: 1,\n        role_id: employee.role_id,\n        id_no: employee.id_no,\n        card_no: '',\n        ext_emp_id: employee.ext_emp_id,\n        name: employee.name,\n        c_usercode: employee.c_usercode,\n        city: employee.city,\n        phones: employee.phones,\n        ext_user_id: employee.ext_user_id,\n        org_id: employee.org_id,\n        departments: employee.departments,\n        department: employee.department_id,\n        department_name: employee.department_name,\n        usercode: employee.usercode,\n        is_admin: employee.is_admin,\n        is_wallet_admin: employee.is_wallet_admin,\n        org_name: employee.org_name,\n        emails: employee.emails,\n      };\n\n      let paramsData = [];\n      paramsData.push(params);\n\n      let Base64 = require('js-base64').Base64;\n      let details = Base64.encode(JSON.stringify(paramsData));\n\n      let reqParams = {\n        sessionid: this.$store.state.user.token,\n        user_detail: details,\n      };\n\n      try {\n        let res = await this.$store.dispatch('userAdd', reqParams);\n        if(res && _.has(res, 'return_code') && res.return_code==0){\n          this.$Message.success('添加就餐人员成功！');\n          this.$parent.query();\n          await this.$parent.getMerchantChildDepartment();\n        }\n        else{\n          this.$Message.error(\"错误码：\" + res.return_code + \", 错误信息：\" + res.return_message);\n        }\n      } catch(e) {\n        console.log(e);\n      }\n    }\n\n  },\n\n  mounted() {\n    this.init();\n    // let departmentId = 'FZdkNNSod8bX7HakX';\n    // this.queryEmployeeList(departmentId);\n  },\n\n  // destroyed() {\n  //   window.removeEventListener(\"keydown\", this.handleKeyDown, true);\n  // },\n}\n\n</script>\n\n<style lang='less' scoped>\n/deep/.ivu-modal-body{\n  min-height: 80vh;\n  .ivu-table-wrapper{\n    min-height: calc(80vh - 100px);\n  }\n}\n.ivu-form-item /deep/.ivu-form-item-content {\n  display: inline-block !important;\n}\n</style>\n"]}]}