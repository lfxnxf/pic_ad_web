{"remainingRequest":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhang/canteen_manage/src/views/common/login/login.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhang/canteen_manage/src/views/common/login/login.vue","mtime":1638355006777},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBsb2dpbk5hdiBmcm9tICdAL2NvbXBvbmVudHMvbG9naW4tbmF2JzsKaW1wb3J0IEZvcm1Db21wdXRlciBmcm9tICcuL2NvbXBvbmVudHMvZm9ybS1jb21wdXRlcic7CmltcG9ydCBfIGZyb20gJ3VuZGVyc2NvcmUnOwppbXBvcnQgeyBsb2NhbFNhdmUsIGxvY2FsUmVhZCwgc2V0Q29va2llc0l0ZW0gfSBmcm9tICdAL2xpYnMvdXRpbCc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnTG9naW4nLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBzcGluU2hvdzogZmFsc2UKICAgIH07CiAgfSwKCiAgY29tcG9uZW50czogewogICAgbG9naW5OYXYsCiAgICBGb3JtQ29tcHV0ZXIsCiAgfSwKCiAgY29tcHV0ZWQ6IHt9LAoKICBtZXRob2RzOiB7CiAgICAvLyDkvb/nlKhpY2xvdWTnmoR0b2tlbuaNouWPlueUqOaIt+S4reW/g3Nlc3Npb25pZO+8jOi/meS4qumAu+i+keaciemXrumimO+8jOS4jeiDveeUqHRva2Vu5Zyod2Vi56uv55m75b2V77yM5YW35L2T5Y6f5Zug5Li677ya6I635Y+WaWNsb3VkIHRva2Vu77yMd2Vi5peg5rOV55u05o6l5LuO5LqR6Zeo5oi36YCa6L+HY29kZeaNouWPlnRva2Vu77yM5LqR6Zeo5oi35LiN5YWB6K646Leo5Z+f77yM6ZyA6KaB5pyN5Yqh56uv55SoY29kZeaNouWPlnRva2VuCiAgICBmZXRjaEljcEFjY2Vzc1Rva2VuOiBhc3luYyBmdW5jdGlvbihjb2RlKSB7CiAgICAgIGxldCBwYXJhbXMgPSB7CiAgICAgICAgY29kZTogY29kZSwKICAgICAgfTsKICAgICAgbGV0IHVzZXJJbmZvID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2FkbWluTG9naW4nLCBwYXJhbXMpOwogICAgICBjb25zb2xlLmxvZygiZmV0Y2hJY3BBY2Nlc3NUb2tlbi0tLS0tPj4+Pj4iICsgSlNPTi5zdHJpbmdpZnkodXNlckluZm8pKQogICAgICByZXR1cm4gdXNlckluZm87CiAgICB9LAoKICAgIC8vIOWIpOaWreaYr+WQpuS4uuesrOS4ieaWueiupOivgeWbnuiwgwogICAgdGhpcmRBdXRoOiBhc3luYyBmdW5jdGlvbihhcmdzKSB7CiAgICAgIGxldCByZXN1bHQgPSB7CiAgICAgICAgcG9zOiAwLCAvLyAwLemdnuS4ieaWueiupOivge+8jDEgLSDkuInmlrnorqTor4HmiJDlip/vvIwtMSAtIOS4ieaWueiupOivgeWksei0pe+8jAogICAgICAgIG1zZzogJycsCiAgICAgICAgZGF0YToge30KICAgICAgfTsKICAgICAgdHJ5IHsKICAgICAgICBpZiAoIV8uaXNFbXB0eShhcmdzKSAmJiBfLmhhcyhhcmdzLCAnY29kZScpKSB7CiAgICAgICAgICAvLyDmoKHpqozlj4LmlbDmmK/lkKbkuLrnrKzkuInmlrnorqTor4HvvIzkuJTlj4LmlbDmmK/lkKblkIjms5UKICAgICAgICAgIHJlc3VsdC5wb3MgPSAxOwogICAgICAgICAgbGV0IHN0YXRlID0gXy5oYXMoYXJncywgJ3N0YXRlJykgJiYgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGFyZ3Muc3RhdGUpID09PSAnW29iamVjdCBTdHJpbmddJyA/IEpTT04ucGFyc2UoYXJncy5zdGF0ZSkgOiB7fTsKICAgICAgICAgIHN3aXRjaCAoc3RhdGUudHlwZSkgewogICAgICAgICAgICBjYXNlICdpY2xvdWQnOgogICAgICAgICAgICAgIGxldCBpY2xvdWRSZXMgPSBhd2FpdCB0aGlzLmZldGNoSWNwQWNjZXNzVG9rZW4oYXJncy5jb2RlKTsKICAgICAgICAgICAgICByZXN1bHQuZGF0YSA9IGljbG91ZFJlczsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHJlc3VsdC5wb3MgPSAtMTsKICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICB9LAoKICAgIC8vIOS/neWtmOacrOWcsOaVsOaNrgogICAgc2F2ZUxvY2FsOiBhc3luYyBmdW5jdGlvbih1Y1JlcykgewogICAgICBjb25zb2xlLmxvZygic2F2ZUxvY2FsID09PT4gIiwgSlNPTi5zdHJpbmdpZnkodWNSZXMpKTsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRBZG1pblJvbGUnLCB1Y1Jlcy5hZG1pbl9yb2xlKTsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRDdXJEZXBhcnRtZW50JywgdWNSZXMuZGVwYXJ0bWVudCk7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2V0Q3VyRGVwYXJ0bWVudE5hbWUnLCB1Y1Jlcy5kZXBhcnRtZW50X25hbWUpOwogICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldEN1ckVtcElkJywgdWNSZXMuZW1wX2lkKTsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRMYXN0TG9naW5UaW1lJywgdWNSZXMubGFzdF9sb2dpbl90aW1lKTsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRDdXJVc2VyTmFtZScsIHVjUmVzLm5hbWUpOwogICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldEN1ck9yZ0lkJywgdWNSZXMub3JnX2lkKTsKICAgICAgY29uc29sZS5sb2coInVjUmVzLm9yZ19pZCA9PT0+ICIsIHVjUmVzLm9yZ19pZCk7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2V0Q3VyT3JnTmFtZScsIHVjUmVzLm9yZ19uYW1lKTsKICAgICAgY29uc29sZS5sb2coInVjUmVzLm9yZ19uYW1lID09PT4gIiwgdWNSZXMub3JnX25hbWUpOwogICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldEN1clVzZXJDb2RlJywgdWNSZXMudXNlcmNvZGUpOwogICAgICBjb25zb2xlLmxvZygidWNSZXMudXNlcmNvZGUgPT09PiAiLCB1Y1Jlcy51c2VyY29kZSk7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2V0VG9rZW4nLCB1Y1Jlcy5zZXNzaW9uaWQpOwogICAgICBjb25zb2xlLmxvZygidWNSZXMuc2Vzc2lvbmlkID09PT4gIiwgdWNSZXMuc2Vzc2lvbmlkKTsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRFbXBVc2VyQ29kZScsIHVjUmVzLmNfdXNlcmNvZGUpOwogICAgICBjb25zb2xlLmxvZygidWNSZXMuY191c2VyY29kZSA9PT0+ICIsIHVjUmVzLmNfdXNlcmNvZGUpOwogICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldEN1ck1lcmNoYW50SWQnLCB1Y1Jlcy5tZXJjaGFudF9pZCk7CiAgICAgIGNvbnNvbGUubG9nKCJ1Y1Jlcy5tZXJjaGFudF9pZCA9PT0+ICIsIHVjUmVzLm1lcmNoYW50X2lkKTsKICAgICAgdWNSZXMubWVyY2hhbnRfbmFtZSA9IHVjUmVzLm1lcmNoYW50X2lkP3VjUmVzLm1lcmNoYW50X25hbWU6J+euoeeQhuWRmCc7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2V0Q3VyTWVyY2hhbnROYW1lJywgdWNSZXMubWVyY2hhbnRfbmFtZSk7CiAgICAgIGNvbnNvbGUubG9nKCJ1Y1Jlcy5tZXJjaGFudF9uYW1lID09PT4gIiwgdWNSZXMubWVyY2hhbnRfbmFtZSk7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2V0Q3VyTWVyY2hhbnRVc2VyQ29kZScsIHVjUmVzLm1lcmNoYW50X2NvZGUpOwogICAgICBjb25zb2xlLmxvZygidWNSZXMubWVyY2hhbnRfdXNlcmNvZGUgPT09PiAiLCB1Y1Jlcy5tZXJjaGFudF9jb2RlKTsKICAgIH0sCgogIH0sCgogIGFzeW5jIG1vdW50ZWQoKSB7CiAgICAvLyBjb25zb2xlLmxvZygndGhpcy4kcm91dGUucXVlcnkgPT09PT4gJywgdGhpcy4kcm91dGUucXVlcnkpCiAgICBsZXQgYXJncyA9IHRoaXMuJHJvdXRlLnF1ZXJ5OwoKICAgIGlmIChfLmlzRW1wdHkoYXJncykpCiAgICAgIHJldHVybjsKCiAgICB0cnkgewogICAgICBsZXQgdGhpcmRBdXRoUmVzID0gYXdhaXQgdGhpcy50aGlyZEF1dGgoYXJncyk7CiAgICAgIGxldCB1Y1JlcyA9IHt9OwogICAgICAKICAgICAgc3dpdGNoICh0aGlyZEF1dGhSZXMucG9zKSB7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgdGhpcy5zcGluU2hvdyA9IHRydWU7CiAgICAgICAgICBpZiAodGhpcmRBdXRoUmVzLmRhdGEuZGF0YSA9PT0gInt9Iil7CiAgICAgICAgICAgIGxldCBtc2cgPSAn6K6k6K+B5byC5bi4JzsKICAgICAgICAgICAgdGhpcy4kTWVzc2FnZS5lcnJvcih7CiAgICAgICAgICAgICAgY29udGVudDogbXNnLAogICAgICAgICAgICAgIGR1cmF0aW9uOiAxMCwKICAgICAgICAgICAgICBjbG9zYWJsZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy4kcm91dGVyLnJlcGxhY2Uoe3BhdGg6Jy9sb2dpbid9KTsKICAgICAgICAgIH0KCiAgICAgICAgICB1Y1JlcyA9IHRoaXJkQXV0aFJlcy5kYXRhLmRhdGE7CiAgICAgICAgICB0aGlzLnNhdmVMb2NhbCh1Y1Jlcyk7CgogICAgICAgICAgbGV0IGlzQWRtaW4gPSBmYWxzZTsKICAgICAgICAgIHRoaXMuc3BpblNob3cgPSBmYWxzZTsKICAgICAgICAgIGlmICh1Y1Jlcy5hZG1pbl9yb2xlID09PSAic3VwZXJ2aXNvcl9hZG1pbiIpIHsKICAgICAgICAgICAgaXNBZG1pbiA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuJE1lc3NhZ2Uuc3VjY2Vzcygn55m75b2V5oiQ5YqfJyk7CiAgICAgICAgICAgIHRoaXMuc3BpblNob3cgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goe3BhdGg6ICcvYnVzaW5lc3MtaW5mb3JtYXRpb24vYmFzaWMtaW5mb3JtYXRpb24nfSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodWNSZXMuYWRtaW5fcm9sZSA9PT0gIm1lcmNoYW50X2FkbWluIikgewogICAgICAgICAgICBpc0FkbWluID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy4kTWVzc2FnZS5zdWNjZXNzKCfnmbvlvZXmiJDlip8nKTsKICAgICAgICAgICAgdGhpcy5zcGluU2hvdyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7cGF0aDogJy9idXNpbmVzcy1pbmZvcm1hdGlvbi9iYXNpYy1pbmZvcm1hdGlvbid9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWlzQWRtaW4pewogICAgICAgICAgICB0aGlzLnNwaW5TaG93ID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuJE1lc3NhZ2Uuc3VjY2Vzcygn55m75b2V5aSx6LSlJyk7CiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5yZXBsYWNlKHtwYXRoOiAnL2xvZ2luJ30pOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAtMToKICAgICAgICAgIHRoaXMuJE1lc3NhZ2UuZXJyb3IoJ+eZu+W9leWksei0pSEhJyk7CiAgICAgICAgICB0aGlzLiRyb3V0ZXIucmVwbGFjZSh7cGF0aDogJy9sb2dpbid9KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aGlzLiRNZXNzYWdlLmVycm9yKCfnmbvlvZXlpLHotKUhJyk7CiAgICAgICAgICB0aGlzLiRyb3V0ZXIucmVwbGFjZSh7cGF0aDogJy9sb2dpbid9KTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgfSBjYXRjaCAoZSkgewogICAgICBjb25zb2xlLmxvZyhlKTsKICAgIH0KICB9Cn0K"},{"version":3,"sources":["login.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAkBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"login.vue","sourceRoot":"src/views/common/login","sourcesContent":["<!--  -->\n<template>\n  <div class=\"login loginV2\">\n    <Spin class=\"login_spin\" size=\"large\" fix v-if=\"spinShow\">\n      <Icon type=\"ios-loading\" size=18 class=\"demo-spin-icon-load\"></Icon>\n      <div class=\"margin-top-10 font-size16\">登录中</div>\n    </Spin>\n    <login-nav></login-nav>\n    <div class=\"content\">\n      <div class=\"mask\"></div>\n      <div class=\"form_wrapper\">\n        <img src=\"@/assets/images/login_bg.jpg\" alt=\"\">\n        <form-computer class=\"form-computer\"></form-computer>\n      </div>\n    </div>\n  </div>\n</template>\n<script>\nimport loginNav from '@/components/login-nav';\nimport FormComputer from './components/form-computer';\nimport _ from 'underscore';\nimport { localSave, localRead, setCookiesItem } from '@/libs/util';\nexport default {\n  name: 'Login',\n  data() {\n    return {\n      spinShow: false\n    };\n  },\n\n  components: {\n    loginNav,\n    FormComputer,\n  },\n\n  computed: {},\n\n  methods: {\n    // 使用icloud的token换取用户中心sessionid，这个逻辑有问题，不能用token在web端登录，具体原因为：获取icloud token，web无法直接从云门户通过code换取token，云门户不允许跨域，需要服务端用code换取token\n    fetchIcpAccessToken: async function(code) {\n      let params = {\n        code: code,\n      };\n      let userInfo = await this.$store.dispatch('adminLogin', params);\n      console.log(\"fetchIcpAccessToken----->>>>>\" + JSON.stringify(userInfo))\n      return userInfo;\n    },\n\n    // 判断是否为第三方认证回调\n    thirdAuth: async function(args) {\n      let result = {\n        pos: 0, // 0-非三方认证，1 - 三方认证成功，-1 - 三方认证失败，\n        msg: '',\n        data: {}\n      };\n      try {\n        if (!_.isEmpty(args) && _.has(args, 'code')) {\n          // 校验参数是否为第三方认证，且参数是否合法\n          result.pos = 1;\n          let state = _.has(args, 'state') && Object.prototype.toString.call(args.state) === '[object String]' ? JSON.parse(args.state) : {};\n          switch (state.type) {\n            case 'icloud':\n              let icloudRes = await this.fetchIcpAccessToken(args.code);\n              result.data = icloudRes;\n              break;\n            default:\n              break;\n          }\n        }\n        return result;\n      } catch (e) {\n        result.pos = -1;\n        console.log(e);\n        return result;\n      }\n    },\n\n    // 保存本地数据\n    saveLocal: async function(ucRes) {\n      console.log(\"saveLocal ===> \", JSON.stringify(ucRes));\n      this.$store.commit('setAdminRole', ucRes.admin_role);\n      this.$store.commit('setCurDepartment', ucRes.department);\n      this.$store.commit('setCurDepartmentName', ucRes.department_name);\n      this.$store.commit('setCurEmpId', ucRes.emp_id);\n      this.$store.commit('setLastLoginTime', ucRes.last_login_time);\n      this.$store.commit('setCurUserName', ucRes.name);\n      this.$store.commit('setCurOrgId', ucRes.org_id);\n      console.log(\"ucRes.org_id ===> \", ucRes.org_id);\n      this.$store.commit('setCurOrgName', ucRes.org_name);\n      console.log(\"ucRes.org_name ===> \", ucRes.org_name);\n      this.$store.commit('setCurUserCode', ucRes.usercode);\n      console.log(\"ucRes.usercode ===> \", ucRes.usercode);\n      this.$store.commit('setToken', ucRes.sessionid);\n      console.log(\"ucRes.sessionid ===> \", ucRes.sessionid);\n      this.$store.commit('setEmpUserCode', ucRes.c_usercode);\n      console.log(\"ucRes.c_usercode ===> \", ucRes.c_usercode);\n      this.$store.commit('setCurMerchantId', ucRes.merchant_id);\n      console.log(\"ucRes.merchant_id ===> \", ucRes.merchant_id);\n      ucRes.merchant_name = ucRes.merchant_id?ucRes.merchant_name:'管理员';\n      this.$store.commit('setCurMerchantName', ucRes.merchant_name);\n      console.log(\"ucRes.merchant_name ===> \", ucRes.merchant_name);\n      this.$store.commit('setCurMerchantUserCode', ucRes.merchant_code);\n      console.log(\"ucRes.merchant_usercode ===> \", ucRes.merchant_code);\n    },\n\n  },\n\n  async mounted() {\n    // console.log('this.$route.query ====> ', this.$route.query)\n    let args = this.$route.query;\n\n    if (_.isEmpty(args))\n      return;\n\n    try {\n      let thirdAuthRes = await this.thirdAuth(args);\n      let ucRes = {};\n      \n      switch (thirdAuthRes.pos) {\n        case 1:\n          this.spinShow = true;\n          if (thirdAuthRes.data.data === \"{}\"){\n            let msg = '认证异常';\n            this.$Message.error({\n              content: msg,\n              duration: 10,\n              closable: true\n            });\n            this.$router.replace({path:'/login'});\n          }\n\n          ucRes = thirdAuthRes.data.data;\n          this.saveLocal(ucRes);\n\n          let isAdmin = false;\n          this.spinShow = false;\n          if (ucRes.admin_role === \"supervisor_admin\") {\n            isAdmin = true;\n            this.$Message.success('登录成功');\n            this.spinShow = false;\n            this.$router.push({path: '/business-information/basic-information'});\n          }\n          if (ucRes.admin_role === \"merchant_admin\") {\n            isAdmin = true;\n            this.$Message.success('登录成功');\n            this.spinShow = false;\n            this.$router.push({path: '/business-information/basic-information'});\n          }\n\n          if (!isAdmin){\n            this.spinShow = false;\n            this.$Message.success('登录失败');\n            this.$router.replace({path: '/login'});\n          }\n          break;\n        case -1:\n          this.$Message.error('登录失败!!');\n          this.$router.replace({path: '/login'});\n          break;\n        default:\n          this.$Message.error('登录失败!');\n          this.$router.replace({path: '/login'});\n          break;\n      }\n\n    } catch (e) {\n      console.log(e);\n    }\n  }\n}\n</script>\n<style lang='less' scoped>\n@import './style';\n</style>\n"]}]}