{"remainingRequest":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhang/canteen_manage/src/views/setting/role-setting/components/add-role-food-modal.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhang/canteen_manage/src/views/setting/role-setting/components/add-role-food-modal.vue","mtime":1638355006802},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCAqIGFzIGRhdGFDb25maWcgZnJvbSAnLi4vZGF0YUNvbmZpZyc7CmltcG9ydCBtZDUgZnJvbSAnanMtbWQ1JzsKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBidG5Mb2FkaW5nOiBmYWxzZSwKICAgICAgaXNFZGl0OiBmYWxzZSwKICAgICAgY29sdW1uczogW10sCiAgICAgIHJvbGVfaWQ6ICcnLAogICAgICB0YWJsZURhdGE6W10KICAgIH07CiAgfSwKCiAgY29tcG9uZW50czoge30sCgogIGNvbXB1dGVkOiB7CiAgICByb2xlRm9vZE1vZGFsOnsKICAgICAgZ2V0KCl7CiAgICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnJvbGUucm9sZUZvb2RNb2RhbDsKICAgICAgfSwKICAgICAgc2V0KHZhbCl7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRSb2xlRm9vZE1vZGFsJywgdmFsKQogICAgICB9CiAgICB9LAogICAgY3VycmVudFJvbGVGb29kRGF0YSgpewogICAgICB0aGlzLnRhYmxlRGF0YSA9IHRoaXMuJHN0b3JlLnN0YXRlLnJvbGUuY3VycmVudFJvbGVGb29kRGF0YS5nb29kczsKICAgICAgdGhpcy5yb2xlX2lkID0gdGhpcy4kc3RvcmUuc3RhdGUucm9sZS5jdXJyZW50Um9sZUZvb2REYXRhLnJvbGVfaWQ7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5yb2xlLmN1cnJlbnRSb2xlRm9vZERhdGE7CiAgICB9LAogICAgLy/ppJDnp43liJfooagKICAgIGZvb2RMaXN0KCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUuZ29vZHMuZm9vZExpc3Q7CiAgICB9LAogIH0sCgogIG1ldGhvZHM6IHsKICAgIGluaXREYXRhKCkgewogICAgICB0aGlzLmNvbHVtbnMgPSBkYXRhQ29uZmlnLnJvbGVGb29kQ29sdW1uczsKICAgIH0sCgogICAgaGFuZGxlU2F2ZSgpewogICAgICB0aGlzLmJ0bkxvYWRpbmcgPSB0cnVlOwogICAgICBsZXQgcGFyYW1zID0gW107CiAgICAgIGZvciAobGV0IGl0ZW0gb2YgdGhpcy50YWJsZURhdGEpewogICAgICAgIC8v5aaC5p6c5piv5paw5aKe5oiW5L+u5pS577yM5bCG5pyJ5pWI5pWw5o2u5Yqg5YWlCiAgICAgICAgaWYgKGl0ZW0ucm9sZV9zdGF0dXMpewogICAgICAgICAgLy8gbGV0IHJlZyA9L1teXGRcLl0vOy9eKChbMS05XVxkezAsM30pfDApKFwuXGR7MCwyfSk/JC87CiAgICAgICAgICBsZXQgcmVnID0gL14oKFsxLTldXGR7MCwzfSl8MCkoXC5cZHswLDJ9KT8kLzsKICAgICAgICAgIGlmICghcmVnLnRlc3QoaXRlbS5wcmljZSkpewogICAgICAgICAgICB0aGlzLiRNZXNzYWdlLmVycm9yKCdbJyArIGl0ZW0uZ29vZHNfbmFtZSArICdd6aSQ56eN5Lu35qC85qC85byP5LiN5q2j56Gu77yBJyk7CiAgICAgICAgICAgIHRoaXMuYnRuTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBsZXQgZGF0YUl0ZW0gPSB7CiAgICAgICAgICAgIG1lcmNoYW50X2lkOiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLmN1ck1lcmNoYW50SWQsCiAgICAgICAgICAgIHJvbGVfaWQ6IHRoaXMucm9sZV9pZCwKICAgICAgICAgICAgZ29vZHNfaWQ6IGl0ZW0uZ29vZHNfaWQsCiAgICAgICAgICAgIHByaWNlOiBpdGVtLnByaWNlLAogICAgICAgICAgICBtZW51X2lkOiBpdGVtLm1lbnVfaWQsCiAgICAgICAgICAgIGlzX2RlbDogMAogICAgICAgICAgfQogICAgICAgICAgcGFyYW1zLnB1c2goZGF0YUl0ZW0pOwogICAgICAgIH0KICAgICAgICBlbHNley8v5aaC5p6c5piv5peg5pWI5pWw5o2u77yM5Yik5patbWVudV9pZOaYr+WQpuS4uuepuu+8jOS4jeS4uuepuuWwseaYr+WIoOmZpOaVsOaNrgogICAgICAgICAgaWYgKGl0ZW0ubWVudV9pZCAhPSBudWxsKXsKICAgICAgICAgICAgbGV0IGRhdGFJdGVtID0gewogICAgICAgICAgICAgIG1lcmNoYW50X2lkOiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLmN1ck1lcmNoYW50SWQsCiAgICAgICAgICAgICAgcm9sZV9pZDogdGhpcy5yb2xlX2lkLAogICAgICAgICAgICAgIGdvb2RzX2lkOiBpdGVtLmdvb2RzX2lkLAogICAgICAgICAgICAgIHByaWNlOiBpdGVtLnByaWNlLAogICAgICAgICAgICAgIG1lbnVfaWQ6IGl0ZW0ubWVudV9pZCwKICAgICAgICAgICAgICBpc19kZWw6IDEKICAgICAgICAgICAgfQogICAgICAgICAgICBwYXJhbXMucHVzaChkYXRhSXRlbSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBsZXQgQmFzZTY0ID0gcmVxdWlyZSgnanMtYmFzZTY0JykuQmFzZTY0OwogICAgICBsZXQgZGF0YSA9IEJhc2U2NC5lbmNvZGUoSlNPTi5zdHJpbmdpZnkocGFyYW1zKSkKCiAgICAgIC8vIGxldCBzdHIxID0gQmFzZTY0LmRlY29kZShkYXRhKQogICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnc2V0Um9sZUZvb2QnLCBkYXRhKS50aGVuKHJlcz0+ewogICAgICAgIGlmKHJlcy5yZXR1cm5fY29kZT09MCl7CiAgICAgICAgICB0aGlzLmJ0bkxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuJE1lc3NhZ2Uuc3VjY2Vzcygn57yW6L6R5oiQ5Yqf77yBJyk7CiAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldFJvbGVGb29kTW9kYWwnLCBmYWxzZSk7CiAgICAgICAgICB0aGlzLnF1ZXJ5Um9sZUZvb2RMaXN0KCk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChlcnI9PnsKICAgICAgICB0aGlzLmJ0bkxvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAoKICAgIG9uQ2hhbmdlSXRlbShldnQsIGdvb2RzX2lkKXsKICAgICAgZm9yIChsZXQgaXRlbSBvZiB0aGlzLnRhYmxlRGF0YSl7CiAgICAgICAgaWYgKGl0ZW0uZ29vZHNfaWQgPT0gZ29vZHNfaWQpewogICAgICAgICAgaXRlbS5wcmljZSA9IGV2dC50YXJnZXQudmFsdWU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBvblN0YXR1c0NoYW5nZShldnQsIGdvb2RzX2lkKXsKICAgICAgZm9yIChsZXQgaXRlbSBvZiB0aGlzLnRhYmxlRGF0YSl7CiAgICAgICAgaWYgKGl0ZW0uZ29vZHNfaWQgPT0gZ29vZHNfaWQpewogICAgICAgICAgaXRlbS5yb2xlX3N0YXR1cyA9IGV2dDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvL+iOt+WPluS6uuWRmOexu+Wei+mFjee9rumkkOenjeWIl+ihqAogICAgcXVlcnlSb2xlRm9vZExpc3QocGFnZSwgcGFnZV9zaXplKSB7CiAgICAgIGxldCBwYXJhbXMgPSB7CiAgICAgICAgbWVyY2hhbnRfaWQ6IHRoaXMuJHN0b3JlLnN0YXRlLnVzZXIuY3VyTWVyY2hhbnRJZCwKICAgICAgICAvLyByb2xlX2lkOiAnJywKICAgICAgICBwYWdlOiBwYWdlIHx8IDEsCiAgICAgICAgcGFnZV9zaXplOiBwYWdlX3NpemUgfHwgdGhpcy4kcGFyZW50LnBhZ2Vfc2l6ZQogICAgICB9OwogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2dldFJvbGVGb29kTGlzdCcsIHBhcmFtcyk7CiAgICB9LAogICAgZ2V0R29vZHNMaXN0OiBhc3luYyBmdW5jdGlvbihwYWdlLCBwYWdlX3NpemUpIHsKICAgICAgbGV0IHBhcmFtcyA9IHsKICAgICAgICBtZXJjaGFudF9pZDogdGhpcy4kc3RvcmUuc3RhdGUudXNlci5jdXJNZXJjaGFudElkLAogICAgICAgIHBhZ2U6IDEsCiAgICAgICAgcGFnZV9zaXplOiAyMDAwMCwKICAgICAgICBpc19lbmFibGU6IDEKICAgICAgfTsKICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2dvb2RzTGlzdCcsIHBhcmFtcyk7CiAgICB9LAoKICB9LAoKICBtb3VudGVkKCl7CiAgICB0aGlzLmluaXREYXRhKCk7CiAgfSwKCiAgd2F0Y2g6IHsKICAgIHJvbGVGb29kTW9kYWwodmFsKXsgICAKICAgICAgaWYodmFsKXsKICAgICAgICB0aGlzLmdldEdvb2RzTGlzdCgpOwogICAgICB9ZWxzZXsKICAgICAgICB0aGlzLmJ0bkxvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgfQogIH0KfTsK"},{"version":3,"sources":["add-role-food-modal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"add-role-food-modal.vue","sourceRoot":"src/views/setting/role-setting/components","sourcesContent":["<!-- 配置人员类型餐种 -->\n<template>\n  <Modal v-model=\"roleFoodModal\" width=\"520px\" :footer-hide=\"true\">\n    <div>\n      <div>\n        <div class=\"margin-top-20 margin-bottom-15\">人员类型名称：<span class=\"font-blod\">{{currentRoleFoodData.role_name}}</span></div>\n        <Table border :columns=\"columns\" :data=\"tableData\">\n          <template slot=\"role_status\" slot-scope=\"{ row }\">\n            <i-switch v-model=\"row.role_status\" size=\"large\" @on-change=\"onStatusChange($event, row.goods_id)\">\n              <span slot=\"1\">开启</span>\n              <span slot=\"0\">关闭</span>\n            </i-switch>\n          </template>\n          <template slot=\"parice\" slot-scope=\"{ row }\">\n            <Input v-model=\"row.price\" @on-change=\"onChangeItem($event, row.goods_id)\" :disabled=\"!row.role_status\"/>\n          </template>\n        </Table>\n        <div class=\"gray-bg border-top-0 text-center padding-top-10 padding-bottom-10\">\n          <Button class=\"margin-right-20\" @click=\"$store.commit('setRoleFoodModal', false)\">返回</Button>\n          <Button type=\"primary\" :loading=\"btnLoading\" @click=\"handleSave\">提交</Button>\n        </div>\n      </div>\n    </div>\n  </Modal>\n</template>\n\n<script>\nimport * as dataConfig from '../dataConfig';\nimport md5 from 'js-md5';\nexport default {\n  data() {\n    return {\n      btnLoading: false,\n      isEdit: false,\n      columns: [],\n      role_id: '',\n      tableData:[]\n    };\n  },\n\n  components: {},\n\n  computed: {\n    roleFoodModal:{\n      get(){\n        return this.$store.state.role.roleFoodModal;\n      },\n      set(val){\n        this.$store.commit('setRoleFoodModal', val)\n      }\n    },\n    currentRoleFoodData(){\n      this.tableData = this.$store.state.role.currentRoleFoodData.goods;\n      this.role_id = this.$store.state.role.currentRoleFoodData.role_id;\n      return this.$store.state.role.currentRoleFoodData;\n    },\n    //餐种列表\n    foodList() {\n      return this.$store.state.goods.foodList;\n    },\n  },\n\n  methods: {\n    initData() {\n      this.columns = dataConfig.roleFoodColumns;\n    },\n\n    handleSave(){\n      this.btnLoading = true;\n      let params = [];\n      for (let item of this.tableData){\n        //如果是新增或修改，将有效数据加入\n        if (item.role_status){\n          // let reg =/[^\\d\\.]/;/^(([1-9]\\d{0,3})|0)(\\.\\d{0,2})?$/;\n          let reg = /^(([1-9]\\d{0,3})|0)(\\.\\d{0,2})?$/;\n          if (!reg.test(item.price)){\n            this.$Message.error('[' + item.goods_name + ']餐种价格格式不正确！');\n            this.btnLoading = false;\n            return;\n          }\n          let dataItem = {\n            merchant_id: this.$store.state.user.curMerchantId,\n            role_id: this.role_id,\n            goods_id: item.goods_id,\n            price: item.price,\n            menu_id: item.menu_id,\n            is_del: 0\n          }\n          params.push(dataItem);\n        }\n        else{//如果是无效数据，判断menu_id是否为空，不为空就是删除数据\n          if (item.menu_id != null){\n            let dataItem = {\n              merchant_id: this.$store.state.user.curMerchantId,\n              role_id: this.role_id,\n              goods_id: item.goods_id,\n              price: item.price,\n              menu_id: item.menu_id,\n              is_del: 1\n            }\n            params.push(dataItem);\n          }\n        }\n      }\n\n      let Base64 = require('js-base64').Base64;\n      let data = Base64.encode(JSON.stringify(params))\n\n      // let str1 = Base64.decode(data)\n      this.$store.dispatch('setRoleFood', data).then(res=>{\n        if(res.return_code==0){\n          this.btnLoading = false;\n          this.$Message.success('编辑成功！');\n          this.$store.commit('setRoleFoodModal', false);\n          this.queryRoleFoodList();\n        }\n      }).catch(err=>{\n        this.btnLoading = false;\n      });\n    },\n\n    onChangeItem(evt, goods_id){\n      for (let item of this.tableData){\n        if (item.goods_id == goods_id){\n          item.price = evt.target.value;\n          break;\n        }\n      }\n    },\n    onStatusChange(evt, goods_id){\n      for (let item of this.tableData){\n        if (item.goods_id == goods_id){\n          item.role_status = evt;\n          break;\n        }\n      }\n    },\n\n    //获取人员类型配置餐种列表\n    queryRoleFoodList(page, page_size) {\n      let params = {\n        merchant_id: this.$store.state.user.curMerchantId,\n        // role_id: '',\n        page: page || 1,\n        page_size: page_size || this.$parent.page_size\n      };\n      return this.$store.dispatch('getRoleFoodList', params);\n    },\n    getGoodsList: async function(page, page_size) {\n      let params = {\n        merchant_id: this.$store.state.user.curMerchantId,\n        page: 1,\n        page_size: 20000,\n        is_enable: 1\n      };\n      await this.$store.dispatch('goodsList', params);\n    },\n\n  },\n\n  mounted(){\n    this.initData();\n  },\n\n  watch: {\n    roleFoodModal(val){   \n      if(val){\n        this.getGoodsList();\n      }else{\n        this.btnLoading = false;\n      }\n    }\n  }\n};\n</script>\n<style lang='less' scoped>\n@import '../style';\n/deep/.ivu-input{\n  text-align: right;\n}\n\n</style>\n"]}]}