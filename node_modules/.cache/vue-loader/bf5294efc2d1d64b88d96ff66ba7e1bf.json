{"remainingRequest":"/Users/zhang/工作/pic_ad/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhang/工作/pic_ad/src/views/setting/role-setting/components/table.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhang/工作/pic_ad/src/views/setting/role-setting/components/table.vue","mtime":1638516298157},{"path":"/Users/zhang/工作/pic_ad/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/工作/pic_ad/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/zhang/工作/pic_ad/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/工作/pic_ad/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCAqIGFzIGRhdGFDb25maWcgZnJvbSAnLi4vZGF0YUNvbmZpZyc7CmltcG9ydCBfIGZyb20gInVuZGVyc2NvcmUiOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdTZWFyY2hUYWJsZScsCiAgLy8gcHJvcHM6IHsKICAvLyAgIHZhbHVlOiBBcnJheQogIC8vIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNvbHVtbnM6IFtdLAoKICAgIH07CiAgfSwKCiAgY29tcG9uZW50czoge30sCgogIGNvbXB1dGVkOiB7CiAgICBjdXJNZXJjaGFudElkKCl7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLmN1ck1lcmNoYW50SWQ7CiAgICB9LAogICAgcm9sZUxpc3QoKSB7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5yb2xlLnJvbGVMaXN0OwogICAgfSwKICAgIGxvYWRpbmcoKSB7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5hcHAudGFibGVMb2FkaW5nOwogICAgfSwKICAgIEdvb2RzTGlzdCgpIHsKICAgICAgcmV0dXJuIF8uZmlsdGVyKHRoaXMuJHN0b3JlLnN0YXRlLmdvb2RzLmdvb2RzTGlzdC5yZXN1bHQsIGN1ciA9PiB7cmV0dXJuIGN1ci5pc19lbmFibGUgPT09IDE7fSk7CiAgICB9LAogICAgUm9sZUdvb2RzTGlzdCgpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnJvbGUucm9sZUdvb2RzTGlzdC5yZXN1bHQ7CiAgICB9LAoKICB9LAoKICBhc3luYyBtb3VudGVkKCkgewogICAgdGhpcy5pbml0KCk7CiAgICBhd2FpdCB0aGlzLnF1ZXJ5R29vZHNMaXN0KCk7CiAgICBhd2FpdCB0aGlzLnF1ZXJ5Um9sZUdvb2RzTGlzdCgpOwogIH0sCgogIG1ldGhvZHM6IHsKICAgIGluaXQoKSB7CiAgICAgIHRoaXMuY29sdW1ucyA9IGRhdGFDb25maWcuY29sdW1uczsKICAgIH0sCiAgICBoYW5kbGVFZGl0KHJvdyl7CiAgICAgIGxldCBkYXRhID0gewogICAgICAgIHJvbGVfaWQ6IHJvdy5yb2xlX2lkLAogICAgICAgIG5hbWU6IHJvdy5uYW1lLAogICAgICAgIGlzX2VuYWJsZTogcm93LmlzX2VuYWJsZS50b1N0cmluZygpLAogICAgICB9CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2V0RWRpdFJvbGVNb2RhbCcsIHRydWUpOwogICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1NFVFJPTEVDVVJSRU5UREFUQScsIGRhdGEpOwogICAgfSwKCiAgICBoYW5kbGVSb2xlR29vZHMocm93KXsKICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgcm9sZV9pZDogcm93LnJvbGVfaWQsCiAgICAgICAgcm9sZV9uYW1lOiByb3cubmFtZSwKICAgICAgICBnb29kczogW10sCiAgICAgIH07CgogICAgICAvLyBjb25zb2xlLmxvZygiaGFuZGxlUm9sZUdvb2RzPT09b3V0Pj4+IiArIEpTT04uc3RyaW5naWZ5KHRoaXMuZ2V0Q3VycmVudFJvbGVHb29kcyhkYXRhLnJvbGVfaWQpKSkKICAgICAgLy8g5aSE55CG5Lq65ZGY57G75Z6L6YWN572u6I+c5Y2VCiAgICAgIGlmIChKU09OLnN0cmluZ2lmeSh0aGlzLmdldEN1cnJlbnRSb2xlR29vZHMoZGF0YS5yb2xlX2lkKSkgPT0gJ1tdJyl7CiAgICAgICAgY29uc29sZS5sb2coImhhbmRsZVJvbGVHb29kcz09PT4+PiIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLmdldEN1cnJlbnRSb2xlR29vZHMoZGF0YS5yb2xlX2lkKSkpCiAgICAgICAgZm9yIChsZXQgaXRlbSBvZiB0aGlzLkdvb2RzTGlzdCl7CiAgICAgICAgICBsZXQgZGF0YUl0ZW0gPSB7CiAgICAgICAgICAgIC8vIG1lbnVfaWQ6IG51bGwsCiAgICAgICAgICAgIGdvb2RzX2lkOiBudWxsLAogICAgICAgICAgICBnb29kc19uYW1lOiAnJywKICAgICAgICAgICAgcHJpY2U6ICcnLAogICAgICAgICAgICByb2xlX3N0YXR1czogZmFsc2UKICAgICAgICAgIH07CiAgICAgICAgICBkYXRhSXRlbS5nb29kc19pZCA9IGl0ZW0uZ29vZHNfaWQ7CiAgICAgICAgICBkYXRhSXRlbS5nb29kc19uYW1lID0gaXRlbS5nb29kc19uYW1lOwoKICAgICAgICAgIGRhdGEuZ29vZHMucHVzaChkYXRhSXRlbSk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBlbHNlewogICAgICAgIC8v5aaC5p6c5b2T5YmN5Lq65ZGY57G75Z6L5pyJ6YWN572u5bCx6aSQ5L+h5oGv77yM5YiZ5Yid5aeL5YyW5Lyg6YCB6L+H5Y6755qE5pWw5o2uCiAgICAgICAgbGV0IHJvbGVHb29kcyA9IHRoaXMuZ2V0Q3VycmVudFJvbGVHb29kcyhkYXRhLnJvbGVfaWQpOwoKICAgICAgICAvLyBjb25zb2xlLmxvZygiPT09PnJvbGVHb29kcz09PXJvbGVHb29kczoiICsgSlNPTi5zdHJpbmdpZnkocm9sZUdvb2RzKSk7CiAgICAgICAgbGV0IGlzRmluZCA9IDA7CgogICAgICAgIGZvciAobGV0IGl0ZW0gb2YgdGhpcy5Hb29kc0xpc3QpCiAgICAgICAgewogICAgICAgICAgLy8gY29uc29sZS5sb2coIj09PT5Hb29kc0xpc3Q9PT1nb29kczoiICsgSlNPTi5zdHJpbmdpZnkodGhpcy5Hb29kc0xpc3QpKTsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCI9PT0+R29vZHNMaXN0PT09Z29vZGlkOiIgKyBpdGVtLmdvb2RzX2lkICsgIiwgZ29vZHNuYW1lOiIgKyBpdGVtLmdvb2RzX25hbWUpOwogICAgICAgICAgaXNGaW5kID0gZmFsc2U7CiAgICAgICAgICBmb3IgKGxldCByb2xlR29vZHNJdGVtIG9mIHJvbGVHb29kcyl7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCI9PT0+cm9sZUdvb2RzSXRlbT09PWdvb2RpZDoiICsgcm9sZUdvb2RzSXRlbS5nb29kc19pZCArICIsIGdvb2RzbmFtZToiICsgcm9sZUdvb2RzSXRlbS5nb29kc19uYW1lKTsKICAgICAgICAgICAgaWYgKGl0ZW0uZ29vZHNfaWQgPT0gcm9sZUdvb2RzSXRlbS5nb29kc19pZCl7CiAgICAgICAgICAgICAgaXNGaW5kID0gdHJ1ZTsKCiAgICAgICAgICAgICAgbGV0IGRhdGFJdGVtID0gewogICAgICAgICAgICAgICAgLy8gbWVudV9pZDogbnVsbCwKICAgICAgICAgICAgICAgIGdvb2RzX2lkOiAnJywKICAgICAgICAgICAgICAgIGdvb2RzX25hbWU6ICcnLAogICAgICAgICAgICAgICAgcHJpY2U6ICcnLAogICAgICAgICAgICAgICAgcm9sZV9zdGF0dXM6IGZhbHNlCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgZGF0YUl0ZW0gPSByb2xlR29vZHNJdGVtOwogICAgICAgICAgICAgIGRhdGFJdGVtLnJvbGVfc3RhdHVzID0gdHJ1ZTsKICAgICAgICAgICAgICBkYXRhLmdvb2RzLnB1c2goZGF0YUl0ZW0pOwogICAgICAgICAgICAgIC8vIHJvbGVHb29kc0l0ZW1bJ3JvbGVfc3RhdHVzJ10gPSAiMSI7CiAgICAgICAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihyb2xlR29vZHNJdGVtLCB7J3JvbGVfc3RhdHVzJyA6ICIxIn0pCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmICghaXNGaW5kKXsKICAgICAgICAgICAgbGV0IGRhdGFJdGVtID0gewogICAgICAgICAgICAgIC8vIG1lbnVfaWQ6IG51bGwsCiAgICAgICAgICAgICAgZ29vZHNfaWQ6ICcnLAogICAgICAgICAgICAgIGdvb2RzX25hbWU6ICcnLAogICAgICAgICAgICAgIHByaWNlOiAnJywKICAgICAgICAgICAgICByb2xlX3N0YXR1czogZmFsc2UKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZGF0YUl0ZW0uZ29vZHNfaWQgPSBpdGVtLmdvb2RzX2lkOwogICAgICAgICAgICBkYXRhSXRlbS5nb29kc19uYW1lID0gaXRlbS5nb29kc19uYW1lOwoKICAgICAgICAgICAgZGF0YS5nb29kcy5wdXNoKGRhdGFJdGVtKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CgogICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldFJvbGVHb29kc01vZGFsJywgdHJ1ZSk7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnU0VUUk9MRUdPT0RTQ1VSUkVOVERBVEEnLCBkYXRhKTsKICAgIH0sCgogICAgLy8g6I635Y+W5b2T5YmN5Lq65ZGY57G75Z6L6I+c5ZOBCiAgICBnZXRDdXJyZW50Um9sZUdvb2RzKHJvbGVJZCkgewogICAgICByZXR1cm4gXy5maWx0ZXIodGhpcy5Sb2xlR29vZHNMaXN0LCBjdXIgPT4ge3JldHVybiBjdXIucm9sZV9pZCA9PSByb2xlSWQgfSk7CiAgICB9LAoKICAgIC8v6I635Y+W5Lq65ZGY57G75Z6L6YWN572u6ZyA6KaB55qE6aSQ56eN5YiX6KGoCiAgICBxdWVyeUdvb2RzTGlzdDogYXN5bmMgZnVuY3Rpb24ocGFnZSwgcGFnZV9zaXplKSB7CiAgICAgIGxldCBwYXJhbXMgPSB7CiAgICAgICAgbWVyY2hhbnRfaWQ6IHRoaXMuY3VyTWVyY2hhbnRJZCwKICAgICAgICBpc19lbmFibGU6IDEsCiAgICAgICAgcGFnZTogcGFnZSB8fCAxLAogICAgICAgIHBhZ2Vfc2l6ZTogcGFnZV9zaXplIHx8IHRoaXMuJHBhcmVudC5wYWdlX3NpemUKICAgICAgfTsKICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdnb29kc0xpc3QnLCBwYXJhbXMpOwogICAgfSwKICAgIC8v6I635Y+W5Lq65ZGY57G75Z6L6YWN572u6aSQ56eN5YiX6KGoCiAgICBhc3luYyBxdWVyeVJvbGVHb29kc0xpc3QocGFnZSwgcGFnZV9zaXplKSB7CiAgICAgIGxldCBwYXJhbXMgPSB7CiAgICAgICAgbWVyY2hhbnRfaWQ6IHRoaXMuY3VyTWVyY2hhbnRJZCwKICAgICAgICAvLyByb2xlX2lkOiAnJywKICAgICAgICBwYWdlOiBwYWdlIHx8IDEsCiAgICAgICAgcGFnZV9zaXplOiBwYWdlX3NpemUgfHwgdGhpcy4kcGFyZW50LnBhZ2Vfc2l6ZQogICAgICB9OwogICAgICByZXR1cm4gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2dldFJvbGVHb29kc0xpc3QnLCBwYXJhbXMpOwogICAgfSwKICB9Cn0K"},{"version":3,"sources":["table.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;AAeA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"table.vue","sourceRoot":"src/views/setting/role-setting/components","sourcesContent":["<!-- 人员类型列表 -->\n<template>\n  <div class=\"card\">\n    <Table border stripe :columns='columns' :data='roleList.result' :loading=\"loading\">\n      <template slot=\"is_enable\" slot-scope=\"{ row }\">\n        <Tag :color=\"row.is_enable==1?'green':'volcano'\">{{row.is_enable==1?'有效':'无效'}}</Tag>\n      </template>\n      <template slot=\"handle\" slot-scope=\"{ row }\">\n        <Button type=\"primary\" ghost size=\"small\" icon=\"md-build\" style=\"border:0;\" @click=\"handleRoleGoods(row)\">配置餐种</Button>\n        <Button type=\"primary\" ghost size=\"small\" icon=\"md-create\" style=\"border:0;\" @click=\"handleEdit(row)\">修改人员类型</Button>\n      </template>\n    </Table>\n  </div>\n</template>\n<script>\nimport * as dataConfig from '../dataConfig';\nimport _ from \"underscore\";\n\nexport default {\n  name: 'SearchTable',\n  // props: {\n  //   value: Array\n  // },\n  data() {\n    return {\n      columns: [],\n\n    };\n  },\n\n  components: {},\n\n  computed: {\n    curMerchantId(){\n      return this.$store.state.user.curMerchantId;\n    },\n    roleList() {\n      return this.$store.state.role.roleList;\n    },\n    loading() {\n      return this.$store.state.app.tableLoading;\n    },\n    GoodsList() {\n      return _.filter(this.$store.state.goods.goodsList.result, cur => {return cur.is_enable === 1;});\n    },\n    RoleGoodsList() {\n      return this.$store.state.role.roleGoodsList.result;\n    },\n\n  },\n\n  async mounted() {\n    this.init();\n    await this.queryGoodsList();\n    await this.queryRoleGoodsList();\n  },\n\n  methods: {\n    init() {\n      this.columns = dataConfig.columns;\n    },\n    handleEdit(row){\n      let data = {\n        role_id: row.role_id,\n        name: row.name,\n        is_enable: row.is_enable.toString(),\n      }\n      this.$store.commit('setEditRoleModal', true);\n      this.$store.commit('SETROLECURRENTDATA', data);\n    },\n\n    handleRoleGoods(row){\n      let data = {\n        role_id: row.role_id,\n        role_name: row.name,\n        goods: [],\n      };\n\n      // console.log(\"handleRoleGoods===out>>>\" + JSON.stringify(this.getCurrentRoleGoods(data.role_id)))\n      // 处理人员类型配置菜单\n      if (JSON.stringify(this.getCurrentRoleGoods(data.role_id)) == '[]'){\n        console.log(\"handleRoleGoods===>>>\" + JSON.stringify(this.getCurrentRoleGoods(data.role_id)))\n        for (let item of this.GoodsList){\n          let dataItem = {\n            // menu_id: null,\n            goods_id: null,\n            goods_name: '',\n            price: '',\n            role_status: false\n          };\n          dataItem.goods_id = item.goods_id;\n          dataItem.goods_name = item.goods_name;\n\n          data.goods.push(dataItem);\n        };\n      }\n      else{\n        //如果当前人员类型有配置就餐信息，则初始化传送过去的数据\n        let roleGoods = this.getCurrentRoleGoods(data.role_id);\n\n        // console.log(\"===>roleGoods===roleGoods:\" + JSON.stringify(roleGoods));\n        let isFind = 0;\n\n        for (let item of this.GoodsList)\n        {\n          // console.log(\"===>GoodsList===goods:\" + JSON.stringify(this.GoodsList));\n          // console.log(\"===>GoodsList===goodid:\" + item.goods_id + \", goodsname:\" + item.goods_name);\n          isFind = false;\n          for (let roleGoodsItem of roleGoods){\n            // console.log(\"===>roleGoodsItem===goodid:\" + roleGoodsItem.goods_id + \", goodsname:\" + roleGoodsItem.goods_name);\n            if (item.goods_id == roleGoodsItem.goods_id){\n              isFind = true;\n\n              let dataItem = {\n                // menu_id: null,\n                goods_id: '',\n                goods_name: '',\n                price: '',\n                role_status: false\n              };\n\n              dataItem = roleGoodsItem;\n              dataItem.role_status = true;\n              data.goods.push(dataItem);\n              // roleGoodsItem['role_status'] = \"1\";\n              // Object.assign(roleGoodsItem, {'role_status' : \"1\"})\n              break;\n            }\n          }\n          if (!isFind){\n            let dataItem = {\n              // menu_id: null,\n              goods_id: '',\n              goods_name: '',\n              price: '',\n              role_status: false\n            };\n            dataItem.goods_id = item.goods_id;\n            dataItem.goods_name = item.goods_name;\n\n            data.goods.push(dataItem);\n          }\n        };\n      }\n\n      this.$store.commit('setRoleGoodsModal', true);\n      this.$store.commit('SETROLEGOODSCURRENTDATA', data);\n    },\n\n    // 获取当前人员类型菜品\n    getCurrentRoleGoods(roleId) {\n      return _.filter(this.RoleGoodsList, cur => {return cur.role_id == roleId });\n    },\n\n    //获取人员类型配置需要的餐种列表\n    queryGoodsList: async function(page, page_size) {\n      let params = {\n        merchant_id: this.curMerchantId,\n        is_enable: 1,\n        page: page || 1,\n        page_size: page_size || this.$parent.page_size\n      };\n      return await this.$store.dispatch('goodsList', params);\n    },\n    //获取人员类型配置餐种列表\n    async queryRoleGoodsList(page, page_size) {\n      let params = {\n        merchant_id: this.curMerchantId,\n        // role_id: '',\n        page: page || 1,\n        page_size: page_size || this.$parent.page_size\n      };\n      return await this.$store.dispatch('getRoleGoodsList', params);\n    },\n  }\n}\n</script>\n<style lang='less' scoped>\n</style>\n"]}]}