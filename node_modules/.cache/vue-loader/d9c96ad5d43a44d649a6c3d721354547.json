{"remainingRequest":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhang/canteen_manage/src/views/staff-management/dining-staff/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhang/canteen_manage/src/views/staff-management/dining-staff/index.vue","mtime":1639451533396},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7YnVpbGRDaGlsZERlcGFydG1lbnRBcnJheX0gZnJvbSAiQC9saWJzL3V0aWwiOwoKaW1wb3J0IG90aGVydXNlck1vZGFsIGZyb20gJy4vY29tcG9uZW50cy9hZGQtb3RoZXJ1c2VyLW1vZGFsJzsKaW1wb3J0IGVtcGxveWVlTW9kYWwgZnJvbSAnLi9jb21wb25lbnRzL2FkZC1lbXBsb3llZS1tb2RhbCc7CmltcG9ydCB1c2VyTW9kYWwgZnJvbSAnLi9jb21wb25lbnRzL2FkZC11c2VyLW1vZGFsJzsKaW1wb3J0IGRlcGFydG1lbnRNb2RhbCBmcm9tICcuL2NvbXBvbmVudHMvYWRkLWRlcGFydG1lbnQtbW9kYWwnOwppbXBvcnQgc2VhcmNoRm9ybSBmcm9tICcuL2NvbXBvbmVudHMvZm9ybSc7CmltcG9ydCBzZWFyY2hUYWJsZSBmcm9tICcuL2NvbXBvbmVudHMvdGFibGUnOwppbXBvcnQgZWRpdE1vZGFsIGZyb20gJy4vY29tcG9uZW50cy9lZGl0LW1vZGFsJzsKaW1wb3J0IHNlbE1vZGFsIGZyb20gJy4vY29tcG9uZW50cy9tb2RhbCc7CmltcG9ydCBwZXJzb25hbERlcG9zaXRNb2RhbCBmcm9tICcuL2NvbXBvbmVudHMvcGVyc29uYWwtZGVwb3NpdC1tb2RhbCc7CmltcG9ydCBiYXRjaERlcG9zaXRNb2RhbCBmcm9tICcuL2NvbXBvbmVudHMvYmF0Y2gtZGVwb3NpdC1tb2RhbCc7CmltcG9ydCB3aXRoZHJhd1N1Y01vZGFsIGZyb20gJy4vY29tcG9uZW50cy93aXRoZHJhdy1zdWMtbW9kYWwnOwppbXBvcnQgYXhpb3MgZnJvbSAnQC9saWJzL2FwaS5wbGF0Zm9ybS5qcycKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdEaW5pbmdTdGFmZicsCiAgZGF0YSAoKSB7CiAgICByZXR1cm4gewogICAgICBwYWdlX3NpemU6IDUwLAogICAgICBpc19zZWxlY3RfYWxsOiBudWxsLAogICAgICB1c2VyQ29kZURhdGE6ICcnLAogICAgICBmcmVzaFJhbmRvbTogMCwKICAgICAgdHJlZURhdGE6IFtdCiAgICB9OwogIH0sCgogIGNvbXBvbmVudHM6IHtzZWFyY2hGb3JtLCBzZWFyY2hUYWJsZSwgZGVwYXJ0bWVudE1vZGFsLCBlbXBsb3llZU1vZGFsLCB1c2VyTW9kYWwsIGVkaXRNb2RhbCwgc2VsTW9kYWwsIHBlcnNvbmFsRGVwb3NpdE1vZGFsLCBiYXRjaERlcG9zaXRNb2RhbCxvdGhlcnVzZXJNb2RhbCx3aXRoZHJhd1N1Y01vZGFsfSwKCiAgY29tcHV0ZWQ6IHsKICAgIHVzZXJEYXRhKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUudXNlci51c2VyRGF0YTsKICAgIH0sCiAgICBjdXJyZW50TWVyY2hhbnRJZCgpewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUudXNlci5jdXJNZXJjaGFudElkOwogICAgfSwKCiAgfSwKCiAgbWV0aG9kczogewogICAgcXVlcnk6IGFzeW5jIGZ1bmN0aW9uKHBhZ2UpIHsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdUQUJMRV9MT0FESU5HJywgdHJ1ZSk7CiAgICAgIGxldCBwYXJhbXMgPSB7CiAgICAgICAgLi4udGhpcy4kcmVmcy5Gb3JtUXVlcnkucmVzdWx0Rm9ybSwKICAgICAgICBtZXJjaGFudF9pZDogdGhpcy5jdXJyZW50TWVyY2hhbnRJZCwKICAgICAgICBwYWdlOiBwYWdlIHx8IDEsCiAgICAgICAgcGFnZV9zaXplOiB0aGlzLnBhZ2Vfc2l6ZQogICAgICB9OwogICAgICBjb25zb2xlLmxvZygnMTExMTExPT09PT09PT1wYXJhbXMnLHBhcmFtcykKCiAgICAgIGxldCBxdWVyeUFycmF5ID0gcGFyYW1zLmRlcGFydG1lbnRzIHx8ICcnOwogICAgICBpZiAocXVlcnlBcnJheSAhPT0gJycpewogICAgICAgIGxldCBzdHJpbmdSZXN1bHQgPSBxdWVyeUFycmF5LnNwbGl0KCcsJyk7CiAgICAgICAgbGV0IGRlcGFydEFycmF5ID0gYnVpbGRDaGlsZERlcGFydG1lbnRBcnJheShzdHJpbmdSZXN1bHQsdGhpcy4kc3RvcmUuc3RhdGUudXNlci5kZXBhcnRtZW50TGlzdCk7CiAgICAgICAgbGV0IGFycmF5UmVzdWx0ID0gZGVwYXJ0QXJyYXkuam9pbignLCcpOwogICAgICAgIHBhcmFtcy5kZXBhcnRtZW50cyA9IGFycmF5UmVzdWx0OwogICAgICB9CiAgICAgIGxldCByZXMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnc3RhZmZMaXN0JywgcGFyYW1zKTsKICAgIH0sCiAgICBleHBvcnRVc2VyOiBhc3luYyBmdW5jdGlvbigpIHsKICAgICAgbGV0IGZpbGVOYW1lID0gJ+mjn+WgguWwsemkkOWRmOW3pSc7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnVEFCTEVfTE9BRElORycsIHRydWUpOwogICAgICBsZXQgcGFyYW1zID0gewogICAgICAgIC4uLnRoaXMuJHJlZnMuRm9ybVF1ZXJ5LnJlc3VsdEZvcm0sCiAgICAgICAgbWVyY2hhbnRfaWQ6IHRoaXMuY3VycmVudE1lcmNoYW50SWQsCiAgICAgIH07CgogICAgICBsZXQgcXVlcnlBcnJheSA9IHBhcmFtcy5kZXBhcnRtZW50cyB8fCAnJzsKICAgICAgaWYgKHF1ZXJ5QXJyYXkgIT09ICcnKXsKICAgICAgICBsZXQgc3RyaW5nUmVzdWx0ID0gcXVlcnlBcnJheS5zcGxpdCgnLCcpOwogICAgICAgIGxldCBkZXBhcnRBcnJheSA9IGJ1aWxkQ2hpbGREZXBhcnRtZW50QXJyYXkoc3RyaW5nUmVzdWx0LHRoaXMuJHN0b3JlLnN0YXRlLnVzZXIuZGVwYXJ0bWVudExpc3QpOwogICAgICAgIGxldCBhcnJheVJlc3VsdCA9IGRlcGFydEFycmF5LmpvaW4oJywnKTsKICAgICAgICBwYXJhbXMuZGVwYXJ0bWVudHMgPSBhcnJheVJlc3VsdDsKICAgICAgfQogICAgICBsZXQgcmVzID0gYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2V4cG9ydFVzZXJMaXN0JywgcGFyYW1zKTsKICAgICAgaWYgKHJlcy5yZXR1cm5fY29kZSA9PSAwKXsKICAgICAgICBsZXQgZmlsZVVybCA9IHJlcy5kYXRhLnVybDsKICAgICAgICB0aGlzLmRvd25sb2FkKGZpbGVVcmwpOwogICAgICB9CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnVEFCTEVfTE9BRElORycsIGZhbHNlKTsKICAgIH0sCiAgICAvLyDliIbpobUKICAgIGhhbmRsZVBhZ2VEb3duOiBmdW5jdGlvbihjdXJyZW50UGFnZSkgewogICAgICB0aGlzLnF1ZXJ5KGN1cnJlbnRQYWdlLCB0aGlzLnBhZ2Vfc2l6ZSk7CiAgICAgIHRoaXMuJHJlZnMuVGFibGVRdWVyeS5pbml0KGN1cnJlbnRQYWdlKTsKICAgIH0sCiAgICAvL+afpeivouinkuiJsgogICAgcXVlcnlSb2xlTGlzdDogYXN5bmMgZnVuY3Rpb24oKSB7CiAgICAgIGxldCBwYXJhbXMgPSB7CiAgICAgICAgbWVyY2hhbnRfaWQ6IHRoaXMuY3VycmVudE1lcmNoYW50SWQsCiAgICAgICAgaXNfZW5hYmxlOiAxLAogICAgICAgIHBhZ2U6IDEsCiAgICAgICAgcGFnZV9zaXplOiAxMDAwMAogICAgICB9OwogICAgICBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgncm9sZUxpc3QnLCBwYXJhbXMpOwoKICAgIH0sCgogICAgLy8g6I635Y+W6aSQ56eNbGlzdAogICAgcXVlcnlHb29kczogYXN5bmMgZnVuY3Rpb24oKSB7CiAgICAgIGxldCBwYXJhbXMgPSB7CiAgICAgICAgbWVyY2hhbnRfaWQ6IHRoaXMuY3VycmVudE1lcmNoYW50SWQsCiAgICAgICAgcGFnZTogMSwKICAgICAgICBwYWdlX3NpemU6IDEwMCwKICAgICAgICBpc19lbmFibGU6IDEKICAgICAgfTsKICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ2dvb2RzTGlzdCcsIHBhcmFtcyk7CgogICAgfSwKCiAgICAvLyDmn6Xor6Llhajpg6jlsLHppJDlkZjlt6UKICAgIHF1ZXJ5RW1wVXNlckxpc3Q6IGFzeW5jIGZ1bmN0aW9uKHBhZ2UsIHBhZ2Vfc2l6ZSkgewogICAgICBsZXQgcGFyYW1zID0gewogICAgICAgIG1lcmNoYW50X2lkOiB0aGlzLmN1cnJlbnRNZXJjaGFudElkLAogICAgICAgIHBhZ2U6IHBhZ2UgfHwgMSwKICAgICAgICBwYWdlX3NpemU6IHBhZ2Vfc2l6ZSB8fCB0aGlzLiRwYXJlbnQucGFnZV9zaXplLAoKICAgICAgfTsKICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ3N0YWZmTGlzdCcsIHBhcmFtcyk7CiAgICB9LAoKICAgIHNldFNlbGVjdGlvbihyYW5kb21LZXksIHVzZXJDb2RlRGF0YSl7CiAgICAgIGlmIChyYW5kb21LZXkgPiAwKXsKICAgICAgICB0aGlzLmlzX3NlbGVjdF9hbGwgPSByYW5kb21LZXk7CiAgICAgIH0KICAgICAgdGhpcy51c2VyQ29kZURhdGEgPSB1c2VyQ29kZURhdGE7CiAgICAgIHRoaXMuZnJlc2hSYW5kb20gPSBNYXRoLnJhbmRvbSgpKjEwMCsxMDA7CgogICAgfSwKCiAgICAvLyDkuIvovb3mlofku7YKICAgIGRvd25sb2FkKGZpbGVVcmwpIHsKICAgICAgaWYgKCFmaWxlVXJsKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBsZXQgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgbGluay5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICBsaW5rLmhyZWYgPSBmaWxlVXJsOwogICAgICBsaW5rLnNldEF0dHJpYnV0ZSgiZG93bmxvYWQiLCBmaWxlVXJsKTsKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgbGluay5jbGljaygpOwogICAgICAvLyB0aGlzLiRNZXNzYWdlLnN1Y2Nlc3MoIuS4i+i9veWujOaIkO+8gSIpOwogICAgfSwKCiAgfSwKCgogIGFzeW5jIG1vdW50ZWQoKSB7CiAgICB0aGlzLnF1ZXJ5KCk7CiAgICB0aGlzLnF1ZXJ5Um9sZUxpc3QoKTsKICAgIHRoaXMucXVlcnlHb29kcygpOwoKICB9LAp9Cgo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA","file":"index.vue","sourceRoot":"src/views/staff-management/dining-staff","sourcesContent":["<!-- 就餐员工 -->\n<template>\n  <div>\n    <departmentModal></departmentModal>   \n    <otheruserModal></otheruserModal>\n    <employee-modal></employee-modal>\n    <user-modal></user-modal>\n    <!-- 编辑用户modal -->\n    <edit-modal></edit-modal>\n    <!-- 选择下单modal -->\n    <sel-modal @selection=\"setSelection\"></sel-modal>\n    <!-- 个人充值/取现modal -->\n    <personal-deposit-modal @selection=\"setSelection\"></personal-deposit-modal>\n    <!-- 取现成功modal -->\n    <withdraw-suc-modal></withdraw-suc-modal>\n    <!-- 批量充值 -->\n    <batch-deposit-modal @selection=\"setSelection\"></batch-deposit-modal>\n    <div class=\"margin-bottom-10\">\n      <searchForm ref=\"FormQuery\" :treeData=\"treeData\"></searchForm>\n    </div>\n    <div class=\"card\">\n      <searchTable ref=\"TableQuery\" :selectAll=\"is_select_all\" :freshRandom=\"freshRandom\" :userCodeData=\"userCodeData\"></searchTable>\n    </div>\n    <Page class=\"page\" ref=\"pages\" :total=\"userData.total\" :page-size=\"page_size\" size=\"small\" show-total @on-change=\"handlePageDown\"></Page>\n  </div>\n</template>\n\n<script>\nimport {buildChildDepartmentArray} from \"@/libs/util\";\n\nimport otheruserModal from './components/add-otheruser-modal';\nimport employeeModal from './components/add-employee-modal';\nimport userModal from './components/add-user-modal';\nimport departmentModal from './components/add-department-modal';\nimport searchForm from './components/form';\nimport searchTable from './components/table';\nimport editModal from './components/edit-modal';\nimport selModal from './components/modal';\nimport personalDepositModal from './components/personal-deposit-modal';\nimport batchDepositModal from './components/batch-deposit-modal';\nimport withdrawSucModal from './components/withdraw-suc-modal';\nimport axios from '@/libs/api.platform.js'\nexport default {\n  name: 'DiningStaff',\n  data () {\n    return {\n      page_size: 50,\n      is_select_all: null,\n      userCodeData: '',\n      freshRandom: 0,\n      treeData: []\n    };\n  },\n\n  components: {searchForm, searchTable, departmentModal, employeeModal, userModal, editModal, selModal, personalDepositModal, batchDepositModal,otheruserModal,withdrawSucModal},\n\n  computed: {\n    userData() {\n      return this.$store.state.user.userData;\n    },\n    currentMerchantId(){\n      return this.$store.state.user.curMerchantId;\n    },\n\n  },\n\n  methods: {\n    query: async function(page) {\n      this.$store.commit('TABLE_LOADING', true);\n      let params = {\n        ...this.$refs.FormQuery.resultForm,\n        merchant_id: this.currentMerchantId,\n        page: page || 1,\n        page_size: this.page_size\n      };\n      console.log('111111========params',params)\n\n      let queryArray = params.departments || '';\n      if (queryArray !== ''){\n        let stringResult = queryArray.split(',');\n        let departArray = buildChildDepartmentArray(stringResult,this.$store.state.user.departmentList);\n        let arrayResult = departArray.join(',');\n        params.departments = arrayResult;\n      }\n      let res = await this.$store.dispatch('staffList', params);\n    },\n    exportUser: async function() {\n      let fileName = '食堂就餐员工';\n      this.$store.commit('TABLE_LOADING', true);\n      let params = {\n        ...this.$refs.FormQuery.resultForm,\n        merchant_id: this.currentMerchantId,\n      };\n\n      let queryArray = params.departments || '';\n      if (queryArray !== ''){\n        let stringResult = queryArray.split(',');\n        let departArray = buildChildDepartmentArray(stringResult,this.$store.state.user.departmentList);\n        let arrayResult = departArray.join(',');\n        params.departments = arrayResult;\n      }\n      let res = await this.$store.dispatch('exportUserList', params);\n      if (res.return_code == 0){\n        let fileUrl = res.data.url;\n        this.download(fileUrl);\n      }\n      this.$store.commit('TABLE_LOADING', false);\n    },\n    // 分页\n    handlePageDown: function(currentPage) {\n      this.query(currentPage, this.page_size);\n      this.$refs.TableQuery.init(currentPage);\n    },\n    //查询角色\n    queryRoleList: async function() {\n      let params = {\n        merchant_id: this.currentMerchantId,\n        is_enable: 1,\n        page: 1,\n        page_size: 10000\n      };\n      await this.$store.dispatch('roleList', params);\n\n    },\n\n    // 获取餐种list\n    queryGoods: async function() {\n      let params = {\n        merchant_id: this.currentMerchantId,\n        page: 1,\n        page_size: 100,\n        is_enable: 1\n      };\n      await this.$store.dispatch('goodsList', params);\n\n    },\n\n    // 查询全部就餐员工\n    queryEmpUserList: async function(page, page_size) {\n      let params = {\n        merchant_id: this.currentMerchantId,\n        page: page || 1,\n        page_size: page_size || this.$parent.page_size,\n\n      };\n      await this.$store.dispatch('staffList', params);\n    },\n\n    setSelection(randomKey, userCodeData){\n      if (randomKey > 0){\n        this.is_select_all = randomKey;\n      }\n      this.userCodeData = userCodeData;\n      this.freshRandom = Math.random()*100+100;\n\n    },\n\n    // 下载文件\n    download(fileUrl) {\n      if (!fileUrl) {\n        return;\n      }\n\n      let link = document.createElement(\"a\");\n      link.style.display = \"none\";\n      link.href = fileUrl;\n      link.setAttribute(\"download\", fileUrl);\n      document.body.appendChild(link);\n      link.click();\n      // this.$Message.success(\"下载完成！\");\n    },\n\n  },\n\n\n  async mounted() {\n    this.query();\n    this.queryRoleList();\n    this.queryGoods();\n\n  },\n}\n\n</script>\n<style lang='less' scoped>\n</style>\n"]}]}