{"remainingRequest":"/Users/zhang/工作/pic_ad/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhang/工作/pic_ad/src/views/staff-management/dining-staff/components/add-employee-modal.vue?vue&type=style&index=0&id=6b791785&lang=less&scoped=true&","dependencies":[{"path":"/Users/zhang/工作/pic_ad/src/views/staff-management/dining-staff/components/add-employee-modal.vue","mtime":1638760834528},{"path":"/Users/zhang/工作/pic_ad/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/工作/pic_ad/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/zhang/工作/pic_ad/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/zhang/工作/pic_ad/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/工作/pic_ad/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/工作/pic_ad/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi9kZWVwLy5pdnUtbW9kYWwtYm9keXsKICBtaW4taGVpZ2h0OiA4MHZoOwogIC5pdnUtdGFibGUtd3JhcHBlcnsKICAgIG1pbi1oZWlnaHQ6IGNhbGMoODB2aCAtIDEwMHB4KTsKICB9Cn0KLml2dS1mb3JtLWl0ZW0gL2RlZXAvLml2dS1mb3JtLWl0ZW0tY29udGVudCB7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrICFpbXBvcnRhbnQ7Cn0K"},{"version":3,"sources":["add-employee-modal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"add-employee-modal.vue","sourceRoot":"src/views/staff-management/dining-staff/components","sourcesContent":["<!-- 添加独立就餐人员 -->\n<template>\n  <Modal v-model=\"employeeModal\" width=\"1020px\" :footer-hide=\"true\" title=\"添加就餐人员\">\n    <div class=\"margin-top-10\">\n      <Form inline :model=\"formValidate\" label-colon @keyup.enter.prevent=''>\n        <FormItem label=\"关键字\">\n          <Input :style=\"{width: '310px'}\" clearable @keyup.enter.native=\"queryEmployeeList\" v-model=\"formValidate.query\" placeholder=\"用户姓名/手机号/数字账号/员工ID\" />\n          <Input type=\"text\" v-show=\"false\" style=\"width: 1px;\"/>\n        </FormItem>\n        <FormItem>\n          <Button type='primary' icon=\"md-search\" @click=\"queryEmployeeList()\">查询</Button>\n        </FormItem>\n      </Form>\n    </div>\n    <div>\n      <Table border stripe :columns='columns' :data='tableData' :loading=\"loading\">\n        <template slot=\"status\" slot-scope=\"{ row }\">\n          <Tag :color=\"row.status==1?'green':'volcano'\">{{row.status == 1 ? '正常' : '已删除'}}</Tag>\n        </template>\n        <template slot=\"userroletype\" slot-scope=\"{ row }\">\n          <Select placeholder=\"人员类型\" v-model=\"row.role_id\">\n            <Option v-for=\"item in roleList\" :key=\"item.role_id\" :value=\"item.role_id\" :label=\"item.name\">{{ item.name }}</Option>\n          </Select>\n        </template>\n        <template slot=\"handle\" slot-scope=\"{ row }\">\n          <Button type=\"success\" ghost size=\"small\" @click=\"addEmployeeToUser(row)\">{{addText}}</Button>\n        </template>\n      </Table>\n    </div>\n\n  </Modal>\n</template>\n\n<script>\nimport * as dataConfig from '../dataConfig';\nimport md5 from 'js-md5';\nimport _ from 'underscore';\n\nexport default {\n  name: 'employeeModal',\n  data() {\n    return {\n      loading: false,\n      addText: \"添加\",\n      columns: [],\n      tableData: [],\n      formValidate: {\n        query: '',\n        role_id: undefined,\n      },\n\n    };\n  },\n\n  // created() {\n  //   window.addEventListener(\"keydown\", this.handleKeyDown, true); //开启监听键盘按下事件\n  // },\n\n  components: {},\n\n  computed: {\n\n    currentOrgId() {\n      return this.$store.state.user.curOrgId;\n    },\n    sessionId() {\n      return this.$store.state.user.token;\n    },\n    empUserCode() {\n      return this.$store.state.user.empUserCode;\n    },\n    currentMerchantId(){\n      return this.$store.state.user.curMerchantId;\n    },\n    currentMerchantName(){\n      return this.$store.state.user.curMerchantName;\n    },\n    roleList(){\n      return this.$store.state.role.roleList.result;\n    },\n    employeeModal:{\n      get(){\n        return this.$store.state.user.employeeModal;\n      },\n      set(val){\n        this.$store.commit('setEmployeeModal', val);\n        if (!val){\n          this.tableData = [];\n          this.formValidate.query = '';\n        }\n      }\n    },\n  },\n\n  methods: {\n    handleKeyDown(e) {\n      let key = null;\n      if (window.event === undefined) {\n        key = e.keyCode;\n      } else {\n        key = window.event.keyCode;\n      }\n      if (key === 13) {\n        console.log(\"Enter====>>>>>>\")\n        //触发的事件\n        this.queryEmployeeList();\n      }\n    },\n\n    //查询企业员工信息\n    queryEmployeeList: async function() {\n      console.log(\"=====queryEmployeeList=====\")\n      let adminname = this.formValidate.query || '';\n      if (adminname.length == 0){\n        this.$Message.error('请输入要查询人员姓名或手机号信息！');\n        return;\n      }\n\n      this.loading = true;\n      let params = {\n        ...this.formValidate,\n        sessionid: this.sessionId,\n        org_id: this.currentOrgId,\n        usercode: this.empUserCode,\n        status: 1,\n        limit: 1000\n      };\n\n      await this.$store.dispatch('employeeList', params).then(res=>{\n        this.loading = false;\n        this.tableData = [];\n        for (let item of res.rows){\n          item['role_id'] = 0;\n          this.tableData.push(item);\n        }\n\n      }).catch(err=>{\n        this.loading = false;\n      });\n\n    },\n\n    init() {\n      this.columns = dataConfig.employeeColumns;\n\n    },\n    addEmployeeToUser: async function(employee){\n\n      console.log('添加当前行---row',employee)\n      let params = {\n        merchant_id: this.$store.state.user.curMerchantId,\n        user_type: 1,\n        role_id: employee.role_id,\n        id_no: employee.id_no,\n        card_no: '',\n        ext_emp_id: employee.ext_emp_id,\n        name: employee.name,\n        c_usercode: employee.c_usercode,\n        city: employee.city,\n        phones: employee.phones,\n        ext_user_id: employee.ext_user_id,\n        org_id: employee.org_id,\n        departments: employee.departments,\n        department: employee.department_id,\n        department_name: employee.department_name,\n        usercode: employee.usercode,\n        is_admin: employee.is_admin,\n        is_wallet_admin: employee.is_wallet_admin,\n        org_name: employee.org_name,\n        emails: employee.emails,\n      };\n\n      let paramsData = [];\n      paramsData.push(params);\n\n      let Base64 = require('js-base64').Base64;\n      let details = Base64.encode(JSON.stringify(paramsData));\n\n      let reqParams = {\n        sessionid: this.$store.state.user.token,\n        user_detail: details,\n      };\n\n      try {\n        let res = await this.$store.dispatch('userAdd', reqParams);\n        if(res && _.has(res, 'return_code') && res.return_code==0){\n          this.$Message.success('添加就餐人员成功！');\n          this.$parent.query();\n          await this.$parent.getMerchantChildDepartment();\n        }\n        else{\n          this.$Message.error(\"错误码：\" + res.return_code + \", 错误信息：\" + res.return_message);\n        }\n      } catch(e) {\n        console.log(e);\n      }\n    }\n\n  },\n\n  mounted() {\n    this.init();\n    // let departmentId = 'FZdkNNSod8bX7HakX';\n    // this.queryEmployeeList(departmentId);\n  },\n\n  // destroyed() {\n  //   window.removeEventListener(\"keydown\", this.handleKeyDown, true);\n  // },\n}\n\n</script>\n\n<style lang='less' scoped>\n/deep/.ivu-modal-body{\n  min-height: 80vh;\n  .ivu-table-wrapper{\n    min-height: calc(80vh - 100px);\n  }\n}\n.ivu-form-item /deep/.ivu-form-item-content {\n  display: inline-block !important;\n}\n</style>\n"]}]}