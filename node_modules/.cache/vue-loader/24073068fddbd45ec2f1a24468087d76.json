{"remainingRequest":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhang/canteen_manage/src/views/staff-management/dining-staff/components/table.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhang/canteen_manage/src/views/staff-management/dining-staff/components/table.vue","mtime":1639448798473},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBfIGZyb20gJ3VuZGVyc2NvcmUnOwppbXBvcnQgKiBhcyBkYXRhQ29uZmlnIGZyb20gJy4uL2RhdGFDb25maWcnOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ1NlYXJjaFRhYmxlJywKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgY29sdW1uczogW10sCiAgICAgIGN1cnJlbnRfaWQ6ICcnLAogICAgICBhbW91bnRBcnI6IFtdLAogICAgICB0YWJsZURhdGE6IFtdCiAgICB9OwogIH0sCgogIHByb3BzOiB7CiAgICBzZWxlY3RBbGw6IE51bWJlciwKICAgIGZyZXNoUmFuZG9tOiBOdW1iZXIsCiAgICB1c2VyQ29kZURhdGE6IFN0cmluZywKICB9LAoKICBjb21wb25lbnRzOiB7fSwKCiAgY29tcHV0ZWQ6IHsKICAgIHVzZXJEYXRhKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUudXNlci51c2VyRGF0YTsKICAgIH0sCgogICAgbG9hZGluZygpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLmFwcC50YWJsZUxvYWRpbmc7CiAgICB9LAogICAgcm9sZUxpc3QoKSB7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5yb2xlLnJvbGVMaXN0LnJlc3VsdDsKICAgIH0sCiAgICB1c2VydHlwZSgpIHsKICAgICAgcmV0dXJuIChpZCk9PnsKICAgICAgICBsZXQgdmFsID0gJyc7CiAgICAgICAgbGV0IGN1cnJlbnQgPSBfLmZpbmQodGhpcy5yb2xlTGlzdCwgY3VyPT4gewogICAgICAgICAgcmV0dXJuIGN1ci5yb2xlX2lkID09IGlkOwogICAgICAgIH0pOwogICAgICAgIHZhbCA9IGN1cnJlbnQgPyBjdXJyZW50Lm5hbWUgOiAnJzsKICAgICAgICByZXR1cm4gdmFsOwogICAgICB9CiAgICB9LAogCiAgICBzdWJtaXRCYXRjaE1vZGFsKCl7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5vcmRlci5zdWJtaXRCYXRjaE1vZGFsOwogICAgfQogIH0sCgogIG1ldGhvZHM6IHsKICAgIC8v6I635Y+W5Lq65ZGY57G75Z6L5YiX6KGoCiAgICBxdWVyeVJvbGU6IGFzeW5jIGZ1bmN0aW9uKCkgewogICAgICBsZXQgcGFyYW1zID0gewogICAgICAgIG1lcmNoYW50X2lkOiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLmN1ck1lcmNoYW50SWQsCiAgICAgICAgaXNfZW5hYmxlOiAxLAogICAgICAgIHBhZ2U6IDEsCiAgICAgICAgcGFnZV9zaXplOiA1MDAwCiAgICAgIH07CiAgICAgIHJldHVybiBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgncm9sZUxpc3QnLCBwYXJhbXMpLmNhdGNoKGVyciA9PiBlcnIpOwogICAgfSwKICAgIGluaXQocGFnZSkgewogICAgICB0aGlzLmNvbHVtbnMgPSBkYXRhQ29uZmlnLmNvbHVtbnM7CiAgICAgIGxldCB0bXAgPSB7CiAgICAgICAgdGl0bGU6ICfluo/lj7cnLAogICAgICAgIHR5cGU6ICJpbmRleCIsCiAgICAgICAgd2lkdGg6IDYwLAogICAgICAgIGFsaWduOiAiY2VudGVyIiwKICAgICAgICBzaG93OiB0cnVlLAogICAgICAgIGluZGV4TWV0aG9kOiAocm93KSA9PiB7CiAgICAgICAgICByZXR1cm4gcm93Ll9pbmRleCsoKHBhZ2UgfHwgMSkgLSAxKSAqIHRoaXMuJHBhcmVudC5wYWdlX3NpemUgKyAxOwogICAgICAgIH0sCiAgICAgIH0KICAgICAgdGhpcy5jb2x1bW5zLnNwbGljZSgxLDEsdG1wKTsKICAgICAgdGhpcy5jb2x1bW5zLmZvckVhY2goKGl0ZW0pID0+IHsKICAgICAgICBpZiAoaXRlbS5rZXkgPT0gJ3N0YXR1cycpIHsKICAgICAgICAgIGl0ZW0ucmVuZGVyID0gKGgsIHBhcmFtKSA9PiB7CiAgICAgICAgICAgIGxldCBjdXJyZW50Um93ID0gcGFyYW0ucm93OwogICAgICAgICAgICBsZXQgc2hvd1ZhbHVlID0gY3VycmVudFJvd1tpdGVtLmtleV07CiAgICAgICAgICAgIGxldCB0ZXh0ID0gc2hvd1ZhbHVlID09IDEgPyAn5q2j5bi4JyA6ICflt7LliKDpmaQnOwogICAgICAgICAgICByZXR1cm4gaCgnc3BhbicsIHt9LCB0ZXh0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIC8v5p+l6K+i5ZGY5bel6ZKx5YyF6LSm5oi35L2Z6aKd5L+h5oGvCiAgICBxdWVyeVVzZXJXYWxsZXRCYWxhbmNlKHVzZXJjb2RlKSB7CiAgICAgIGlmICh1c2VyY29kZSl7CiAgICAgICAgbGV0IHBhcmFtcyA9IHsKICAgICAgICAgIHVzZXJjb2RlOiB1c2VyY29kZSwKICAgICAgICAgIG1lcmNoYW50X2lkOiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLmN1ck1lcmNoYW50SWQsCiAgICAgICAgfTsKICAgICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgndXNlckRldGFpbCcsIHBhcmFtcykudGhlbihyZXM9PnsKICAgICAgICAgIGxldCBpbmRleCA9IF8uZmluZEluZGV4KHRoaXMudGFibGVEYXRhLCB7IHVzZXJjb2RlIDogdXNlcmNvZGUgfSk7CiAgICAgICAgICB0aGlzLnRhYmxlRGF0YVtpbmRleF1bJ2JhbGFuY2UnXSA9IHJlcy5kYXRhLmJhbGFuY2U7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygn6ZKx5YyF5L2Z6aKdOicrIHJlcy5kYXRhLmJhbGFuY2UgKyAiLCBpbmRleD0iICsgaW5kZXggKyAiLCB1c2VyY29kZToiICsgdGhpcy50YWJsZURhdGFbaW5kZXhdWyd1c2VyY29kZSddKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICAvLyBsZXQgcGFyYW1zID0gewogICAgICAvLyAgIHNlc3Npb25pZDogdGhpcy4kc3RvcmUuc3RhdGUudXNlci50b2tlbiwKICAgICAgLy8gICB1c2VyY29kZTogdXNlcmNvZGUsCiAgICAgIC8vICAgbWVyY2hhbnRfY29kZTogdGhpcy4kc3RvcmUuc3RhdGUudXNlci5jdXJNZXJjaGFudFVzZXJDb2RlLAogICAgICAvLyB9OwogICAgICAvLwogICAgICAvLyB0aGlzLiRzdG9yZS5kaXNwYXRjaCgndXNlcldhbGxldEJhbGFuY2UnLCBwYXJhbXMpLnRoZW4ocmVzPT57CiAgICAgIC8vICAgbGV0IHdhbGxldEluZm8gPSBfLmZpbmQocmVzLmluZm8sIGN1ciA9PiB7CiAgICAgIC8vICAgICByZXR1cm4gY3VyLm1lcmNoYW50X2NvZGUgPT0gcGFyYW1zLm1lcmNoYW50X2NvZGU7CiAgICAgIC8vICAgfSk7CiAgICAgIC8vICAgbGV0IGF2YWlsYWJsZV9iYWxhbmNlID0gKHdhbGxldEluZm8uYXZhaWxhYmxlX2JhbGFuY2UvMTAwKS50b0ZpeGVkKDIpOwogICAgICAvLwogICAgICAvLyAgIGxldCBpbmRleCA9IF8uZmluZEluZGV4KHRoaXMudGFibGVEYXRhLCB7IHVzZXJjb2RlIDogdXNlcmNvZGUgfSk7CiAgICAgIC8vICAgLy8gY29uc29sZS5sb2coJ+mSseWMheS9meminTonKyBhdmFpbGFibGVfYmFsYW5jZSArICIsIGluZGV4PSIgKyBpbmRleCArICIsIHVzZXJjb2RlOiIgKyB0aGlzLnRhYmxlRGF0YVtpbmRleF1bJ3VzZXJjb2RlJ10pOwogICAgICAvLyAgIHRoaXMudGFibGVEYXRhW2luZGV4XVsnYW1vdW50J10gPSBhdmFpbGFibGVfYmFsYW5jZTsKICAgICAgLy8KICAgICAgLy8gfSkuY2F0Y2goZXJyID0+IGVycik7CgoKICAgIH0sCgogICAgc2V0RW1wbG95ZWVBZG1pbjogYXN5bmMgZnVuY3Rpb24oaWQpIHsKICAgICAgbGV0IHJlcyA9IGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdzZXRFbXBsb3llZUFkbWluJywgeyBpZDogaWQgfSkuY2F0Y2goZXJyID0+IGVycik7CiAgICB9LAogICAgdG9EZXRhaWxzKGlkLG5hbWUsY29kZSl7CiAgICAgIGNvbnNvbGUubG9nKCdpZC0tLS0tLS0tc3RhZmZfaWQtLS0nLGlkKQogICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7cGF0aDogYC9zdGFmZk1hbmFnZW1lbnQvZGV0YWlscy8ke2lkfS8ke2NvZGV9YH0pOwogICAgfSwKICAgIGhhbmRsZUVkaXQocm93KXsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRVc2VyRWRpdE1vZGFsJywgdHJ1ZSk7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnZ2V0VXNlckVkaXREYXRhJywgcm93KTsKICAgIH0sCiAgICBoYW5kbGVEZXBvc2l0KHJvdyl7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2V0UGVyc29uYUxEZXBvc2l0TW9kYWwnLCB0cnVlKTsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdnZXRVc2VyRWRpdERhdGEnLCByb3cpOwogICAgfSwKICAgIGhhbmRsZVNlbGVjdCh2YWwpewogICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1NFTEVDVEVEVVNFUkxJU1QnLCB2YWwpOwogICAgfSwKCiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5pbml0KCk7CiAgICB0aGlzLnF1ZXJ5Um9sZSgpOwogIH0sCiAgZGVhY3RpdmF0ZWQoKXsKICAgIHRoaXMuJHJlZnMuc2VsZWN0aW9uLnNlbGVjdEFsbChmYWxzZSk7CiAgfSwKCiAgd2F0Y2g6IHsKICAgIHNlbGVjdEFsbCh2YWwpIHsKICAgICAgaWYodmFsKXsKICAgICAgICB0aGlzLiRyZWZzLnNlbGVjdGlvbi5zZWxlY3RBbGwoZmFsc2UpOwogICAgICB9CiAgICB9LAogICAgdXNlckRhdGEodmFsKXsKICAgICAgaWYodmFsKXsKICAgICAgICB0aGlzLnRhYmxlRGF0YSA9IFtdOwogICAgICAgIGZvcihsZXQgaXRlbSBvZiB2YWwucmVzdWx0KXsKICAgICAgICAgIHRoaXMudGFibGVEYXRhLnB1c2goey4uLml0ZW19KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBmcmVzaFJhbmRvbSh2YWwpewogICAgICBpZih2YWwpewogICAgICAgIHNldFRpbWVvdXQoKCk9PnsKICAgICAgICAgIGlmICh0aGlzLnVzZXJDb2RlRGF0YS5sZW5ndGggPT0gMCl7CiAgICAgICAgICAgIHRoaXMuJHBhcmVudC5xdWVyeSgpOwogICAgICAgICAgfQogICAgICAgICAgZWxzZXsKICAgICAgICAgICAgbGV0IHVzZXJUYWJsZURhdGEgPSB0aGlzLnVzZXJDb2RlRGF0YS5zcGxpdCgiLCIpOwogICAgICAgICAgICBmb3IobGV0IHVzZXJjb2RlIG9mIHVzZXJUYWJsZURhdGEpewogICAgICAgICAgICAgIHRoaXMucXVlcnlVc2VyV2FsbGV0QmFsYW5jZSh1c2VyY29kZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LDEwMDAgKTsKICAgICAgfQogICAgfSwKICB9CgoKfQo="},{"version":3,"sources":["table.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAyBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA","file":"table.vue","sourceRoot":"src/views/staff-management/dining-staff/components","sourcesContent":["<!--  -->\n<template>\n  <div>\n    <Table\n      ref=\"selection\"\n      border\n      stripe\n      :columns='columns'\n      :data='tableData'\n      :loading=\"loading\"\n      @on-selection-change=\"handleSelect\">\n      <template slot=\"role_id\" slot-scope=\"{ row }\">\n        <span>{{ usertype(row.role_id) }}</span>\n      </template>\n     \n      <template slot=\"handle\" slot-scope=\"{ row }\">\n        <Button class=\"margin-right-10\" type=\"success\" ghost size=\"small\" @click=\"toDetails(row.staff_id,row.name,row.usercode)\">查看</Button>\n        <Button class=\"margin-right-10\" type=\"primary\" ghost size=\"small\" @click=\"handleEdit(row)\">编辑</Button>\n        <Button type=\"info\" ghost size=\"small\" @click=\"handleDeposit(row)\">充值/提现</Button>\n      </template>\n    \n    </Table>\n  </div>\n</template>\n<script>\nimport _ from 'underscore';\nimport * as dataConfig from '../dataConfig';\nexport default {\n  name: 'SearchTable',\n  data() {\n    return {\n      columns: [],\n      current_id: '',\n      amountArr: [],\n      tableData: []\n    };\n  },\n\n  props: {\n    selectAll: Number,\n    freshRandom: Number,\n    userCodeData: String,\n  },\n\n  components: {},\n\n  computed: {\n    userData() {\n      return this.$store.state.user.userData;\n    },\n\n    loading() {\n      return this.$store.state.app.tableLoading;\n    },\n    roleList() {\n      return this.$store.state.role.roleList.result;\n    },\n    usertype() {\n      return (id)=>{\n        let val = '';\n        let current = _.find(this.roleList, cur=> {\n          return cur.role_id == id;\n        });\n        val = current ? current.name : '';\n        return val;\n      }\n    },\n \n    submitBatchModal(){\n      return this.$store.state.order.submitBatchModal;\n    }\n  },\n\n  methods: {\n    //获取人员类型列表\n    queryRole: async function() {\n      let params = {\n        merchant_id: this.$store.state.user.curMerchantId,\n        is_enable: 1,\n        page: 1,\n        page_size: 5000\n      };\n      return await this.$store.dispatch('roleList', params).catch(err => err);\n    },\n    init(page) {\n      this.columns = dataConfig.columns;\n      let tmp = {\n        title: '序号',\n        type: \"index\",\n        width: 60,\n        align: \"center\",\n        show: true,\n        indexMethod: (row) => {\n          return row._index+((page || 1) - 1) * this.$parent.page_size + 1;\n        },\n      }\n      this.columns.splice(1,1,tmp);\n      this.columns.forEach((item) => {\n        if (item.key == 'status') {\n          item.render = (h, param) => {\n            let currentRow = param.row;\n            let showValue = currentRow[item.key];\n            let text = showValue == 1 ? '正常' : '已删除';\n            return h('span', {}, text);\n          }\n        }\n      });\n    },\n    //查询员工钱包账户余额信息\n    queryUserWalletBalance(usercode) {\n      if (usercode){\n        let params = {\n          usercode: usercode,\n          merchant_id: this.$store.state.user.curMerchantId,\n        };\n        this.$store.dispatch('userDetail', params).then(res=>{\n          let index = _.findIndex(this.tableData, { usercode : usercode });\n          this.tableData[index]['balance'] = res.data.balance;\n          // console.log('钱包余额:'+ res.data.balance + \", index=\" + index + \", usercode:\" + this.tableData[index]['usercode']);\n        });\n      }\n      // let params = {\n      //   sessionid: this.$store.state.user.token,\n      //   usercode: usercode,\n      //   merchant_code: this.$store.state.user.curMerchantUserCode,\n      // };\n      //\n      // this.$store.dispatch('userWalletBalance', params).then(res=>{\n      //   let walletInfo = _.find(res.info, cur => {\n      //     return cur.merchant_code == params.merchant_code;\n      //   });\n      //   let available_balance = (walletInfo.available_balance/100).toFixed(2);\n      //\n      //   let index = _.findIndex(this.tableData, { usercode : usercode });\n      //   // console.log('钱包余额:'+ available_balance + \", index=\" + index + \", usercode:\" + this.tableData[index]['usercode']);\n      //   this.tableData[index]['amount'] = available_balance;\n      //\n      // }).catch(err => err);\n\n\n    },\n\n    setEmployeeAdmin: async function(id) {\n      let res = await this.$store.dispatch('setEmployeeAdmin', { id: id }).catch(err => err);\n    },\n    toDetails(id,name,code){\n      console.log('id--------staff_id---',id)\n      this.$router.push({path: `/staffManagement/details/${id}/${code}`});\n    },\n    handleEdit(row){\n      this.$store.commit('setUserEditModal', true);\n      this.$store.commit('getUserEditData', row);\n    },\n    handleDeposit(row){\n      this.$store.commit('setPersonaLDepositModal', true);\n      this.$store.commit('getUserEditData', row);\n    },\n    handleSelect(val){\n      this.$store.commit('SELECTEDUSERLIST', val);\n    },\n\n  },\n  mounted() {\n    this.init();\n    this.queryRole();\n  },\n  deactivated(){\n    this.$refs.selection.selectAll(false);\n  },\n\n  watch: {\n    selectAll(val) {\n      if(val){\n        this.$refs.selection.selectAll(false);\n      }\n    },\n    userData(val){\n      if(val){\n        this.tableData = [];\n        for(let item of val.result){\n          this.tableData.push({...item});\n        }\n      }\n    },\n    freshRandom(val){\n      if(val){\n        setTimeout(()=>{\n          if (this.userCodeData.length == 0){\n            this.$parent.query();\n          }\n          else{\n            let userTableData = this.userCodeData.split(\",\");\n            for(let usercode of userTableData){\n              this.queryUserWalletBalance(usercode);\n            }\n          }\n        },1000 );\n      }\n    },\n  }\n\n\n}\n</script>\n<style lang='less' scoped>\n</style>\n"]}]}