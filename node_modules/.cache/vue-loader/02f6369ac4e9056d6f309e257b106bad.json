{"remainingRequest":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhang/canteen_manage/src/views/staff-management/dining-staff/components/personal-deposit-modal.vue?vue&type=style&index=0&id=837c1208&lang=less&scoped=true&","dependencies":[{"path":"/Users/zhang/canteen_manage/src/views/staff-management/dining-staff/components/personal-deposit-modal.vue","mtime":1644998572172},{"path":"/Users/zhang/canteen_manage/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgovZGVlcC8uaXZ1LW1vZGFsLWJvZHl7CiAgIHBhZGRpbmc6IDA7CiAgIC5pdnUtdGFicy1uYXYtY29udGFpbmVyewogICAgIHBhZGRpbmctbGVmdDogMTZweDsKICAgICAgcGFkZGluZy10b3A6IDE2cHg7CiAgIH0KfQovZGVlcC8uaXZ1LWlucHV0LW51bWJlcnsKICB3aWR0aDogMTAwJTsKfQoudGFicy1zdHlsZXsKICAvZGVlcC8uaXZ1LXRhYnMtY29udGVudCB7CiAgICBtYXJnaW4tdG9wOiAtMTZweDsKICAgIC5pdnUtdGFicy10YWJwYW5lIHsKICAgICAgYmFja2dyb3VuZDogI2ZmZjsKICAgICAgcGFkZGluZzogMTZweDsKICAgIH0KICB9CiAgL2RlZXAvLml2dS10YWJzLml2dS10YWJzLWNhcmQgewogICAgLml2dS10YWJzLWJhcnsKICAgICAgLml2dS10YWJzLW5hdi1jb250YWluZXJ7CiAgICAgICAgaGVpZ2h0OiBhdXRvOwogICAgICB9CiAgICAgIC5pdnUtdGFicy10YWJ7CiAgICAgICAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgICAgfQogICAgICAuaXZ1LXRhYnMtdGFiLWFjdGl2ZXsKICAgICAgICBib3JkZXItY29sb3I6ICMyZDhjZjA7CgogICAgICB9CiAgICB9CiAgfQogIC5hbGxfYW1vdW50ewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgcmlnaHQ6IDA7CiAgICB0b3A6IDMwcHg7CiAgICBmb250LXNpemU6IDEycHg7CiAgICBjb2xvcjogIzIyOGVjYTsKICAgIGN1cnNvcjogcG9pbnRlcjsKICB9Cn0K"},{"version":3,"sources":["personal-deposit-modal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4OA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"personal-deposit-modal.vue","sourceRoot":"src/views/staff-management/dining-staff/components","sourcesContent":["<!--  -->\n<template>\n  <Modal v-model=\"personalDepositModal\" width=\"600px\" :footer-hide=\"true\" title=\"充值提现\" >\n    <Row>\n      <Col span=\"8\" class=\"border-right\">\n        <h1 class=\"text-center\" style=\"margin-top:70px\">{{curUserEditData.name}}</h1>\n        <p class=\"text-center margin-bottom-15 margin-top-15\">余额\n        </p>\n        <p class=\"orange-color text-center font-size18\">￥{{ available_balance }}\n          <Icon class=\"margin-left-5 blue-color font-size18 pointer\" type=\"md-refresh\" @click=\"queryUserWalletBalance(curUserEditData.usercode)\"/>\n        </p>\n      </Col>\n      <Col span=\"16\" class=\"tabs-style\">\n        <Tabs v-model=\"tabs\" type=\"card\">\n          <TabPane label=\"充值\" name=\"deposit\">\n            <Form class=\"padding-20\" :model=\"form\" ref=\"perDepositForm\" :rules=\"ruleDepositForm\" :label-width=\"80\">\n              <FormItem label=\"充值金额\" prop=\"amount\">\n                <Input type=\"number\" v-model=\"form.amount\" placeholder=\"请输入充值金额\" @on-keydown=\"verifyDebit\"/>\n              </FormItem>\n              <FormItem label=\"交易备注\" >\n                <Input type=\"text\" v-model=\"form.remark\" maxlength=\"50\" placeholder=\"请输入备注（50字以内）\" />\n              </FormItem>\n              <FormItem class=\"margin-bottom-5\">\n                <Button type=\"primary\" :loading=\"loading\" @click=\"handleDeposit\">确认充值</Button>\n              </FormItem>\n            </Form>\n          </TabPane>\n          <TabPane label=\"提现\" name=\"withdraw\">\n            <Form class=\"padding-20\" :model=\"withdrawForm\" ref=\"withdrawForm\" :rules=\"ruleWithdrawForm\" :label-width=\"80\">\n              <FormItem label=\"提现金额\" prop=\"amount\" style=\"position: relative;\">\n                <Input type=\"number\" v-model=\"withdrawForm.amount\" placeholder=\"请输入提现金额\" @on-keydown=\"verifyDebit\"/>\n                <span class=\"all_amount\" @click=\"handleAllAmount\">全部提现</span>\n              </FormItem>\n              <FormItem label=\"交易备注\" >\n                <Input type=\"text\" v-model=\"withdrawForm.remark\" maxlength=\"50\" placeholder=\"请输入备注（50字以内）\" />\n              </FormItem>\n              <FormItem class=\"margin-bottom-5\">\n                <Button type=\"primary\" :loading=\"loading2\" @click=\"handleWithdraw\">确认提现</Button>\n              </FormItem>\n            </Form>\n          </TabPane>\n        </Tabs>\n\n      </Col>\n    </Row>\n  </Modal>\n</template>\n\n<script>\nimport _ from \"underscore\";\nexport default {\n  data () {\n    return {\n      balance: 0,\n      available_balance: '0.00',\n      tabs: 'deposit',\n      form: {\n        amount: '',\n        remark: ''\n      },\n      withdrawForm: {\n        amount: '',\n        remark: ''\n      },\n      loading: false,\n      loading2: false,\n      ruleDepositForm: {\n        amount: [\n          { required: true,message: '请输入充值金额', trigger: 'blur' }\n        ],\n      },\n      ruleWithdrawForm: {\n        amount: [\n          { required: true,message: '请输入提现金额', trigger: 'change' }\n        ],\n      }\n    };\n  },\n\n  components: {},\n\n  computed: {\n    personalDepositModal:{\n      get(){\n        return this.$store.state.user.personalDepositModal;\n      },\n      set(val){\n        this.$store.commit('setPersonaLDepositModal', val);\n      }\n    },\n    curUserEditData() {\n      return this.$store.state.user.curUserEditData;\n    }\n  },\n\n  methods: {\n\n    //充值金额input\n    verifyDebit(e){\n      // this.form.amount = e;\n      //只能输入两个小数\n      // this.form.amount = this.form.amount.replace(/^()*(\\d+)\\.(\\d\\d).*$/, \"$1$2.$3\");\n      e.target.value = (e.target.value.match(/^\\d*(\\.?\\d{0,1})/g)[0]) || null\n    },\n    // //查询员工钱包账户余额信息，通过用户中心查询\n    // queryUserWalletBalance: async function(usercode) {\n    //\n    //   this.available_balance = '0.00';\n    //   let params = {\n    //     sessionid: this.$store.state.user.token,\n    //     usercode: usercode,\n    //     merchant_code: this.$store.state.user.curMerchantUserCode,\n    //   };\n    //\n    //   let res = await this.$store.dispatch('userWalletBalance', params).catch(err => err);\n    //   let walletInfo = _.find(res.info, cur => {\n    //     return cur.merchant_code == params.merchant_code;\n    //   })\n    //\n    //   if (walletInfo)\n    //   {\n    //     this.balance = walletInfo.balance;\n    //     this.available_balance = (walletInfo.available_balance / 100).toFixed(2);\n    //   }\n    // },\n\n    //查询员工钱包账户余额信息，通过食堂后台查询\n    queryUserWalletBalance: async function(usercode) {\n      if (usercode){\n        let params = {\n          usercode: usercode,\n          merchant_id: this.$store.state.user.curMerchantId,\n        };\n        this.$store.dispatch('userDetail', params).then(res=>{\n          this.$store.commit('getUserEditData', res.data);\n          if (res.data) {\n            this.balance = res.data.balance;\n            this.available_balance = res.data.available_balance;\n          }\n          // let index = _.findIndex(this.tableData, { usercode : usercode });\n          // this.available_balance = res.data.balance;\n          // console.log('钱包余额:'+ res.data.balance + \", index=\" + index + \", usercode:\" + this.tableData[index]['usercode']);\n        });\n      }\n    },\n    // 确认充值\n    handleDeposit() {\n      this.$refs.perDepositForm.validate((valid) => {\n        if(valid){\n          this.loading = true;\n          let params = {\n            merchant_id: this.$store.state.user.curMerchantId,\n            // amount: parseFloat(this.form.amount).toFixed(2).toString().replace(/^-?\\d+/g, m => m.replace(/(?=(?!\\b)(\\d{3})+$)/g, \",\")),\n            amount: this.form.amount,\n            remark: this.form.remark,\n            usercode: this.curUserEditData.usercode,\n            operator: this.$store.state.user.curUserCode,\n          };\n          this.$store.dispatch('userDeposit', params).then(res=>{\n            if(res.return_code == 0){\n              this.loading = false;\n              // this.$Message.success('提交成功！请到<补扣与充值记录>中查看充值是否成功！');\n              this.form = {\n                amount: '',\n                remark: ''\n              };\n              setTimeout(()=>{\n                this.queryUserWalletBalance(this.curUserEditData.usercode);\n              },500 );\n\n              this.$emit('selection', 0, this.curUserEditData.usercode);\n            }\n          }).catch(err => {\n            this.loading = false;\n          });\n        }\n      })\n    },\n\n    // 确认提现\n    handleWithdraw(){\n      this.$refs.withdrawForm.validate((valid) => {\n        if(valid){\n          this.loading2 = true;\n          let params = {\n            merchant_id: this.$store.state.user.curMerchantId,\n            amount: this.withdrawForm.amount,\n            usercode: this.curUserEditData.usercode,\n            remark: this.withdrawForm.remark,\n            operator: this.$store.state.user.curUserCode,\n          }\n          this.$store.dispatch('withdraw', params).then(res=>{\n            if(res.return_code == 0){\n              this.loading2 = false;\n              // this.queryUserWalletBalance(this.curUserEditData.usercode).catch(err => err);\n\n              this.withdrawForm = {\n                amount: '',\n                remark: ''\n              }\n              setTimeout(()=>{\n                this.queryUserWalletBalance(this.curUserEditData.usercode);\n              },500 );\n              this.$emit('selection', 0, this.curUserEditData.usercode);\n              // this.$store.commit('setWithdrawSucModal', true);\n              // this.$store.commit('CURRENT_BILL', res.data);\n            }\n          }).catch(err => {\n            this.loading2 = false;\n          });\n        }\n      })\n    },\n    //点击全部提现\n    handleAllAmount(){\n      this.withdrawForm.amount = this.curUserEditData.balance;\n    }\n  },\n\n  watch:{\n    personalDepositModal(val){\n      if(val){\n        this.queryUserWalletBalance(this.curUserEditData.usercode);\n      }else{\n        this.loading = false;\n        this.loading2 = false;\n        this.tabs = 'deposit';\n      }\n    }\n  }\n\n}\n\n</script>\n<style lang='less' scoped>\n\n  /deep/.ivu-modal-body{\n     padding: 0;\n     .ivu-tabs-nav-container{\n       padding-left: 16px;\n        padding-top: 16px;\n     }\n  }\n  /deep/.ivu-input-number{\n    width: 100%;\n  }\n  .tabs-style{\n    /deep/.ivu-tabs-content {\n      margin-top: -16px;\n      .ivu-tabs-tabpane {\n        background: #fff;\n        padding: 16px;\n      }\n    }\n    /deep/.ivu-tabs.ivu-tabs-card {\n      .ivu-tabs-bar{\n        .ivu-tabs-nav-container{\n          height: auto;\n        }\n        .ivu-tabs-tab{\n          border-color: transparent;\n        }\n        .ivu-tabs-tab-active{\n          border-color: #2d8cf0;\n\n        }\n      }\n    }\n    .all_amount{\n      position: absolute;\n      right: 0;\n      top: 30px;\n      font-size: 12px;\n      color: #228eca;\n      cursor: pointer;\n    }\n  }\n</style>\n"]}]}