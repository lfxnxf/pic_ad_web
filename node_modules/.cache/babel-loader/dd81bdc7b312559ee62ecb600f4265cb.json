{"remainingRequest":"/Users/zhang/canteen_manage/node_modules/babel-loader/lib/index.js!/Users/zhang/canteen_manage/src/libs/platform.js","dependencies":[{"path":"/Users/zhang/canteen_manage/src/libs/platform.js","mtime":1638355006758},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvVXNlcnMvemhhbmcvY2FudGVlbl9tYW5hZ2Uvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvVXNlcnMvemhhbmcvY2FudGVlbl9tYW5hZ2Uvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucGFyc2UtaW50LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZGF0ZS50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQuanMiOwppbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnOwppbXBvcnQgcXMgZnJvbSAncXMnOwppbXBvcnQgc3RvcmUgZnJvbSAnQC9zdG9yZSc7CmltcG9ydCBzaWduIGZyb20gJ0AvbGlicy9zaWduJzsKaW1wb3J0IGRldmljZSBmcm9tICdAL2xpYnMvZGV2aWNlJzsKaW1wb3J0IHsgTWVzc2FnZSB9IGZyb20gJ3ZpZXctZGVzaWduJzsKaW1wb3J0IHsgaGFzT25lT2YgfSBmcm9tICcuL3Rvb2xzJzsKaW1wb3J0IGNvbmZpZyBmcm9tICdAL2NvbmZpZyc7Ci8qKgogICAgKiDnu4Too4XlhazlhbHlj4LmlbAKICAgICogQHBhcmFtIHtTdHJpbmd9IHBhcmFtcyDmjqXlj6PljZXni6zor7fmsYLlj4LmlbAKICAgICovCgpmdW5jdGlvbiBidWlsZFBhcmFtcygpIHsKICB2YXIgcGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAvLyDlhazlhbHlj4LmlbAKICB2YXIgY29tbW9uUGFyYW1zID0gewogICAgYXBwa2V5OiBjb25maWcuVlVFX0FQUF9QTEFURk9STV9BUFBfS0VZLAogICAgY2hhbm5lbF9pZDogY29uZmlnLlZVRV9BUFBfUExBVEZPUk1fQVBQX0NIQU5ORUxfSUQsCiAgICBhcGlfdmVyc2lvbjogJzEnLAogICAgdGltZXN0YW1wOiBwYXJzZUludChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApLAogICAgdWE6ICdwYycsCiAgICBkZXZpY2VpZDogJ3BjJywKICAgIGNsaWVudDogJ3BjJywKICAgIHByb2R1Y3RfY29kZTogJzMxMTknLAogICAgbm9uY2U6IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCAxNSkKICB9OyAvLyDlkIjlubblj4LmlbAKCiAgdmFyIGJ1aWxkUGFyYW1zID0gT2JqZWN0LmFzc2lnbihjb21tb25QYXJhbXMsIHBhcmFtcyk7CiAgT2JqZWN0LmtleXMoYnVpbGRQYXJhbXMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgaWYgKGJ1aWxkUGFyYW1zW2tleV0gPT09IG51bGwgfHwgYnVpbGRQYXJhbXNba2V5XSA9PT0gdW5kZWZpbmVkIHx8IGJ1aWxkUGFyYW1zW2tleV0gPT0gJycpIHsKICAgICAgZGVsZXRlIGJ1aWxkUGFyYW1zW2tleV07CiAgICB9CiAgfSk7IC8vIOetvuWQjQoKICBidWlsZFBhcmFtcy5zaWduID0gc2lnbihidWlsZFBhcmFtcywgY29uZmlnLmFwaVVybCwgY29uZmlnLlZVRV9BUFBfUExBVEZPUk1fQVBQX1NFQ1JFVCk7CiAgcmV0dXJuIGJ1aWxkUGFyYW1zOwp9IC8vIGNvbnN0IGFkZEVycm9yTG9nID0gZXJyb3JJbmZvID0+IHsKLy8gICBjb25zdCB7IHN0YXR1c1RleHQsIHN0YXR1cywgcmVxdWVzdDogeyByZXNwb25zZVVSTCB9IH0gPSBlcnJvckluZm8KLy8gICBjb25zdCBpbmZvID0gewovLyAgICAgdHlwZTogJ2FqYXgnLAovLyAgICAgY29kZTogc3RhdHVzLAovLyAgICAgbWVzOiBzdGF0dXNUZXh0LAovLyAgICAgdXJsOiByZXNwb25zZVVSTAovLyAgIH0KLy8gICBpZiAoIXJlc3BvbnNlVVJMLmluY2x1ZGVzKCdzYXZlX2Vycm9yX2xvZ2dlcicpKSBzdG9yZS5kaXNwYXRjaCgnYWRkRXJyb3JMb2cnLCBpbmZvKQovLyB9CgoKdmFyIFBsYXRmb3JtQXBpcyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gUGxhdGZvcm1BcGlzKGJhc2VVcmwpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQbGF0Zm9ybUFwaXMpOwoKICAgIHRoaXMuYmFzZVVybCA9IGJhc2VVcmw7CiAgICB0aGlzLnF1ZXVlID0ge307CiAgfQoKICBfY3JlYXRlQ2xhc3MoUGxhdGZvcm1BcGlzLCBbewogICAga2V5OiAiZ2V0SW5zaWRlQ29uZmlnIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJbnNpZGVDb25maWcoKSB7CiAgICAgIHZhciBjb25maWcgPSB7CiAgICAgICAgYmFzZVVSTDogdGhpcy5iYXNlVXJsLAogICAgICAgIGhlYWRlcnM6IHt9CiAgICAgIH07CiAgICAgIHJldHVybiBjb25maWc7CiAgICB9CiAgfSwgewogICAga2V5OiAiZGVzdHJveSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSh1cmwpIHsKICAgICAgZGVsZXRlIHRoaXMucXVldWVbdXJsXTsgLy8gaWYgKCFPYmplY3Qua2V5cyh0aGlzLnF1ZXVlKS5sZW5ndGgpIHsKICAgICAgLy8gICBTcGluLmhpZGUoKQogICAgICAvLyB9CiAgICB9CiAgfSwgewogICAga2V5OiAiaW50ZXJjZXB0b3JzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbnRlcmNlcHRvcnMoaW5zdGFuY2UsIHVybCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgLy8g6K+35rGC5oum5oiqCiAgICAgIGluc3RhbmNlLmludGVyY2VwdG9ycy5yZXF1ZXN0LnVzZShmdW5jdGlvbiAoY29uZmlnKSB7CiAgICAgICAgLy8g5re75Yqg5YWo5bGA55qEbG9hZGluZy4uLgogICAgICAgIC8vIGlmICghT2JqZWN0LmtleXModGhpcy5xdWV1ZSkubGVuZ3RoKSB7CiAgICAgICAgLy8gICBTcGluLnNob3coKSAvLyDkuI3lu7rorq7lvIDlkK/vvIzlm6DkuLrnlYzpnaLkuI3lj4vlpb0KICAgICAgICAvLyB9CiAgICAgICAgX3RoaXMucXVldWVbdXJsXSA9IHRydWU7CiAgICAgICAgdmFyIHRva2VuID0gc3RvcmUuc3RhdGUucGxhdGZvcm0uc2Vzc2lvbmlkOwoKICAgICAgICBpZiAoIWhhc09uZU9mKGNvbmZpZy5kYXRhLm1ldGhvZC5zcGxpdCgnLicpLCBbJ2xvZ2luJywgJ3JlZ2lzdGVyJ10pKSB7CiAgICAgICAgICBpZiAoIWNvbmZpZy5wYXJhbXMpIHsKICAgICAgICAgICAgY29uZmlnLnBhcmFtcyA9IHt9OwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0b2tlbikgewogICAgICAgICAgICBjb25maWcucGFyYW1zLnNlc3Npb25pZCA9IHRva2VuOwogICAgICAgICAgfQogICAgICAgIH0gLy8gdG9rZW4gJiYgKGNvbmZpZy5oZWFkZXJzLnNlc3Npb25pZCA9IHRva2VuKQoKCiAgICAgICAgdmFyIGRhdGEgPSBjb25maWcuZGF0YTsgLy8gcmVtb3ZlZCB0aGUgaGFyZGNvcmUgY29kZSB3aGVuIGRlcGxveSB0byBwcm9kCiAgICAgICAgLy8gaWYgKGRhdGEubWV0aG9kLmluY2x1ZGVzKCcubWVyY2hhbnQuJykgJiYgIWhhc0tleShkYXRhLCAnc3RvcmVfaWQnKSkgZGF0YS5zdG9yZV9pZCA9IHByb2Nlc3MuZW52LlZVRV9BUFBfU1RPUkVfSUQKCiAgICAgICAgZGF0YSAmJiAoY29uZmlnLmRhdGEgPSBxcy5zdHJpbmdpZnkoYnVpbGRQYXJhbXMoZGF0YSkpKTsKICAgICAgICByZXR1cm4gY29uZmlnOwogICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwogICAgICB9KTsgLy8g5ZON5bqU5oum5oiqCgogICAgICBpbnN0YW5jZS5pbnRlcmNlcHRvcnMucmVzcG9uc2UudXNlKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpcy5kZXN0cm95KHVybCk7IC8vIHJlcy5kYXRh5pWw5o2u6YOo5YiG5qC85byP5Li677yaeyBkYXRhOiAuLi4sIHJldHVybl9jb2RlOiAuLi4sIHJldHVybl9tZXNzYWdlOiAuLi59CgoKICAgICAgICB2YXIgX3JlcyRkYXRhID0gcmVzLmRhdGEsCiAgICAgICAgICAgIGRhdGEgPSBfcmVzJGRhdGEuZGF0YSwKICAgICAgICAgICAgcmV0dXJuX2NvZGUgPSBfcmVzJGRhdGEucmV0dXJuX2NvZGUsCiAgICAgICAgICAgIHJldHVybl9tZXNzYWdlID0gX3JlcyRkYXRhLnJldHVybl9tZXNzYWdlOwoKICAgICAgICBpZiAocmV0dXJuX2NvZGUgPT09IDApIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgIHJldHVybl9jb2RlOiByZXR1cm5fY29kZSwKICAgICAgICAgICAgcmV0dXJuX21lc3NhZ2U6IHJldHVybl9tZXNzYWdlCiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBjb25zdCB7IHJlcXVlc3Q6IHsgc3RhdHVzVGV4dCwgc3RhdHVzIH0sIGNvbmZpZyB9ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShlcnJvcikpCiAgICAgICAgICAvLyBjb25zdCBlcnJvckluZm8gPSB7CiAgICAgICAgICAvLyAgIHN0YXR1c1RleHQ6IHJldHVybl9tZXNzYWdlLAogICAgICAgICAgLy8gICBzdGF0dXM6IHJldHVybl9jb2RlLAogICAgICAgICAgLy8gICByZXF1ZXN0OiB7IHJlc3BvbnNlVVJMOiBgW2FwaeKAonBsYXRmb3JtXSR7dXJsfWAgfQogICAgICAgICAgLy8gfQogICAgICAgICAgLy8gYWRkRXJyb3JMb2coZXJyb3JJbmZvKQogICAgICAgICAgTWVzc2FnZS5lcnJvcih7CiAgICAgICAgICAgIGNvbnRlbnQ6IHJldHVybl9tZXNzYWdlLAogICAgICAgICAgICBjbG9zYWJsZTogdHJ1ZSwKICAgICAgICAgICAgZHVyYXRpb246IDUKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHJlcy5kYXRhKTsKICAgICAgICB9CiAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgIC8vIGNvbnNvbGUubG9nKGVycm9yKQogICAgICAgIC8vIGNvbnNvbGUubG9nKGVycm9yLnJlc3BvbnNlKQogICAgICAgIF90aGlzLmRlc3Ryb3kodXJsKTsgLy8gbGV0IGVycm9ySW5mbyA9IGVycm9yLnJlc3BvbnNlCiAgICAgICAgLy8gaWYgKCFlcnJvckluZm8pIHsKICAgICAgICAvLyAgIGNvbnN0IHsgcmVxdWVzdDogeyBzdGF0dXNUZXh0LCBzdGF0dXMgfSwgY29uZmlnIH0gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGVycm9yKSkKICAgICAgICAvLyAgIGVycm9ySW5mbyA9IHsKICAgICAgICAvLyAgICAgc3RhdHVzVGV4dCwKICAgICAgICAvLyAgICAgc3RhdHVzLAogICAgICAgIC8vICAgICByZXF1ZXN0OiB7IHJlc3BvbnNlVVJMOiBjb25maWcudXJsIH0KICAgICAgICAvLyAgIH0KICAgICAgICAvLyB9CiAgICAgICAgLy8gYWRkRXJyb3JMb2coZXJyb3JJbmZvKQoKCiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVxdWVzdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVxdWVzdChvcHRpb25zKSB7CiAgICAgIHZhciBpbnN0YW5jZSA9IGF4aW9zLmNyZWF0ZSgpOwogICAgICBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih0aGlzLmdldEluc2lkZUNvbmZpZygpLCBvcHRpb25zKTsKICAgICAgdGhpcy5pbnRlcmNlcHRvcnMoaW5zdGFuY2UsIG9wdGlvbnMudXJsKTsKICAgICAgcmV0dXJuIGluc3RhbmNlKG9wdGlvbnMpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFBsYXRmb3JtQXBpczsKfSgpOwoKZXhwb3J0IGRlZmF1bHQgUGxhdGZvcm1BcGlzOw=="},{"version":3,"sources":["/Users/zhang/canteen_manage/src/libs/platform.js"],"names":["axios","qs","store","sign","device","Message","hasOneOf","config","buildParams","params","commonParams","appkey","VUE_APP_PLATFORM_APP_KEY","channel_id","VUE_APP_PLATFORM_APP_CHANNEL_ID","api_version","timestamp","parseInt","Date","getTime","ua","deviceid","client","product_code","nonce","Math","random","toString","substr","Object","assign","keys","forEach","key","undefined","apiUrl","VUE_APP_PLATFORM_APP_SECRET","PlatformApis","baseUrl","queue","baseURL","headers","url","instance","interceptors","request","use","token","state","platform","sessionid","data","method","split","stringify","error","Promise","reject","response","res","destroy","return_code","return_message","content","closable","duration","options","create","getInsideConfig"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport qs from 'qs'\nimport store from '@/store'\nimport sign from '@/libs/sign'\nimport device from '@/libs/device'\nimport { Message } from 'view-design'\nimport { hasOneOf } from './tools'\nimport config from '@/config'\n\n/**\n    * 组装公共参数\n    * @param {String} params 接口单独请求参数\n    */\nfunction buildParams (params = {}) {\n  // 公共参数\n  const commonParams = {\n    appkey: config.VUE_APP_PLATFORM_APP_KEY,\n    channel_id: config.VUE_APP_PLATFORM_APP_CHANNEL_ID,\n    api_version: '1',\n    timestamp: parseInt(new Date().getTime() / 1000),\n    ua: 'pc',\n    deviceid: 'pc',\n    client: 'pc',\n    product_code: '3119',\n    nonce: Math.random().toString(36).substr(2, 15)\n  }\n  // 合并参数\n  const buildParams = Object.assign(commonParams, params)\n  Object.keys(buildParams).forEach((key) => {\n    if (buildParams[key] === null || buildParams[key] === undefined || buildParams[key]=='') {\n      delete buildParams[key]\n    }\n  })\n  // 签名\n  buildParams.sign = sign(buildParams, config.apiUrl, config.VUE_APP_PLATFORM_APP_SECRET)\n  return buildParams\n}\n\n// const addErrorLog = errorInfo => {\n//   const { statusText, status, request: { responseURL } } = errorInfo\n//   const info = {\n//     type: 'ajax',\n//     code: status,\n//     mes: statusText,\n//     url: responseURL\n//   }\n//   if (!responseURL.includes('save_error_logger')) store.dispatch('addErrorLog', info)\n// }\n\nclass PlatformApis {\n  constructor (baseUrl) {\n    this.baseUrl = baseUrl\n    this.queue = {}\n  }\n\n  getInsideConfig () {\n    const config = {\n      baseURL: this.baseUrl,\n      headers: {}\n    }\n    return config\n  }\n\n  destroy (url) {\n    delete this.queue[url]\n    // if (!Object.keys(this.queue).length) {\n    //   Spin.hide()\n    // }\n  }\n\n  interceptors (instance, url) {\n    // 请求拦截\n    instance.interceptors.request.use(config => {\n      // 添加全局的loading...\n      // if (!Object.keys(this.queue).length) {\n      //   Spin.show() // 不建议开启，因为界面不友好\n      // }\n      this.queue[url] = true\n      const token = store.state.platform.sessionid\n      if (!hasOneOf(config.data.method.split('.'), ['login','register'])) {\n        if (!config.params) {\n          config.params = {}\n        }\n        if (token) {\n          config.params.sessionid = token\n        }\n      }\n      // token && (config.headers.sessionid = token)\n      const data = config.data\n\n      // removed the hardcore code when deploy to prod\n      // if (data.method.includes('.merchant.') && !hasKey(data, 'store_id')) data.store_id = process.env.VUE_APP_STORE_ID\n\n      data && (config.data = qs.stringify(buildParams(data)))\n      return config\n    }, error => {\n      return Promise.reject(error)\n    })\n    // 响应拦截\n    instance.interceptors.response.use(res => {\n      this.destroy(url)\n      // res.data数据部分格式为：{ data: ..., return_code: ..., return_message: ...}\n      const { data, return_code, return_message } = res.data\n      if (return_code === 0) {\n        return { data, return_code, return_message }\n      } else {\n        // const { request: { statusText, status }, config } = JSON.parse(JSON.stringify(error))\n        // const errorInfo = {\n        //   statusText: return_message,\n        //   status: return_code,\n        //   request: { responseURL: `[api•platform]${url}` }\n        // }\n        // addErrorLog(errorInfo)\n        Message.error({ content: return_message, closable: true, duration: 5 })\n        return Promise.reject(res.data)\n      }\n    }, error => {\n      // console.log(error)\n      // console.log(error.response)\n      this.destroy(url)\n      // let errorInfo = error.response\n      // if (!errorInfo) {\n      //   const { request: { statusText, status }, config } = JSON.parse(JSON.stringify(error))\n      //   errorInfo = {\n      //     statusText,\n      //     status,\n      //     request: { responseURL: config.url }\n      //   }\n      // }\n      // addErrorLog(errorInfo)\n      return Promise.reject(error)\n    })\n  }\n\n  request (options) {\n    const instance = axios.create()\n    options = Object.assign(this.getInsideConfig(), options)\n    this.interceptors(instance, options.url)\n    return instance(options)\n  }\n}\nexport default PlatformApis\n"]}]}