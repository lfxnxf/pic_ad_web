{"remainingRequest":"/Users/zhang/canteen_manage/node_modules/babel-loader/lib/index.js!/Users/zhang/canteen_manage/src/libs/platform.js","dependencies":[{"path":"/Users/zhang/canteen_manage/src/libs/platform.js","mtime":1639468524267},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvVXNlcnMvemhhbmcvY2FudGVlbl9tYW5hZ2Uvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvVXNlcnMvemhhbmcvY2FudGVlbl9tYW5hZ2Uvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucGFyc2UtaW50LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZGF0ZS50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQuanMiOwppbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnOwppbXBvcnQgcXMgZnJvbSAncXMnOwppbXBvcnQgc3RvcmUgZnJvbSAnQC9zdG9yZSc7CmltcG9ydCBzaWduIGZyb20gJ0AvbGlicy9zaWduJzsKaW1wb3J0IGRldmljZSBmcm9tICdAL2xpYnMvZGV2aWNlJzsKaW1wb3J0IHsgTWVzc2FnZSB9IGZyb20gJ3ZpZXctZGVzaWduJzsKaW1wb3J0IHsgaGFzT25lT2YgfSBmcm9tICcuL3Rvb2xzJzsKaW1wb3J0IGNvbmZpZyBmcm9tICdAL2NvbmZpZyc7Ci8qKgogICAgKiDnu4Too4XlhazlhbHlj4LmlbAKICAgICogQHBhcmFtIHtTdHJpbmd9IHBhcmFtcyDmjqXlj6PljZXni6zor7fmsYLlj4LmlbAKICAgICovCgpmdW5jdGlvbiBidWlsZFBhcmFtcygpIHsKICB2YXIgcGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAvLyDlhazlhbHlj4LmlbAKICB2YXIgY29tbW9uUGFyYW1zID0gewogICAgYXBwa2V5OiBjb25maWcuVlVFX0FQUF9QTEFURk9STV9BUFBfS0VZLAogICAgY2hhbm5lbF9pZDogY29uZmlnLlZVRV9BUFBfUExBVEZPUk1fQVBQX0NIQU5ORUxfSUQsCiAgICBhcGlfdmVyc2lvbjogJzEnLAogICAgdGltZXN0YW1wOiBwYXJzZUludChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApLAogICAgdWE6ICdwYycsCiAgICBkZXZpY2VpZDogJ3BjJywKICAgIGNsaWVudDogJ3BjJywKICAgIHByb2R1Y3RfY29kZTogJzMxMTknLAogICAgbm9uY2U6IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCAxNSkKICB9OyAvLyDlkIjlubblj4LmlbAKCiAgdmFyIGJ1aWxkUGFyYW1zID0gT2JqZWN0LmFzc2lnbihjb21tb25QYXJhbXMsIHBhcmFtcyk7CiAgT2JqZWN0LmtleXMoYnVpbGRQYXJhbXMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgaWYgKGJ1aWxkUGFyYW1zW2tleV0gPT09IG51bGwgfHwgYnVpbGRQYXJhbXNba2V5XSA9PT0gdW5kZWZpbmVkIHx8IGJ1aWxkUGFyYW1zW2tleV0gPT09ICcnKSB7CiAgICAgIGRlbGV0ZSBidWlsZFBhcmFtc1trZXldOwogICAgfQogIH0pOyAvLyDnrb7lkI0KCiAgYnVpbGRQYXJhbXMuc2lnbiA9IHNpZ24oYnVpbGRQYXJhbXMsIGNvbmZpZy5hcGlVcmwsIGNvbmZpZy5WVUVfQVBQX1BMQVRGT1JNX0FQUF9TRUNSRVQpOwogIHJldHVybiBidWlsZFBhcmFtczsKfSAvLyBjb25zdCBhZGRFcnJvckxvZyA9IGVycm9ySW5mbyA9PiB7Ci8vICAgY29uc3QgeyBzdGF0dXNUZXh0LCBzdGF0dXMsIHJlcXVlc3Q6IHsgcmVzcG9uc2VVUkwgfSB9ID0gZXJyb3JJbmZvCi8vICAgY29uc3QgaW5mbyA9IHsKLy8gICAgIHR5cGU6ICdhamF4JywKLy8gICAgIGNvZGU6IHN0YXR1cywKLy8gICAgIG1lczogc3RhdHVzVGV4dCwKLy8gICAgIHVybDogcmVzcG9uc2VVUkwKLy8gICB9Ci8vICAgaWYgKCFyZXNwb25zZVVSTC5pbmNsdWRlcygnc2F2ZV9lcnJvcl9sb2dnZXInKSkgc3RvcmUuZGlzcGF0Y2goJ2FkZEVycm9yTG9nJywgaW5mbykKLy8gfQoKCnZhciBQbGF0Zm9ybUFwaXMgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFBsYXRmb3JtQXBpcyhiYXNlVXJsKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUGxhdGZvcm1BcGlzKTsKCiAgICB0aGlzLmJhc2VVcmwgPSBiYXNlVXJsOwogICAgdGhpcy5xdWV1ZSA9IHt9OwogIH0KCiAgX2NyZWF0ZUNsYXNzKFBsYXRmb3JtQXBpcywgW3sKICAgIGtleTogImdldEluc2lkZUNvbmZpZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0SW5zaWRlQ29uZmlnKCkgewogICAgICB2YXIgY29uZmlnID0gewogICAgICAgIGJhc2VVUkw6IHRoaXMuYmFzZVVybCwKICAgICAgICBoZWFkZXJzOiB7fQogICAgICB9OwogICAgICByZXR1cm4gY29uZmlnOwogICAgfQogIH0sIHsKICAgIGtleTogImRlc3Ryb3kiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3kodXJsKSB7CiAgICAgIGRlbGV0ZSB0aGlzLnF1ZXVlW3VybF07IC8vIGlmICghT2JqZWN0LmtleXModGhpcy5xdWV1ZSkubGVuZ3RoKSB7CiAgICAgIC8vICAgU3Bpbi5oaWRlKCkKICAgICAgLy8gfQogICAgfQogIH0sIHsKICAgIGtleTogImludGVyY2VwdG9ycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW50ZXJjZXB0b3JzKGluc3RhbmNlLCB1cmwpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIC8vIOivt+axguaLpuaIqgogICAgICBpbnN0YW5jZS5pbnRlcmNlcHRvcnMucmVxdWVzdC51c2UoZnVuY3Rpb24gKGNvbmZpZykgewogICAgICAgIC8vIOa3u+WKoOWFqOWxgOeahGxvYWRpbmcuLi4KICAgICAgICAvLyBpZiAoIU9iamVjdC5rZXlzKHRoaXMucXVldWUpLmxlbmd0aCkgewogICAgICAgIC8vICAgU3Bpbi5zaG93KCkgLy8g5LiN5bu66K6u5byA5ZCv77yM5Zug5Li655WM6Z2i5LiN5Y+L5aW9CiAgICAgICAgLy8gfQogICAgICAgIF90aGlzLnF1ZXVlW3VybF0gPSB0cnVlOwogICAgICAgIHZhciB0b2tlbiA9IHN0b3JlLnN0YXRlLnBsYXRmb3JtLnNlc3Npb25pZDsKCiAgICAgICAgaWYgKCFoYXNPbmVPZihjb25maWcuZGF0YS5tZXRob2Quc3BsaXQoJy4nKSwgWydsb2dpbicsICdyZWdpc3RlciddKSkgewogICAgICAgICAgaWYgKCFjb25maWcucGFyYW1zKSB7CiAgICAgICAgICAgIGNvbmZpZy5wYXJhbXMgPSB7fTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodG9rZW4pIHsKICAgICAgICAgICAgY29uZmlnLnBhcmFtcy5zZXNzaW9uaWQgPSB0b2tlbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIHRva2VuICYmIChjb25maWcuaGVhZGVycy5zZXNzaW9uaWQgPSB0b2tlbikKCgogICAgICAgIHZhciBkYXRhID0gY29uZmlnLmRhdGE7IC8vIHJlbW92ZWQgdGhlIGhhcmRjb3JlIGNvZGUgd2hlbiBkZXBsb3kgdG8gcHJvZAogICAgICAgIC8vIGlmIChkYXRhLm1ldGhvZC5pbmNsdWRlcygnLm1lcmNoYW50LicpICYmICFoYXNLZXkoZGF0YSwgJ3N0b3JlX2lkJykpIGRhdGEuc3RvcmVfaWQgPSBwcm9jZXNzLmVudi5WVUVfQVBQX1NUT1JFX0lECgogICAgICAgIGRhdGEgJiYgKGNvbmZpZy5kYXRhID0gcXMuc3RyaW5naWZ5KGJ1aWxkUGFyYW1zKGRhdGEpKSk7CiAgICAgICAgcmV0dXJuIGNvbmZpZzsKICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgfSk7IC8vIOWTjeW6lOaLpuaIqgoKICAgICAgaW5zdGFuY2UuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLnVzZShmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMuZGVzdHJveSh1cmwpOyAvLyByZXMuZGF0YeaVsOaNrumDqOWIhuagvOW8j+S4uu+8mnsgZGF0YTogLi4uLCByZXR1cm5fY29kZTogLi4uLCByZXR1cm5fbWVzc2FnZTogLi4ufQoKCiAgICAgICAgdmFyIF9yZXMkZGF0YSA9IHJlcy5kYXRhLAogICAgICAgICAgICBkYXRhID0gX3JlcyRkYXRhLmRhdGEsCiAgICAgICAgICAgIHJldHVybl9jb2RlID0gX3JlcyRkYXRhLnJldHVybl9jb2RlLAogICAgICAgICAgICByZXR1cm5fbWVzc2FnZSA9IF9yZXMkZGF0YS5yZXR1cm5fbWVzc2FnZTsKCiAgICAgICAgaWYgKHJldHVybl9jb2RlID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgICByZXR1cm5fY29kZTogcmV0dXJuX2NvZGUsCiAgICAgICAgICAgIHJldHVybl9tZXNzYWdlOiByZXR1cm5fbWVzc2FnZQogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gY29uc3QgeyByZXF1ZXN0OiB7IHN0YXR1c1RleHQsIHN0YXR1cyB9LCBjb25maWcgfSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZXJyb3IpKQogICAgICAgICAgLy8gY29uc3QgZXJyb3JJbmZvID0gewogICAgICAgICAgLy8gICBzdGF0dXNUZXh0OiByZXR1cm5fbWVzc2FnZSwKICAgICAgICAgIC8vICAgc3RhdHVzOiByZXR1cm5fY29kZSwKICAgICAgICAgIC8vICAgcmVxdWVzdDogeyByZXNwb25zZVVSTDogYFthcGnigKJwbGF0Zm9ybV0ke3VybH1gIH0KICAgICAgICAgIC8vIH0KICAgICAgICAgIC8vIGFkZEVycm9yTG9nKGVycm9ySW5mbykKICAgICAgICAgIE1lc3NhZ2UuZXJyb3IoewogICAgICAgICAgICBjb250ZW50OiByZXR1cm5fbWVzc2FnZSwKICAgICAgICAgICAgY2xvc2FibGU6IHRydWUsCiAgICAgICAgICAgIGR1cmF0aW9uOiA1CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChyZXMuZGF0YSk7CiAgICAgICAgfQogICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZyhlcnJvcikKICAgICAgICAvLyBjb25zb2xlLmxvZyhlcnJvci5yZXNwb25zZSkKICAgICAgICBfdGhpcy5kZXN0cm95KHVybCk7IC8vIGxldCBlcnJvckluZm8gPSBlcnJvci5yZXNwb25zZQogICAgICAgIC8vIGlmICghZXJyb3JJbmZvKSB7CiAgICAgICAgLy8gICBjb25zdCB7IHJlcXVlc3Q6IHsgc3RhdHVzVGV4dCwgc3RhdHVzIH0sIGNvbmZpZyB9ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShlcnJvcikpCiAgICAgICAgLy8gICBlcnJvckluZm8gPSB7CiAgICAgICAgLy8gICAgIHN0YXR1c1RleHQsCiAgICAgICAgLy8gICAgIHN0YXR1cywKICAgICAgICAvLyAgICAgcmVxdWVzdDogeyByZXNwb25zZVVSTDogY29uZmlnLnVybCB9CiAgICAgICAgLy8gICB9CiAgICAgICAgLy8gfQogICAgICAgIC8vIGFkZEVycm9yTG9nKGVycm9ySW5mbykKCgogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInJlcXVlc3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlcXVlc3Qob3B0aW9ucykgewogICAgICB2YXIgaW5zdGFuY2UgPSBheGlvcy5jcmVhdGUoKTsKICAgICAgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24odGhpcy5nZXRJbnNpZGVDb25maWcoKSwgb3B0aW9ucyk7CiAgICAgIHRoaXMuaW50ZXJjZXB0b3JzKGluc3RhbmNlLCBvcHRpb25zLnVybCk7CiAgICAgIHJldHVybiBpbnN0YW5jZShvcHRpb25zKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBQbGF0Zm9ybUFwaXM7Cn0oKTsKCmV4cG9ydCBkZWZhdWx0IFBsYXRmb3JtQXBpczs="},{"version":3,"sources":["/Users/zhang/canteen_manage/src/libs/platform.js"],"names":["axios","qs","store","sign","device","Message","hasOneOf","config","buildParams","params","commonParams","appkey","VUE_APP_PLATFORM_APP_KEY","channel_id","VUE_APP_PLATFORM_APP_CHANNEL_ID","api_version","timestamp","parseInt","Date","getTime","ua","deviceid","client","product_code","nonce","Math","random","toString","substr","Object","assign","keys","forEach","key","undefined","apiUrl","VUE_APP_PLATFORM_APP_SECRET","PlatformApis","baseUrl","queue","baseURL","headers","url","instance","interceptors","request","use","token","state","platform","sessionid","data","method","split","stringify","error","Promise","reject","response","res","destroy","return_code","return_message","content","closable","duration","options","create","getInsideConfig"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport qs from 'qs'\nimport store from '@/store'\nimport sign from '@/libs/sign'\nimport device from '@/libs/device'\nimport { Message } from 'view-design'\nimport { hasOneOf } from './tools'\nimport config from '@/config'\n\n/**\n    * 组装公共参数\n    * @param {String} params 接口单独请求参数\n    */\nfunction buildParams (params = {}) {\n  // 公共参数\n  const commonParams = {\n    appkey: config.VUE_APP_PLATFORM_APP_KEY,\n    channel_id: config.VUE_APP_PLATFORM_APP_CHANNEL_ID,\n    api_version: '1',\n    timestamp: parseInt(new Date().getTime() / 1000),\n    ua: 'pc',\n    deviceid: 'pc',\n    client: 'pc',\n    product_code: '3119',\n    nonce: Math.random().toString(36).substr(2, 15)\n  }\n  // 合并参数\n  const buildParams = Object.assign(commonParams, params);\n  Object.keys(buildParams).forEach((key) => {\n    if (buildParams[key] === null || buildParams[key] === undefined || buildParams[key]==='') {\n      delete buildParams[key]\n    }\n  })\n  // 签名\n  buildParams.sign = sign(buildParams, config.apiUrl, config.VUE_APP_PLATFORM_APP_SECRET)\n  return buildParams\n}\n\n// const addErrorLog = errorInfo => {\n//   const { statusText, status, request: { responseURL } } = errorInfo\n//   const info = {\n//     type: 'ajax',\n//     code: status,\n//     mes: statusText,\n//     url: responseURL\n//   }\n//   if (!responseURL.includes('save_error_logger')) store.dispatch('addErrorLog', info)\n// }\n\nclass PlatformApis {\n  constructor (baseUrl) {\n    this.baseUrl = baseUrl\n    this.queue = {}\n  }\n\n  getInsideConfig () {\n    const config = {\n      baseURL: this.baseUrl,\n      headers: {}\n    }\n    return config\n  }\n\n  destroy (url) {\n    delete this.queue[url]\n    // if (!Object.keys(this.queue).length) {\n    //   Spin.hide()\n    // }\n  }\n\n  interceptors (instance, url) {\n    // 请求拦截\n    instance.interceptors.request.use(config => {\n      // 添加全局的loading...\n      // if (!Object.keys(this.queue).length) {\n      //   Spin.show() // 不建议开启，因为界面不友好\n      // }\n      this.queue[url] = true\n      const token = store.state.platform.sessionid\n      if (!hasOneOf(config.data.method.split('.'), ['login','register'])) {\n        if (!config.params) {\n          config.params = {}\n        }\n        if (token) {\n          config.params.sessionid = token\n        }\n      }\n      // token && (config.headers.sessionid = token)\n      const data = config.data\n\n      // removed the hardcore code when deploy to prod\n      // if (data.method.includes('.merchant.') && !hasKey(data, 'store_id')) data.store_id = process.env.VUE_APP_STORE_ID\n\n      data && (config.data = qs.stringify(buildParams(data)))\n      return config\n    }, error => {\n      return Promise.reject(error)\n    })\n    // 响应拦截\n    instance.interceptors.response.use(res => {\n      this.destroy(url)\n      // res.data数据部分格式为：{ data: ..., return_code: ..., return_message: ...}\n      const { data, return_code, return_message } = res.data\n      if (return_code === 0) {\n        return { data, return_code, return_message }\n      } else {\n        // const { request: { statusText, status }, config } = JSON.parse(JSON.stringify(error))\n        // const errorInfo = {\n        //   statusText: return_message,\n        //   status: return_code,\n        //   request: { responseURL: `[api•platform]${url}` }\n        // }\n        // addErrorLog(errorInfo)\n        Message.error({ content: return_message, closable: true, duration: 5 })\n        return Promise.reject(res.data)\n      }\n    }, error => {\n      // console.log(error)\n      // console.log(error.response)\n      this.destroy(url)\n      // let errorInfo = error.response\n      // if (!errorInfo) {\n      //   const { request: { statusText, status }, config } = JSON.parse(JSON.stringify(error))\n      //   errorInfo = {\n      //     statusText,\n      //     status,\n      //     request: { responseURL: config.url }\n      //   }\n      // }\n      // addErrorLog(errorInfo)\n      return Promise.reject(error)\n    })\n  }\n\n  request (options) {\n    const instance = axios.create()\n    options = Object.assign(this.getInsideConfig(), options);\n    this.interceptors(instance, options.url)\n    return instance(options)\n  }\n}\nexport default PlatformApis\n"]}]}