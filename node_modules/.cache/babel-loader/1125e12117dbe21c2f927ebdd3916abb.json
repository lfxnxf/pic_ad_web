{"remainingRequest":"/Users/zhang/canteen_manage/node_modules/babel-loader/lib/index.js!/Users/zhang/canteen_manage/src/libs/util.js","dependencies":[{"path":"/Users/zhang/canteen_manage/src/libs/util.js","mtime":1640065471601},{"path":"/Users/zhang/canteen_manage/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhang/canteen_manage/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICIvVXNlcnMvemhhbmcvY2FudGVlbl9tYW5hZ2Uvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL1VzZXJzL3poYW5nL2NhbnRlZW5fbWFuYWdlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZGF0ZS50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb21lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC1pbmRleC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnRyaW0uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5ldmVyeS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluZGV4LW9mLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucGFyc2UtZmxvYXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIudG8tZml4ZWQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwuanMiOwppbXBvcnQgQ29va2llcyBmcm9tICdqcy1jb29raWUnOyAvLyBjb29raWXkv53lrZjnmoTlpKnmlbAKCmltcG9ydCBjb25maWcgZnJvbSAnQC9jb25maWcnOwppbXBvcnQgeyBmb3JFYWNoLCBoYXNPbmVPZiwgb2JqRXF1YWwgfSBmcm9tICdAL2xpYnMvdG9vbHMnOwppbXBvcnQgXyBmcm9tICd1bmRlcnNjb3JlJzsKaW1wb3J0IHsgY3JlYXRlSGFzaCB9IGZyb20gJ2NyeXB0byc7CmltcG9ydCBodG1sMmNhbnZhcyBmcm9tICJodG1sMmNhbnZhcyI7CmltcG9ydCBKU1BERiBmcm9tICJqc3BkZiI7CmltcG9ydCB7IEpTRW5jcnlwdCB9IGZyb20gJ2pzZW5jcnlwdCc7CmV4cG9ydCB2YXIgZ2V0UmFuZG9tID0gZnVuY3Rpb24gZ2V0UmFuZG9tKCkgewogIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA5OTk5OTkpLnRvU3RyaW5nKCk7Cn07CmV4cG9ydCB2YXIgaXNJblByZXJlbmRlck1vZGUgPSB3aW5kb3cuX19JU19JTl9QUkVSRU5ERVJfTU9ERSB8fCBmYWxzZTsKZXhwb3J0IHZhciBkZWxheUFmdGVyUmVuZGVyID0gaXNJblByZXJlbmRlck1vZGUgPyA1MDAgOiAwOwpleHBvcnQgdmFyIFRPS0VOX0tFWSA9ICd0b2tlbic7CmV4cG9ydCB2YXIgU0VTU0lPTl9LRVkgPSAnc2Vzc2lvbmlkJzsKZXhwb3J0IHZhciBJRF9UWVBFX0RDVCA9IHsKICAnMSc6ICfouqvku73or4EnLAogICcyJzogJ+aKpOeFpycsCiAgJzMnOiAn5YW25LuWJwp9OwpleHBvcnQgdmFyIHNldFRva2VuID0gZnVuY3Rpb24gc2V0VG9rZW4odG9rZW4pIHsKICBDb29raWVzLnNldChUT0tFTl9LRVksIHRva2VuLCB7CiAgICBleHBpcmVzOiBjb25maWcuY29va2llRXhwaXJlcyB8fCAxCiAgfSk7Cn07CmV4cG9ydCB2YXIgZ2V0VG9rZW4gPSBmdW5jdGlvbiBnZXRUb2tlbigpIHsKICB2YXIgdG9rZW4gPSBDb29raWVzLmdldChUT0tFTl9LRVkpOwogIGlmICh0b2tlbikgcmV0dXJuIHRva2VuO2Vsc2UgcmV0dXJuIGZhbHNlOwp9OwpleHBvcnQgdmFyIHNldFNlc3Npb24gPSBmdW5jdGlvbiBzZXRTZXNzaW9uKHNlc3Npb24pIHsKICBDb29raWVzLnNldChTRVNTSU9OX0tFWSwgc2Vzc2lvbiwgewogICAgZXhwaXJlczogY29uZmlnLmNvb2tpZUV4cGlyZXMgfHwgMQogIH0pOwp9OwpleHBvcnQgdmFyIGdldFNlc3Npb24gPSBmdW5jdGlvbiBnZXRTZXNzaW9uKCkgewogIHZhciBzZXNzaW9uID0gQ29va2llcy5nZXQoU0VTU0lPTl9LRVkpOwogIGlmIChzZXNzaW9uKSByZXR1cm4gc2Vzc2lvbjtlbHNlIHJldHVybiBmYWxzZTsKfTsKZXhwb3J0IHZhciByZW1vdmVDb29raWVzID0gZnVuY3Rpb24gcmVtb3ZlQ29va2llcygpIHsKICBDb29raWVzLnJlbW92ZSgnYXZhdGFyJyk7CiAgQ29va2llcy5yZW1vdmUoJ3Rva2VuJyk7CiAgQ29va2llcy5yZW1vdmUoJ25pY2tuYW1lJyk7CiAgQ29va2llcy5yZW1vdmUoJ2xhc3RfbG9naW5fdGltZScpOwp9OwpleHBvcnQgdmFyIGhhc0NoaWxkID0gZnVuY3Rpb24gaGFzQ2hpbGQoaXRlbSkgewogIHJldHVybiBpdGVtLmNoaWxkcmVuICYmIGl0ZW0uY2hpbGRyZW4ubGVuZ3RoICE9PSAwOwp9OwoKdmFyIHNob3dUaGlzTWVudUVsZSA9IGZ1bmN0aW9uIHNob3dUaGlzTWVudUVsZShpdGVtLCBhY2Nlc3MpIHsKICBpZiAoaXRlbS5tZXRhICYmIGl0ZW0ubWV0YS5hY2Nlc3MgJiYgaXRlbS5tZXRhLmFjY2Vzcy5sZW5ndGgpIHsKICAgIGlmIChoYXNPbmVPZihpdGVtLm1ldGEuYWNjZXNzLCBhY2Nlc3MpKSByZXR1cm4gdHJ1ZTtlbHNlIHJldHVybiBmYWxzZTsKICB9IGVsc2UgcmV0dXJuIHRydWU7Cn07Ci8qKgogKiBAcGFyYW0ge0FycmF5fSBsaXN0IOmAmui/h+i3r+eUseWIl+ihqOW+l+WIsOiPnOWNleWIl+ihqAogKiBAcmV0dXJucyB7QXJyYXl9CiAqLwoKCmV4cG9ydCB2YXIgZ2V0TWVudUJ5Um91dGVyID0gZnVuY3Rpb24gZ2V0TWVudUJ5Um91dGVyKGxpc3QsIGFjY2VzcykgewogIC8vIGNvbnNvbGUubG9nKCdsaXN0OiAnICsgSlNPTi5zdHJpbmdpZnkobGlzdCwgbnVsbCwgNCkpOwogIC8vIGNvbnNvbGUubG9nKCJnZXRNZW51QnlSb3V0ZXIgcGVybWlzc2lvbjogIiArIHBlcm1pc3Npb24pCiAgdmFyIHJlcyA9IFtdOwogIGZvckVhY2gobGlzdCwgZnVuY3Rpb24gKGl0ZW0pIHsKICAgIGlmICghaXRlbS5tZXRhIHx8IGl0ZW0ubWV0YSAmJiAhaXRlbS5tZXRhLmhpZGVJbk1lbnUpIHsKICAgICAgdmFyIG9iaiA9IHsKICAgICAgICBpY29uOiBpdGVtLm1ldGEgJiYgaXRlbS5tZXRhLmljb24gfHwgJycsCiAgICAgICAgbmFtZTogaXRlbS5uYW1lLAogICAgICAgIG1ldGE6IGl0ZW0ubWV0YQogICAgICB9OwoKICAgICAgaWYgKChoYXNDaGlsZChpdGVtKSB8fCBpdGVtLm1ldGEgJiYgaXRlbS5tZXRhLnNob3dBbHdheXMpICYmIHNob3dUaGlzTWVudUVsZShpdGVtLCBhY2Nlc3MpKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2coIml0ZW06ICIgKyBKU09OLnN0cmluZ2lmeShpdGVtKSkKICAgICAgICBvYmouY2hpbGRyZW4gPSBnZXRNZW51QnlSb3V0ZXIoaXRlbS5jaGlsZHJlbiwgYWNjZXNzKTsKICAgICAgfQoKICAgICAgaWYgKGl0ZW0ubWV0YSAmJiBpdGVtLm1ldGEuaHJlZikgb2JqLmhyZWYgPSBpdGVtLm1ldGEuaHJlZjsKICAgICAgaWYgKHNob3dUaGlzTWVudUVsZShpdGVtLCBhY2Nlc3MpKSByZXMucHVzaChvYmopOwogICAgfQogIH0pOwogIHJldHVybiByZXM7Cn07Ci8qKgogKiBAcGFyYW0ge0FycmF5fSByb3V0ZU1ldGNoZWQg5b2T5YmN6Lev55SxbWV0Y2hlZAogKiBAcmV0dXJucyB7QXJyYXl9CiAqLwoKZXhwb3J0IHZhciBnZXRCcmVhZENydW1iTGlzdCA9IGZ1bmN0aW9uIGdldEJyZWFkQ3J1bWJMaXN0KHJvdXRlLCBob21lUm91dGUpIHsKICB2YXIgaG9tZUl0ZW0gPSBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGhvbWVSb3V0ZSksIHt9LCB7CiAgICBpY29uOiBob21lUm91dGUubWV0YS5pY29uCiAgfSk7CgogIHZhciByb3V0ZU1ldGNoZWQgPSByb3V0ZS5tYXRjaGVkOwogIGlmIChyb3V0ZU1ldGNoZWQuc29tZShmdW5jdGlvbiAoaXRlbSkgewogICAgcmV0dXJuIGl0ZW0ubmFtZSA9PT0gaG9tZVJvdXRlLm5hbWU7CiAgfSkpIHJldHVybiBbaG9tZUl0ZW1dOwogIHZhciByZXMgPSByb3V0ZU1ldGNoZWQuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CiAgICByZXR1cm4gaXRlbS5tZXRhID09PSB1bmRlZmluZWQgfHwgIWl0ZW0ubWV0YS5oaWRlOwogIH0pLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgdmFyIG1ldGEgPSBfb2JqZWN0U3ByZWFkKHt9LCBpdGVtLm1ldGEpOwoKICAgIGlmIChtZXRhLnRpdGxlICYmIHR5cGVvZiBtZXRhLnRpdGxlID09PSAnZnVuY3Rpb24nKSBtZXRhLnRpdGxlID0gbWV0YS50aXRsZShyb3V0ZSk7CiAgICB2YXIgb2JqID0gewogICAgICBpY29uOiBpdGVtLm1ldGEgJiYgaXRlbS5tZXRhLmljb24gfHwgJycsCiAgICAgIG5hbWU6IGl0ZW0ubmFtZSwKICAgICAgbWV0YTogbWV0YQogICAgfTsKICAgIHJldHVybiBvYmo7CiAgfSk7CiAgcmVzID0gcmVzLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgcmV0dXJuICFpdGVtLm1ldGEuaGlkZUluTWVudTsKICB9KTsKICByZXR1cm4gW19vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgaG9tZUl0ZW0pLCB7fSwgewogICAgdG86IGhvbWVSb3V0ZS5wYXRoCiAgfSldLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkocmVzKSk7Cn07CmV4cG9ydCB2YXIgZ2V0Um91dGVUaXRsZUhhbmRsZWQgPSBmdW5jdGlvbiBnZXRSb3V0ZVRpdGxlSGFuZGxlZChyb3V0ZSkgewogIHZhciByb3V0ZXIgPSBfb2JqZWN0U3ByZWFkKHt9LCByb3V0ZSk7CgogIHZhciBtZXRhID0gX29iamVjdFNwcmVhZCh7fSwgcm91dGUubWV0YSk7CgogIGlmIChtZXRhLnRpdGxlICYmIHR5cGVvZiBtZXRhLnRpdGxlID09PSAnZnVuY3Rpb24nKSBtZXRhLnRpdGxlID0gbWV0YS50aXRsZShyb3V0ZXIpOwogIHJvdXRlci5tZXRhID0gbWV0YTsKICByZXR1cm4gcm91dGVyOwp9OwpleHBvcnQgdmFyIHNob3dUaXRsZSA9IGZ1bmN0aW9uIHNob3dUaXRsZShpdGVtLCB2bSkgewogIHJldHVybiB2bS4kY29uZmlnLnVzZUkxOG4gPyB2bS4kdChpdGVtLm5hbWUpIDogaXRlbS5tZXRhICYmIGl0ZW0ubWV0YS50aXRsZSB8fCBpdGVtLm5hbWU7Cn07Ci8qKgogKiBAZGVzY3JpcHRpb24g5pys5Zyw5a2Y5YKo5ZKM6I635Y+W5qCH562+5a+86Iiq5YiX6KGoCiAqLwoKZXhwb3J0IHZhciBzZXRUYWdOYXZMaXN0SW5Mb2NhbHN0b3JhZ2UgPSBmdW5jdGlvbiBzZXRUYWdOYXZMaXN0SW5Mb2NhbHN0b3JhZ2UobGlzdCkgewogIGxvY2FsU3RvcmFnZS50YWdOYXZlTGlzdCA9IEpTT04uc3RyaW5naWZ5KGxpc3QpOwp9OwovKioKICogQHJldHVybnMge0FycmF5fSDlhbbkuK3nmoTmr4/kuKrlhYPntKDlj6rljIXlkKvot6/nlLHljp/kv6Hmga/kuK3nmoRuYW1lLCBwYXRoLCBtZXRh5LiJ6aG5CiAqLwoKZXhwb3J0IHZhciBnZXRUYWdOYXZMaXN0RnJvbUxvY2Fsc3RvcmFnZSA9IGZ1bmN0aW9uIGdldFRhZ05hdkxpc3RGcm9tTG9jYWxzdG9yYWdlKCkgewogIHZhciBsaXN0ID0gbG9jYWxTdG9yYWdlLnRhZ05hdmVMaXN0OwogIHJldHVybiBsaXN0ID8gSlNPTi5wYXJzZShsaXN0KSA6IFtdOwp9OwovKioKICogQHBhcmFtIHtBcnJheX0gcm91dGVycyDot6/nlLHliJfooajmlbDnu4QKICogQGRlc2NyaXB0aW9uIOeUqOS6juaJvuWIsOi3r+eUseWIl+ihqOS4rW5hbWXkuLpob21l55qE5a+56LGhCiAqLwoKZXhwb3J0IHZhciBnZXRIb21lUm91dGUgPSBmdW5jdGlvbiBnZXRIb21lUm91dGUocm91dGVycykgewogIHZhciBob21lTmFtZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogJ2hvbWVQYWdlJzsKICB2YXIgaSA9IC0xOwogIHZhciBsZW4gPSByb3V0ZXJzLmxlbmd0aDsKICB2YXIgaG9tZVJvdXRlID0ge307CgogIHdoaWxlICgrK2kgPCBsZW4pIHsKICAgIHZhciBpdGVtID0gcm91dGVyc1tpXTsKCiAgICBpZiAoaXRlbS5jaGlsZHJlbiAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCkgewogICAgICB2YXIgcmVzID0gZ2V0SG9tZVJvdXRlKGl0ZW0uY2hpbGRyZW4pOwogICAgICBpZiAocmVzLm5hbWUpIHJldHVybiByZXM7CiAgICB9IGVsc2UgewogICAgICBpZiAoaXRlbS5uYW1lID09PSBob21lTmFtZSkgaG9tZVJvdXRlID0gaXRlbTsKICAgIH0KICB9CgogIHJldHVybiBob21lUm91dGU7Cn07Ci8qKgogKiBAcGFyYW0geyp9IGxpc3Qg546w5pyJ5qCH562+5a+86Iiq5YiX6KGoCiAqIEBwYXJhbSB7Kn0gbmV3Um91dGUg5paw5re75Yqg55qE6Lev55Sx5Y6f5L+h5oGv5a+56LGhCiAqIEBkZXNjcmlwdGlvbiDlpoLmnpzor6VuZXdSb3V0ZeW3sue7j+WtmOWcqOWImeS4jeWGjea3u+WKoAogKi8KCmV4cG9ydCB2YXIgZ2V0TmV3VGFnTGlzdCA9IGZ1bmN0aW9uIGdldE5ld1RhZ0xpc3QobGlzdCwgbmV3Um91dGUpIHsKICB2YXIgbmFtZSA9IG5ld1JvdXRlLm5hbWUsCiAgICAgIHBhdGggPSBuZXdSb3V0ZS5wYXRoLAogICAgICBtZXRhID0gbmV3Um91dGUubWV0YTsKCiAgdmFyIG5ld0xpc3QgPSBfdG9Db25zdW1hYmxlQXJyYXkobGlzdCk7CgogIGlmIChuZXdMaXN0LmZpbmRJbmRleChmdW5jdGlvbiAoaXRlbSkgewogICAgcmV0dXJuIGl0ZW0ubmFtZSA9PT0gbmFtZTsKICB9KSA+PSAwKSByZXR1cm4gbmV3TGlzdDtlbHNlIG5ld0xpc3QucHVzaCh7CiAgICBuYW1lOiBuYW1lLAogICAgcGF0aDogcGF0aCwKICAgIG1ldGE6IG1ldGEKICB9KTsKICByZXR1cm4gbmV3TGlzdDsKfTsKLyoqCiAqIEBwYXJhbSB7Kn0gYWNjZXNzIOeUqOaIt+adg+mZkOaVsOe7hO+8jOWmgiBbJ3N1cGVyX2FkbWluJywgJ2FkbWluJ10KICogQHBhcmFtIHsqfSByb3V0ZSDot6/nlLHliJfooagKICovCgp2YXIgaGFzQWNjZXNzID0gZnVuY3Rpb24gaGFzQWNjZXNzKGFjY2Vzcywgcm91dGUpIHsKICBpZiAocm91dGUubWV0YSAmJiByb3V0ZS5tZXRhLmFjY2VzcykgcmV0dXJuIGhhc09uZU9mKGFjY2Vzcywgcm91dGUubWV0YS5hY2Nlc3MpO2Vsc2UgcmV0dXJuIHRydWU7Cn07Ci8qKgogKiDmnYPpibQKICogQHBhcmFtIHsqfSBuYW1lIOWNs+Wwhui3s+i9rOeahOi3r+eUsW5hbWUKICogQHBhcmFtIHsqfSBhY2Nlc3Mg55So5oi35p2D6ZmQ5pWw57uECiAqIEBwYXJhbSB7Kn0gcm91dGVzIOi3r+eUseWIl+ihqAogKiBAZGVzY3JpcHRpb24g55So5oi35piv5ZCm5Y+v6Lez6L2s5Yiw6K+l6aG1CiAqLwoKCmV4cG9ydCB2YXIgY2FuVHVyblRvID0gZnVuY3Rpb24gY2FuVHVyblRvKG5hbWUsIGFjY2Vzcywgcm91dGVzKSB7CiAgdmFyIHJvdXRlUGVybWlzc2lvbkp1ZGdlID0gZnVuY3Rpb24gcm91dGVQZXJtaXNzaW9uSnVkZ2UobGlzdCkgewogICAgcmV0dXJuIGxpc3Quc29tZShmdW5jdGlvbiAoaXRlbSkgewogICAgICBpZiAoaXRlbS5jaGlsZHJlbiAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIHJldHVybiByb3V0ZVBlcm1pc3Npb25KdWRnZShpdGVtLmNoaWxkcmVuKTsKICAgICAgfSBlbHNlIGlmIChpdGVtLm5hbWUgPT09IG5hbWUpIHsKICAgICAgICByZXR1cm4gaGFzQWNjZXNzKGFjY2VzcywgaXRlbSk7CiAgICAgIH0KICAgIH0pOwogIH07CgogIHJldHVybiByb3V0ZVBlcm1pc3Npb25KdWRnZShyb3V0ZXMpOwp9OwovKioKICogQHBhcmFtIHtTdHJpbmd9IHVybAogKiBAZGVzY3JpcHRpb24g5LuOVVJM5Lit6Kej5p6Q5Y+C5pWwCiAqLwoKZXhwb3J0IHZhciBnZXRQYXJhbXMgPSBmdW5jdGlvbiBnZXRQYXJhbXModXJsKSB7CiAgdmFyIGtleVZhbHVlQXJyID0gdXJsLnNwbGl0KCc/JylbMV0uc3BsaXQoJyYnKTsKICB2YXIgcGFyYW1PYmogPSB7fTsKICBrZXlWYWx1ZUFyci5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICB2YXIga2V5VmFsdWUgPSBpdGVtLnNwbGl0KCc9Jyk7CiAgICBwYXJhbU9ialtrZXlWYWx1ZVswXV0gPSBrZXlWYWx1ZVsxXTsKICB9KTsKICByZXR1cm4gcGFyYW1PYmo7Cn07Ci8qKgogKiBAcGFyYW0ge0FycmF5fSBsaXN0IOagh+etvuWIl+ihqAogKiBAcGFyYW0ge1N0cmluZ30gbmFtZSDlvZPliY3lhbPpl63nmoTmoIfnrb7nmoRuYW1lCiAqLwoKZXhwb3J0IHZhciBnZXROZXh0Um91dGUgPSBmdW5jdGlvbiBnZXROZXh0Um91dGUobGlzdCwgcm91dGUpIHsKICB2YXIgcmVzID0ge307CgogIGlmIChsaXN0Lmxlbmd0aCA9PT0gMikgewogICAgcmVzID0gZ2V0SG9tZVJvdXRlKGxpc3QpOwogIH0gZWxzZSB7CiAgICB2YXIgaW5kZXggPSBsaXN0LmZpbmRJbmRleChmdW5jdGlvbiAoaXRlbSkgewogICAgICByZXR1cm4gcm91dGVFcXVhbChpdGVtLCByb3V0ZSk7CiAgICB9KTsKICAgIGlmIChpbmRleCA9PT0gbGlzdC5sZW5ndGggLSAxKSByZXMgPSBsaXN0W2xpc3QubGVuZ3RoIC0gMl07ZWxzZSByZXMgPSBsaXN0W2luZGV4ICsgMV07CiAgfQoKICByZXR1cm4gcmVzOwp9OwovKioKICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVzIOWbnuiwg+WHveaVsOmcgOimgeaJp+ihjOeahOasoeaVsAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayDlm57osIPlh73mlbAKICovCgpleHBvcnQgdmFyIGRvQ3VzdG9tVGltZXMgPSBmdW5jdGlvbiBkb0N1c3RvbVRpbWVzKHRpbWVzLCBjYWxsYmFjaykgewogIHZhciBpID0gLTE7CgogIHdoaWxlICgrK2kgPCB0aW1lcykgewogICAgY2FsbGJhY2soaSk7CiAgfQp9OwovKioKICogQHBhcmFtIHtPYmplY3R9IGZpbGUg5LuO5LiK5Lyg57uE5Lu25b6X5Yiw55qE5paH5Lu25a+56LGhCiAqIEByZXR1cm5zIHtQcm9taXNlfSByZXNvbHZl5Y+C5pWw5piv6Kej5p6Q5ZCO55qE5LqM57u05pWw57uECiAqIEBkZXNjcmlwdGlvbiDku45Dc3bmlofku7bkuK3op6PmnpDlh7rooajmoLzvvIzop6PmnpDmiJDkuoznu7TmlbDnu4QKICovCgpleHBvcnQgdmFyIGdldEFycmF5RnJvbUZpbGUgPSBmdW5jdGlvbiBnZXRBcnJheUZyb21GaWxlKGZpbGUpIHsKICB2YXIgbmFtZVNwbGl0ID0gZmlsZS5uYW1lLnNwbGl0KCcuJyk7CiAgdmFyIGZvcm1hdCA9IG5hbWVTcGxpdFtuYW1lU3BsaXQubGVuZ3RoIC0gMV07CiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7IC8vIOS7peaWh+acrOagvOW8j+ivu+WPlgoKICAgIHZhciBhcnIgPSBbXTsKCiAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGV2dCkgewogICAgICB2YXIgZGF0YSA9IGV2dC50YXJnZXQucmVzdWx0OyAvLyDor7vliLDnmoTmlbDmja4KCiAgICAgIHZhciBwYXN0ZURhdGEgPSBkYXRhLnRyaW0oKTsKICAgICAgYXJyID0gcGFzdGVEYXRhLnNwbGl0KC9bXG5cdTAwODVcdTIwMjhcdTIwMjldfFxyXG4/L2cpLm1hcChmdW5jdGlvbiAocm93KSB7CiAgICAgICAgcmV0dXJuIHJvdy5zcGxpdCgnXHQnKTsKICAgICAgfSkubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW1bMF0uc3BsaXQoJywnKTsKICAgICAgfSk7CiAgICAgIGlmIChmb3JtYXQgPT09ICdjc3YnKSByZXNvbHZlKGFycik7ZWxzZSByZWplY3QobmV3IEVycm9yKCdbRm9ybWF0IEVycm9yXTrkvaDkuIrkvKDnmoTkuI3mmK9Dc3bmlofku7YnKSk7CiAgICB9OwogIH0pOwp9OwovKioKICogQHBhcmFtIHtBcnJheX0gYXJyYXkg6KGo5qC85pWw5o2u5LqM57u05pWw57uECiAqIEByZXR1cm5zIHtPYmplY3R9IHsgY29sdW1ucywgdGFibGVEYXRhIH0KICogQGRlc2NyaXB0aW9uIOS7juS6jOe7tOaVsOe7hOS4reiOt+WPluihqOWktOWSjOihqOagvOaVsOaNru+8jOWwhuesrOS4gOihjOS9nOS4uuihqOWktO+8jOeUqOS6juWcqGlWaWV355qE6KGo5qC85Lit5bGV56S65pWw5o2uCiAqLwoKZXhwb3J0IHZhciBnZXRUYWJsZURhdGFGcm9tQXJyYXkgPSBmdW5jdGlvbiBnZXRUYWJsZURhdGFGcm9tQXJyYXkoYXJyYXkpIHsKICB2YXIgY29sdW1ucyA9IFtdOwogIHZhciB0YWJsZURhdGEgPSBbXTsKCiAgaWYgKGFycmF5Lmxlbmd0aCA+IDEpIHsKICAgIHZhciB0aXRsZXMgPSBhcnJheS5zaGlmdCgpOwogICAgY29sdW1ucyA9IHRpdGxlcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0aXRsZTogaXRlbSwKICAgICAgICBrZXk6IGl0ZW0KICAgICAgfTsKICAgIH0pOwogICAgdGFibGVEYXRhID0gYXJyYXkubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgIHZhciByZXMgPSB7fTsKICAgICAgaXRlbS5mb3JFYWNoKGZ1bmN0aW9uIChjb2wsIGkpIHsKICAgICAgICByZXNbdGl0bGVzW2ldXSA9IGNvbDsKICAgICAgfSk7CiAgICAgIHJldHVybiByZXM7CiAgICB9KTsKICB9CgogIHJldHVybiB7CiAgICBjb2x1bW5zOiBjb2x1bW5zLAogICAgdGFibGVEYXRhOiB0YWJsZURhdGEKICB9Owp9OwpleHBvcnQgdmFyIGZpbmROb2RlVXBwZXIgPSBmdW5jdGlvbiBmaW5kTm9kZVVwcGVyKGVsZSwgdGFnKSB7CiAgaWYgKGVsZS5wYXJlbnROb2RlKSB7CiAgICBpZiAoZWxlLnBhcmVudE5vZGUudGFnTmFtZSA9PT0gdGFnLnRvVXBwZXJDYXNlKCkpIHsKICAgICAgcmV0dXJuIGVsZS5wYXJlbnROb2RlOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGZpbmROb2RlVXBwZXIoZWxlLnBhcmVudE5vZGUsIHRhZyk7CiAgICB9CiAgfQp9OwpleHBvcnQgdmFyIGZpbmROb2RlVXBwZXJCeUNsYXNzZXMgPSBmdW5jdGlvbiBmaW5kTm9kZVVwcGVyQnlDbGFzc2VzKGVsZSwgY2xhc3NlcykgewogIHZhciBwYXJlbnROb2RlID0gZWxlLnBhcmVudE5vZGU7CgogIGlmIChwYXJlbnROb2RlKSB7CiAgICB2YXIgY2xhc3NMaXN0ID0gcGFyZW50Tm9kZS5jbGFzc0xpc3Q7CgogICAgaWYgKGNsYXNzTGlzdCAmJiBjbGFzc2VzLmV2ZXJ5KGZ1bmN0aW9uIChjbGFzc05hbWUpIHsKICAgICAgcmV0dXJuIGNsYXNzTGlzdC5jb250YWlucyhjbGFzc05hbWUpOwogICAgfSkpIHsKICAgICAgcmV0dXJuIHBhcmVudE5vZGU7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZmluZE5vZGVVcHBlckJ5Q2xhc3NlcyhwYXJlbnROb2RlLCBjbGFzc2VzKTsKICAgIH0KICB9Cn07CmV4cG9ydCB2YXIgZmluZE5vZGVEb3dud2FyZCA9IGZ1bmN0aW9uIGZpbmROb2RlRG93bndhcmQoZWxlLCB0YWcpIHsKICB2YXIgdGFnTmFtZSA9IHRhZy50b1VwcGVyQ2FzZSgpOwoKICBpZiAoZWxlLmNoaWxkTm9kZXMubGVuZ3RoKSB7CiAgICB2YXIgaSA9IC0xOwogICAgdmFyIGxlbiA9IGVsZS5jaGlsZE5vZGVzLmxlbmd0aDsKCiAgICB3aGlsZSAoKytpIDwgbGVuKSB7CiAgICAgIHZhciBjaGlsZCA9IGVsZS5jaGlsZE5vZGVzW2ldOwogICAgICBpZiAoY2hpbGQudGFnTmFtZSA9PT0gdGFnTmFtZSkgcmV0dXJuIGNoaWxkO2Vsc2UgcmV0dXJuIGZpbmROb2RlRG93bndhcmQoY2hpbGQsIHRhZyk7CiAgICB9CiAgfQp9OwpleHBvcnQgdmFyIHNob3dCeUFjY2VzcyA9IGZ1bmN0aW9uIHNob3dCeUFjY2VzcyhhY2Nlc3MsIGNhblZpZXdBY2Nlc3MpIHsKICByZXR1cm4gaGFzT25lT2YoY2FuVmlld0FjY2VzcywgYWNjZXNzKTsKfTsKLyoqCiAqIEBkZXNjcmlwdGlvbiDmoLnmja5uYW1lL3BhcmFtcy9xdWVyeeWIpOaWreS4pOS4qui3r+eUseWvueixoeaYr+WQpuebuOetiQogKiBAcGFyYW0geyp9IHJvdXRlMSDot6/nlLHlr7nosaEKICogQHBhcmFtIHsqfSByb3V0ZTIg6Lev55Sx5a+56LGhCiAqLwoKZXhwb3J0IHZhciByb3V0ZUVxdWFsID0gZnVuY3Rpb24gcm91dGVFcXVhbChyb3V0ZTEsIHJvdXRlMikgewogIHZhciBwYXJhbXMxID0gcm91dGUxLnBhcmFtcyB8fCB7fTsKICB2YXIgcGFyYW1zMiA9IHJvdXRlMi5wYXJhbXMgfHwge307CiAgdmFyIHF1ZXJ5MSA9IHJvdXRlMS5xdWVyeSB8fCB7fTsKICB2YXIgcXVlcnkyID0gcm91dGUyLnF1ZXJ5IHx8IHt9OwogIHJldHVybiByb3V0ZTEubmFtZSA9PT0gcm91dGUyLm5hbWUgJiYgb2JqRXF1YWwocGFyYW1zMSwgcGFyYW1zMikgJiYgb2JqRXF1YWwocXVlcnkxLCBxdWVyeTIpOwp9OwovKioKICog5Yik5pat5omT5byA55qE5qCH562+5YiX6KGo6YeM5piv5ZCm5bey5a2Y5Zyo6L+Z5Liq5paw5re75Yqg55qE6Lev55Sx5a+56LGhCiAqLwoKZXhwb3J0IHZhciByb3V0ZUhhc0V4aXN0ID0gZnVuY3Rpb24gcm91dGVIYXNFeGlzdCh0YWdOYXZMaXN0LCByb3V0ZUl0ZW0pIHsKICB2YXIgbGVuID0gdGFnTmF2TGlzdC5sZW5ndGg7CiAgdmFyIHJlcyA9IGZhbHNlOwogIGRvQ3VzdG9tVGltZXMobGVuLCBmdW5jdGlvbiAoaW5kZXgpIHsKICAgIGlmIChyb3V0ZUVxdWFsKHRhZ05hdkxpc3RbaW5kZXhdLCByb3V0ZUl0ZW0pKSByZXMgPSB0cnVlOwogIH0pOwogIHJldHVybiByZXM7Cn07CmV4cG9ydCB2YXIgbG9jYWxTYXZlID0gZnVuY3Rpb24gbG9jYWxTYXZlKGtleSwgdmFsdWUpIHsKICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlKTsKfTsKZXhwb3J0IHZhciBsb2NhbFJlYWQgPSBmdW5jdGlvbiBsb2NhbFJlYWQoa2V5KSB7CiAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkgfHwgJyc7Cn07CmV4cG9ydCB2YXIgZm9ybWF0TW9uZXkgPSBmdW5jdGlvbiBmb3JtYXRNb25leShzLCB0eXBlKSB7CiAgaWYgKC9bXjAtOS5dLy50ZXN0KHMpKSByZXR1cm4gJzAuMDAnOwogIGlmIChzID09IG51bGwgfHwgcyA9PSAnbnVsbCcgfHwgcyA9PSAnJykgcmV0dXJuICcwLjAwJzsKICBzID0gcy50b1N0cmluZygpLnJlcGxhY2UoL14oXGQqKSQvLCAnJDEuJyk7CiAgcyA9IChzICsgJzAwJykucmVwbGFjZSgvKFxkKlwuXGRcZClcZCovLCAnJDEnKTsKICBzID0gcy5yZXBsYWNlKCcuJywgJywnKTsKICB2YXIgcmUgPSAvKFxkKShcZHszfSwpLzsKCiAgd2hpbGUgKHJlLnRlc3QocykpIHsKICAgIHMgPSBzLnJlcGxhY2UocmUsICckMSwkMicpOwogIH0KCiAgcyA9IHMucmVwbGFjZSgvLChcZFxkKSQvLCAnLiQxJyk7CgogIGlmICh0eXBlID09IDApIHsKICAgIHZhciBhID0gcy5zcGxpdCgnLicpOwoKICAgIGlmIChhWzFdID09ICcwMCcpIHsKICAgICAgcyA9IGFbMF07CiAgICB9CiAgfQoKICByZXR1cm4gczsKfTsgLy8g5ZCI5bm25pWw57uE77yM5LiU5Y676YeNCgpleHBvcnQgdmFyIGNvbmNhdEFycmF5ID0gZnVuY3Rpb24gY29uY2F0QXJyYXkoYXJyYXkpIHsKICB2YXIgdW5pcSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogdHJ1ZTsKCiAgaWYgKCFfLmlzQXJyYXkoYXJyYXkpKSB7CiAgICByZXR1cm4gYXJyYXk7CiAgfQoKICB2YXIgYXJyID0gQXJyYXkucHJvdG90eXBlLmNvbmNhdC5hcHBseShbXSwgYXJyYXkpOwogIHJldHVybiB1bmlxID8gXy51bmlxKGFycikgOiBhcnI7Cn07CmV4cG9ydCB2YXIgc2V0VXNlck5hbWUgPSBmdW5jdGlvbiBzZXRVc2VyTmFtZSh1c2VybmFtZSkgewogIENvb2tpZXMuc2V0KCd1c2VybmFtZScsIHVzZXJuYW1lLCB7CiAgICBleHBpcmVzOiBjb25maWcuY29va2llRXhwaXJlcyB8fCAxIHx8IDEKICB9KTsKfTsKZXhwb3J0IHZhciBnZXRVc2VyTmFtZSA9IGZ1bmN0aW9uIGdldFVzZXJOYW1lKCkgewogIHZhciB1c2VyTmFtZSA9IENvb2tpZXMuZ2V0KCd1c2VybmFtZScpOwogIGlmICh1c2VyTmFtZSkgcmV0dXJuIHVzZXJOYW1lO2Vsc2UgcmV0dXJuIGZhbHNlOwp9OwpleHBvcnQgdmFyIHNldENvb2tpZXNJdGVtID0gZnVuY3Rpb24gc2V0Q29va2llc0l0ZW0oa2V5LCB2YWx1ZSkgewogIENvb2tpZXMuc2V0KGtleSwgdmFsdWUsIHsKICAgIGV4cGlyZXM6IGNvbmZpZy5jb29raWVFeHBpcmVzIHx8IDEgfHwgMQogIH0pOwp9OwpleHBvcnQgdmFyIGdldENvb2tpZXNJdGVtID0gZnVuY3Rpb24gZ2V0Q29va2llc0l0ZW0oa2V5KSB7CiAgdmFyIHZhbHVlID0gQ29va2llcy5nZXQoa2V5KTsKICBpZiAodmFsdWUpIHJldHVybiB2YWx1ZTtlbHNlIHJldHVybiBmYWxzZTsKfTsKZXhwb3J0IHZhciBnZXRVc2VySW5mbyA9IGZ1bmN0aW9uIGdldFVzZXJJbmZvKCkgewogIHZhciB1c2VySW5mbyA9IGxvY2FsUmVhZCgndXNlckluZm8nKTsKCiAgaWYgKHVzZXJJbmZvKSB7CiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodXNlckluZm8pOwogIH0gZWxzZSB7CiAgICByZXR1cm4ge307CiAgfQp9OyAvLyByc2EgZW5jcnlwdAoKdmFyIFBVQl9LRVkgPSAiXG4tLS0tLUJFR0lOIFBVQkxJQyBLRVktLS0tLVxuTUlHZk1BMEdDU3FHU0liM0RRRUJBUVVBQTRHTkFEQ0JpUUtCZ1FDbU55S2pzTDNVTmtsQ2ZoSWo3SW45a054alxuVHF3aTc2ZjZwU3VYZlNOaUp1b1Z0S1pOeURDQ1c1RWR6bzBISGdsTGxwc2tWTjhzM0pWNGxtWFRVMTRCVVlXL1xuL0I5ODJod1VBZ1BFbHlvM0JYcGQ2NlZOOFU5QTlGdWRkYUs3Z3ZLOCtGT3NPSFQwYSt2R2I3L1VrM0hwSjFBSlxub08zWnQwRHF5YzBkTC83aEx3SURBUUFCXG4tLS0tLUVORCBQVUJMSUMgS0VZLS0tLS1cbiI7CmV4cG9ydCB2YXIgZW5jcnlwdEJ5UHViS2V5ID0gZnVuY3Rpb24gZW5jcnlwdEJ5UHViS2V5KHJhd0RhdGEpIHsKICB2YXIgY3J5cHRvOwoKICB0cnkgewogICAgY3J5cHRvID0gcmVxdWlyZSgnY3J5cHRvJyk7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjb25zb2xlLmxvZygnY3J5cHRvIHN1cHBvcnQgaXMgZGlzYWJsZWQhJyk7CiAgfQoKICB2YXIgYnVmZmVyID0gQnVmZmVyLmZyb20ocmF3RGF0YSk7CiAgdmFyIGVuY3J5cHRlZCA9IGNyeXB0by5wdWJsaWNFbmNyeXB0KFBVQl9LRVksIGJ1ZmZlcik7CiAgcmV0dXJuIGVuY3J5cHRlZC50b1N0cmluZygiYmFzZTY0Iik7Cn07IC8vIHJzYSBlbmNyeXB0Cgp2YXIgUlNBX1BVQl9LRVkgPSAiXG4tLS0tLUJFR0lOIFBVQkxJQyBLRVktLS0tLVxuTUlHZk1BMEdDU3FHU0liM0RRRUJBUVVBQTRHTkFEQ0JpUUtCZ1FERVNQYUlCdCtuUzBFUW1IY21JOGxsTUZlY1xuY082WE1QM0QxVDI4dlBqSDZLSjlDQ3VyTUgyQWc1bFNXRjBmZTNuUURHVFZUejdvTUVpa3FxTm1QNU5qa3hheVxuZFA0UUFzZmVCS0hpYm5zQ1kvNE1iaHZwSnFFR0F1aFppL0FEMnpqMnNBditBYTQ2RkxlaGp4UVhaZWpMMnRVbFxuZWgwRFc2WUJYVTJvdjhNaUhRSURBUUFCXG4tLS0tLUVORCBQVUJMSUMgS0VZLS0tLS1cbiI7CmV4cG9ydCB2YXIgcnNhRW5jcnlwdEJ5UHViS2V5ID0gZnVuY3Rpb24gcnNhRW5jcnlwdEJ5UHViS2V5KHJhd0RhdGEpIHsKICB2YXIgZW5jcnlwdCA9IG5ldyBKU0VuY3J5cHQoKTsKICBlbmNyeXB0LnNldFB1YmxpY0tleShSU0FfUFVCX0tFWSk7CiAgcmV0dXJuIGVuY3J5cHQuZW5jcnlwdChyYXdEYXRhKTsKfTsKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSBhbGdvcml0aG0KICogQHBhcmFtIHthbnl9IGNvbnRlbnQKICogIEByZXR1cm4ge3N0cmluZ30KICovCgpleHBvcnQgdmFyIGVuY3J5cHQgPSBmdW5jdGlvbiBlbmNyeXB0KGFsZ29yaXRobSwgY29udGVudCkgewogIHZhciBoYXNoID0gY3JlYXRlSGFzaChhbGdvcml0aG0pOwogIGhhc2gudXBkYXRlKGNvbnRlbnQpOwogIHJldHVybiBoYXNoLmRpZ2VzdCgnaGV4Jyk7Cn07Ci8qKgogKiBAcGFyYW0ge2FueX0gY29udGVudAogKiAgQHJldHVybiB7c3RyaW5nfQogKi8KCmV4cG9ydCB2YXIgc2hhMSA9IGZ1bmN0aW9uIHNoYTEoY29udGVudCkgewogIHJldHVybiBlbmNyeXB0KCdzaGExJywgY29udGVudCk7Cn07IC8vIOW4geenjeespuWPtwoKZXhwb3J0IHZhciBjdXJyZW5jeSA9IHsKICAnQ05ZJzogJ++/pScsCiAgJ0hLRCc6ICdIS++8hCcsCiAgJ1VTRCc6ICfvvIQnLAogICdFVVInOiAn4oKsJywKICAnR0JQJzogJ++/oScsCiAgJ0pQWSc6ICdK77+lJywKICAnS1JXJzogJ+KCqScKfTsKLyoqCiAqIEBwYXJhbSB7YW55fSBjb250ZW50CiAqICBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKZXhwb3J0IHZhciBtZDUgPSBmdW5jdGlvbiBtZDUoY29udGVudCkgewogIHJldHVybiBlbmNyeXB0KCdtZDUnLCBjb250ZW50KTsKfTsgLy8g5qCh6aqM5piv5ZCm5Li65ZCI5rOV5omL5py65Y+356CBCgpleHBvcnQgdmFyIGlzUGhvbmUgPSBmdW5jdGlvbiBpc1Bob25lKHN0cikgewogIHZhciByZWcgPSAvXlsxXVszLTldXGR7OX0kfF4oWzZ8OV0pXGR7N30kfF5bMF1bOV1cZHs4fSR8Xls2XShbOHw2XSlcZHs1fSQvOwoKICBpZiAoIXJlZy50ZXN0KHN0cikpIHsKICAgIHJldHVybiBmYWxzZTsKICB9IGVsc2UgewogICAgcmV0dXJuIHRydWU7CiAgfQp9OyAvLyDmoLnmja7pg6jpl6jmoJHlvaLnu5PmnoQs6L+U5Zue5Y+25a2Q6IqC54K56YOo6Zeo5pWw57uECgpleHBvcnQgdmFyIGJ1aWxkQ2hpbGREZXBhcnRtZW50QXJyYXkgPSBmdW5jdGlvbiBidWlsZENoaWxkRGVwYXJ0bWVudEFycmF5KHNlbGVjdERlcGFydERhdGEsIG1lcmNoYW50RGVwYXJ0RGF0YSkgewogIC8v5Yik5pat5Lik5Liq5Y+C5pWw5piv5ZCm5Li65pWw57uECiAgdmFyIHRtcCA9IFtdOwogIHNlbGVjdERlcGFydERhdGEubWFwKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkgewogICAgaWYgKGl0ZW0pIHsKICAgICAgdG1wLnB1c2goaXRlbSk7IC8v5p+l5om+54i2aWTmmK/lvZPliY1pZOeahOaVsOe7hAoKICAgICAgdmFyIGN1ckRlcGFydCA9IF8uZmlsdGVyKG1lcmNoYW50RGVwYXJ0RGF0YSwgZnVuY3Rpb24gKGN1cikgewogICAgICAgIHJldHVybiBjdXIucGFyZW50aWQgPT0gaXRlbTsKICAgICAgfSk7CgogICAgICBpZiAoY3VyRGVwYXJ0Lmxlbmd0aCAhPT0gMCkgewogICAgICAgIHZhciBkZXBhcnRtZW50cyA9IF8ucGx1Y2soY3VyRGVwYXJ0LCAnZGVwYXJ0bWVudF9pZCcpOwoKICAgICAgICB2YXIgcmVzID0gYnVpbGRDaGlsZERlcGFydG1lbnRBcnJheShkZXBhcnRtZW50cywgbWVyY2hhbnREZXBhcnREYXRhKTsKICAgICAgICB0bXAgPSBfLnVuaW9uKHRtcCwgcmVzKTsKICAgICAgfQogICAgfQogIH0pOyAvLyBjb25zb2xlLmxvZygiYnVpbGRDaGlsZERlcGFydG1lbnRBcnJheT09PT09ZmluaXNoZWQtLS10bXA+Pj4iICsgSlNPTi5zdHJpbmdpZnkodG1wKSk7CgogIHJldHVybiB0bXA7Cn07IC8vIOagueaNruWPtuWtkOiKgueCuemDqOmXqOaVsOe7hOWSjOmDqOmXqOe7hOe7h+aVsOe7hO+8jOi/lOWbnumDqOmXqOagkeW9oue7k+aehAoKZXhwb3J0IHZhciBidWlsZERlcGFydG1lbnRUcmVlID0gZnVuY3Rpb24gYnVpbGREZXBhcnRtZW50VHJlZShjaGlsZERhdGEsIGRlcGFydG1lbnREYXRhKSB7CiAgLy/liKTmlq3kuKTkuKrlj4LmlbDmmK/lkKbkuLrmlbDnu4QKICB2YXIgdG1wID0gW107CiAgY2hpbGREYXRhLm1hcChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgIGlmIChpdGVtKSB7CiAgICAgIHZhciBjdXJEZXBhcnQgPSBfLmZpbmQoZGVwYXJ0bWVudERhdGEsIGZ1bmN0aW9uIChjdXIpIHsKICAgICAgICByZXR1cm4gY3VyLmRlcGFydG1lbnRfaWQgPT0gaXRlbTsKICAgICAgfSk7CgogICAgICBpZiAoY3VyRGVwYXJ0KSB7CiAgICAgICAgdmFyIG5ld0RlcGFydCA9IHsKICAgICAgICAgIGRlcGFydG1lbnRfaWQ6IGN1ckRlcGFydC5kZXBhcnRtZW50X2lkLAogICAgICAgICAgcGFyZW50aWQ6IGN1ckRlcGFydC5wYXJlbnRpZCwKICAgICAgICAgIG5hbWU6IGN1ckRlcGFydC5uYW1lCiAgICAgICAgfTsKICAgICAgICB0bXAucHVzaChuZXdEZXBhcnQpOwoKICAgICAgICBpZiAoY3VyRGVwYXJ0LnBhcmVudGlkID09ICIiKSB7fSBlbHNlIHsKICAgICAgICAgIHZhciBpbkRlcGFydCA9IFtdOwogICAgICAgICAgaW5EZXBhcnQucHVzaChjdXJEZXBhcnQucGFyZW50aWQpOwogICAgICAgICAgdmFyIHJlcyA9IGJ1aWxkRGVwYXJ0bWVudFRyZWUoaW5EZXBhcnQsIGRlcGFydG1lbnREYXRhKTsKCiAgICAgICAgICB2YXIgdW5pb250bXAgPSBfLnVuaW9uKHRtcCwgcmVzKTsKCiAgICAgICAgICB0bXAgPSBfLnVuaXEodW5pb250bXAsIHRydWUsICdkZXBhcnRtZW50X2lkJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSk7CiAgcmV0dXJuIHRtcDsKfTsgLy8g6YCS5b2S6L+U5Zue5qCR5b2i57uT5p6E77yM6buY6K6k5Li7SUTlrZfmrrXlkI3kuLogY29kZe+8jOeItmlk5a2X5q615ZCN5Li6IHBhcmVudHPvvIwg5qC55o2u5pWw5o2u5Y+v6Ieq5a6a5LmJCgpleHBvcnQgdmFyIGJ1aWxkVHJlZSA9IGZ1bmN0aW9uIGJ1aWxkVHJlZShxdWVyeUFycikgewogIHZhciBzdWIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogIHZhciBjdXJyZW50S2V5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAnY29kZSc7CiAgdmFyIHBhcmVudHNLZXkgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6ICdwYXJlbnRzJzsKICB2YXIgY2hpbGQgPSBhcmd1bWVudHMubGVuZ3RoID4gNCAmJiBhcmd1bWVudHNbNF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s0XSA6ICdjaGlsZHJlbic7CiAgdmFyIHJvb3QgPSBhcmd1bWVudHMubGVuZ3RoID4gNSAmJiBhcmd1bWVudHNbNV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s1XSA6ICcwJzsKICAvLyBjb25zb2xlLmxvZygiYnVpbGRUcmVlLS0tPj4+IiArIHJvb3QgKyAiLS0tPj4+IiArIEpTT04uc3RyaW5naWZ5KHF1ZXJ5QXJyKSk7CiAgdmFyIHRtcCA9IFtdOwogIHZhciByb290VHJlZSA9IHsKICAgIGRlcGFydG1lbnRfaWQ6ICcwJywKICAgIHBhcmVudGlkOiAiIiwKICAgIG5hbWU6ICLlhajpg6jpg6jpl6giCiAgfTsKICB2YXIgcXVlcnkgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHF1ZXJ5QXJyKSk7CgogIGlmIChyb290ID09ICcwJykgewogICAgcXVlcnkubWFwKGZ1bmN0aW9uIChpdGVtLCBpKSB7CiAgICAgIGlmICghc3ViW2N1cnJlbnRLZXldKSB7CiAgICAgICAgaWYgKGl0ZW1bcGFyZW50c0tleV0gPT09ICcnKSB7CiAgICAgICAgICBpdGVtW3BhcmVudHNLZXldID0gJzAnOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICBxdWVyeS5wdXNoKHJvb3RUcmVlKTsKICB9CgogIHF1ZXJ5Lm1hcChmdW5jdGlvbiAoaXRlbSwgaSkgewogICAgaWYgKGl0ZW0pIHsKICAgICAgXy5leHRlbmQoaXRlbSwgewogICAgICAgIGlkOiBpdGVtW2N1cnJlbnRLZXldCiAgICAgIH0pOwoKICAgICAgXy5leHRlbmQoaXRlbSwgewogICAgICAgIHRpdGxlOiBpdGVtWyduYW1lJ10KICAgICAgfSk7CiAgICB9CgogICAgaWYgKCFzdWJbY3VycmVudEtleV0pIHsKICAgICAgaWYgKGl0ZW1bcGFyZW50c0tleV0gPT09ICcnKSB7CiAgICAgICAgcXVlcnlbaV0gPSBmYWxzZTsKICAgICAgICBpdGVtWydjaGVja2VkJ10gPSB0cnVlOwogICAgICAgIHRtcC5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZiAoc3ViW2N1cnJlbnRLZXldID09PSBpdGVtW3BhcmVudHNLZXldKSB7CiAgICAgICAgcXVlcnlbaV0gPSBmYWxzZTsKICAgICAgICBpdGVtWydjaGVja2VkJ10gPSB0cnVlOwogICAgICAgIHRtcC5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9CiAgfSk7CgogIGlmICh0bXAubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm47CiAgfQoKICBzdWIgPSB0bXA7CgogIGlmIChzdWIubGVuZ3RoID4gMCkgewogICAgLy8gY29uc29sZS5sb2coInN1YiA9PT0+ICIsIHN1YikKICAgIHN1Yi5tYXAoZnVuY3Rpb24gKGN1ciwgYykgewogICAgICB2YXIgcmVzID0gYnVpbGRUcmVlKHF1ZXJ5LCBjdXIsIGN1cnJlbnRLZXksIHBhcmVudHNLZXksIGNoaWxkLCAnMScpOwoKICAgICAgaWYgKHJlcykgewogICAgICAgIHN1YltjXVtjaGlsZF0gPSByZXM7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcmV0dXJuIHN1YjsKfTsgLy8g6YCS5b2S6L+U5Zue5qCR5b2i57uT5p6E77yM6buY6K6k5Li7SUTlrZfmrrXlkI3kuLogY29kZe+8jOeItmlk5a2X5q615ZCN5Li6IHBhcmVudHPvvIwg5qC55o2u5pWw5o2u5Y+v6Ieq5a6a5LmJCgpleHBvcnQgdmFyIGJ1aWxkVHJlZUNoZWNrZWQgPSBmdW5jdGlvbiBidWlsZFRyZWVDaGVja2VkKHF1ZXJ5QXJyKSB7CiAgdmFyIHN1YiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgdmFyIGN1cnJlbnRLZXkgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6ICdjb2RlJzsKICB2YXIgcGFyZW50c0tleSA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogJ3BhcmVudHMnOwogIHZhciBjaGlsZCA9IGFyZ3VtZW50cy5sZW5ndGggPiA0ICYmIGFyZ3VtZW50c1s0XSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzRdIDogJ2NoaWxkcmVuJzsKICB2YXIgcm9vdCA9IGFyZ3VtZW50cy5sZW5ndGggPiA1ICYmIGFyZ3VtZW50c1s1XSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzVdIDogJzAnOwogIHZhciBDaGVja2VkQXJyID0gYXJndW1lbnRzLmxlbmd0aCA+IDYgPyBhcmd1bWVudHNbNl0gOiB1bmRlZmluZWQ7CiAgLy8gY29uc29sZS5sb2coImJ1aWxkVHJlZS0tLT4+PiIgKyByb290ICsgIi0tLT4+PiIgKyBKU09OLnN0cmluZ2lmeShxdWVyeUFycikpOwogIHZhciB0bXAgPSBbXTsKICB2YXIgcm9vdFRyZWUgPSB7CiAgICBkZXBhcnRtZW50X2lkOiAnMCcsCiAgICBwYXJlbnRpZDogIiIsCiAgICBuYW1lOiAi5YWo6YOo6YOo6ZeoIgogIH07CiAgdmFyIHF1ZXJ5ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShxdWVyeUFycikpOwoKICBpZiAocm9vdCA9PSAnMCcpIHsKICAgIHF1ZXJ5Lm1hcChmdW5jdGlvbiAoaXRlbSwgaSkgewogICAgICBpZiAoIXN1YltjdXJyZW50S2V5XSkgewogICAgICAgIGlmIChpdGVtW3BhcmVudHNLZXldID09PSAnJykgewogICAgICAgICAgaXRlbVtwYXJlbnRzS2V5XSA9ICcwJzsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcXVlcnkucHVzaChyb290VHJlZSk7CiAgfQoKICBxdWVyeS5tYXAoZnVuY3Rpb24gKGl0ZW0sIGkpIHsKICAgIGlmIChpdGVtKSB7CiAgICAgIF8uZXh0ZW5kKGl0ZW0sIHsKICAgICAgICBpZDogaXRlbVtjdXJyZW50S2V5XQogICAgICB9KTsKCiAgICAgIF8uZXh0ZW5kKGl0ZW0sIHsKICAgICAgICB0aXRsZTogaXRlbVsnbmFtZSddCiAgICAgIH0pOwogICAgfQoKICAgIGlmICghc3ViW2N1cnJlbnRLZXldKSB7CiAgICAgIGlmIChpdGVtW3BhcmVudHNLZXldID09PSAnJykgewogICAgICAgIHF1ZXJ5W2ldID0gZmFsc2U7CiAgICAgICAgdG1wLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmIChzdWJbY3VycmVudEtleV0gPT09IGl0ZW1bcGFyZW50c0tleV0pIHsKICAgICAgICBxdWVyeVtpXSA9IGZhbHNlOwoKICAgICAgICB2YXIgcG9zID0gXy5pbmRleE9mKENoZWNrZWRBcnIsIGl0ZW1bY3VycmVudEtleV0pOwoKICAgICAgICBpZiAocG9zICE9IC0xKSB7CiAgICAgICAgICBpdGVtWydjaGVja2VkJ10gPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgdG1wLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0KICB9KTsKCiAgaWYgKHRtcC5sZW5ndGggPT09IDApIHsKICAgIHJldHVybjsKICB9CgogIHN1YiA9IHRtcDsKCiAgaWYgKHN1Yi5sZW5ndGggPiAwKSB7CiAgICAvLyBjb25zb2xlLmxvZygic3ViID09PT4gIiwgc3ViKQogICAgc3ViLm1hcChmdW5jdGlvbiAoY3VyLCBjKSB7CiAgICAgIHZhciByZXMgPSBidWlsZFRyZWVDaGVja2VkKHF1ZXJ5LCBjdXIsIGN1cnJlbnRLZXksIHBhcmVudHNLZXksIGNoaWxkLCAnMScsIENoZWNrZWRBcnIpOwoKICAgICAgaWYgKHJlcykgewogICAgICAgIHN1YltjXVtjaGlsZF0gPSByZXM7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcmV0dXJuIHN1YjsKfTsgLy8g6YCS5b2S6L+U5Zue5qCR5b2i57uT5p6E77yM6buY6K6k5Li7SUTlrZfmrrXlkI3kuLogY29kZe+8jOeItmlk5a2X5q615ZCN5Li6IHBhcmVudHPvvIwg5qC55o2u5pWw5o2u5Y+v6Ieq5a6a5LmJCgpleHBvcnQgdmFyIGdldFRyZWVOb2Rlc1ZhbHVlID0gZnVuY3Rpb24gZ2V0VHJlZU5vZGVzVmFsdWUocXVlcnlBcnIpIHsKICB2YXIgY3VycmVudEtleSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogJ2NvZGUnOwogIHZhciBjaGlsZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogJ2NoaWxkcmVuJzsKICB2YXIga2V5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiAnJzsKICB2YXIgdG1wID0gW107CiAgdmFyIHF1ZXJ5ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShxdWVyeUFycikpOwogIHF1ZXJ5Lm1hcChmdW5jdGlvbiAoaXRlbSwgaSkgewogICAgaWYgKGl0ZW1bY3VycmVudEtleV0gIT0gdW5kZWZpbmVkICYmIGl0ZW0pIHsKICAgICAgdG1wLnB1c2goa2V5ID09ICcnID8gaXRlbVtjdXJyZW50S2V5XSA6IGtleSArICctJyArIGl0ZW1bY3VycmVudEtleV0pOwogICAgfQoKICAgIGlmIChpdGVtW2NoaWxkXSAhPSB1bmRlZmluZWQgJiYgaXRlbVtjaGlsZF0ubGVuZ3RoID4gMCkgewogICAgICB2YXIgcmVzID0gZ2V0VHJlZU5vZGVzVmFsdWUoaXRlbVtjaGlsZF0sIGN1cnJlbnRLZXksIGNoaWxkLCBrZXkgPT0gJycgPyBpdGVtW2N1cnJlbnRLZXldIDoga2V5ICsgJy0nICsgaXRlbVtjdXJyZW50S2V5XSk7CgogICAgICBpZiAocmVzLmxlbmd0aCA+IDApIHsKICAgICAgICB0bXAucHVzaC5hcHBseSh0bXAsIF90b0NvbnN1bWFibGVBcnJheShyZXMpKTsKICAgICAgfQogICAgfQogIH0pOwogIHJldHVybiB0bXA7Cn07IC8vIOmAkuW9kui/lOWbnuagkeW9oue7k+aehO+8jOm7mOiupOS4u0lE5a2X5q615ZCN5Li6IGNvZGXvvIzniLZpZOWtl+auteWQjeS4uiBwYXJlbnRz77yMIOagueaNruaVsOaNruWPr+iHquWumuS5iQoKZXhwb3J0IHZhciBnZXRUcmVlTm9kZXMgPSBmdW5jdGlvbiBnZXRUcmVlTm9kZXMocXVlcnlBcnIpIHsKICB2YXIgY3VycmVudEtleSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogJ2NvZGUnOwogIHZhciBjaGlsZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogJ2NoaWxkcmVuJzsKICB2YXIgdG1wID0gW107CiAgdmFyIHF1ZXJ5ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShxdWVyeUFycikpOwogIHF1ZXJ5Lm1hcChmdW5jdGlvbiAoaXRlbSwgaSkgewogICAgaWYgKGl0ZW1bY3VycmVudEtleV0gIT0gdW5kZWZpbmVkICYmIGl0ZW0pIHsKICAgICAgdG1wLnB1c2goaXRlbVtjdXJyZW50S2V5XSk7CiAgICB9CgogICAgaWYgKGl0ZW1bY2hpbGRdICE9IHVuZGVmaW5lZCAmJiBpdGVtW2NoaWxkXS5sZW5ndGggPiAwKSB7CiAgICAgIHZhciByZXMgPSBnZXRUcmVlTm9kZXMoaXRlbVtjaGlsZF0sIGN1cnJlbnRLZXksIGNoaWxkKTsKCiAgICAgIGlmIChyZXMubGVuZ3RoID4gMCkgewogICAgICAgIHRtcC5wdXNoLmFwcGx5KHRtcCwgX3RvQ29uc3VtYWJsZUFycmF5KHJlcykpOwogICAgICB9CiAgICB9CiAgfSk7CiAgcmV0dXJuIHRtcDsKfTsgLy8g6YCS5b2S6L+U5Zue5qCR5b2i57uT5p6E5Lit5p+Q5LiA5Liq5YWz6ZSu5a2X5a+55bqU55qE6IqC54K55pWw5o2u77yM5qC55o2u5pWw5o2u5Y+v6Ieq5a6a5LmJCgpleHBvcnQgdmFyIGdldFRyZWVOb2RlSXRlbSA9IGZ1bmN0aW9uIGdldFRyZWVOb2RlSXRlbShxdWVyeUFycikgewogIHZhciBjdXJyZW50S2V5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAnY29kZSc7CiAgdmFyIGNoaWxkID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAnY2hpbGRyZW4nOwogIHZhciBrZXkgPSBhcmd1bWVudHMubGVuZ3RoID4gMyA/IGFyZ3VtZW50c1szXSA6IHVuZGVmaW5lZDsKICB2YXIgdG1wID0gW107CiAgcXVlcnlBcnIubWFwKGZ1bmN0aW9uIChpdGVtLCBpKSB7CiAgICBpZiAoaXRlbVtjdXJyZW50S2V5XSAhPSB1bmRlZmluZWQgJiYgaXRlbSkgewogICAgICBpZiAoaXRlbVtjdXJyZW50S2V5XSA9PSBrZXkpIHsKICAgICAgICB0bXAucHVzaChpdGVtKTsKICAgICAgfQogICAgfQoKICAgIGlmIChpdGVtW2NoaWxkXSAhPSB1bmRlZmluZWQgJiYgaXRlbVtjaGlsZF0ubGVuZ3RoID4gMCkgewogICAgICB2YXIgcmVzID0gZ2V0VHJlZU5vZGVJdGVtKGl0ZW1bY2hpbGRdLCBjdXJyZW50S2V5LCBjaGlsZCwga2V5KTsKCiAgICAgIGlmIChyZXMubGVuZ3RoID4gMCkgewogICAgICAgIHRtcC5wdXNoLmFwcGx5KHRtcCwgX3RvQ29uc3VtYWJsZUFycmF5KHJlcykpOwogICAgICB9CiAgICB9CiAgfSk7CiAgcmV0dXJuIHRtcDsKfTsgLy8g6YCS5b2S6L+U5Zue5qCR5b2i57uT5p6E5Lit5p+Q5LiA5Liq5YWz6ZSu5a2X5a+55bqU55qE6IqC54K55pWw5o2u77yM5qC55o2u5pWw5o2u5Y+v6Ieq5a6a5LmJCgpleHBvcnQgdmFyIGdldFRyZWVOb2RlSXRlbU5hbWUgPSBmdW5jdGlvbiBnZXRUcmVlTm9kZUl0ZW1OYW1lKHF1ZXJ5QXJyKSB7CiAgdmFyIGN1cnJlbnRLZXkgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6ICdjb2RlJzsKICB2YXIgY2hpbGQgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6ICdjaGlsZHJlbic7CiAgdmFyIGtleXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMyA/IGFyZ3VtZW50c1szXSA6IHVuZGVmaW5lZDsKICB2YXIgY3VycmVudE5hbWUgPSBhcmd1bWVudHMubGVuZ3RoID4gNCA/IGFyZ3VtZW50c1s0XSA6IHVuZGVmaW5lZDsKICB2YXIgdG1wID0gW107CiAgcXVlcnlBcnIubWFwKGZ1bmN0aW9uIChpdGVtLCBpKSB7CiAgICBpZiAoaXRlbVtjdXJyZW50S2V5XSAhPSB1bmRlZmluZWQgJiYgaXRlbSkgewogICAgICBfLmZpbmQoa2V5cywgZnVuY3Rpb24gKGtleSkgewogICAgICAgIGlmIChpdGVtW2N1cnJlbnRLZXldID09IGtleSkgewogICAgICAgICAgdG1wLnB1c2goewogICAgICAgICAgICBpZDogaXRlbVtjdXJyZW50S2V5XSwKICAgICAgICAgICAgbmFtZTogaXRlbVtjdXJyZW50TmFtZV0sCiAgICAgICAgICAgIGxldmVsOiBpdGVtLmxldmVsCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIGlmIChpdGVtW2NoaWxkXSAhPSB1bmRlZmluZWQgJiYgaXRlbVtjaGlsZF0ubGVuZ3RoID4gMCkgewogICAgICB2YXIgcmVzID0gZ2V0VHJlZU5vZGVJdGVtTmFtZShpdGVtW2NoaWxkXSwgY3VycmVudEtleSwgY2hpbGQsIGtleXMsIGN1cnJlbnROYW1lKTsKCiAgICAgIGlmIChyZXMubGVuZ3RoID4gMCkgewogICAgICAgIHRtcC5wdXNoLmFwcGx5KHRtcCwgX3RvQ29uc3VtYWJsZUFycmF5KHJlcykpOwogICAgICB9CiAgICB9CiAgfSk7CiAgcmV0dXJuIHRtcDsKfTsgLy8g5a+85Ye66aG16Z2i5Li6UERG5qC85byPCgpleHBvcnQgdmFyIEV4cG9ydFNhdmVQZGYgPSBmdW5jdGlvbiBFeHBvcnRTYXZlUGRmKGVsZW1lbnQsIHBkZk5hbWUsIGN1cnJlbnRUaW1lKSB7CiAgdmFyIGRpcmVjdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogJ3AnOwogIC8vIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInN0YXRQcmludCIpCiAgaHRtbDJjYW52YXMoZWxlbWVudCwgewogICAgZHBpOiAzMDAsCiAgICB1c2VDT1JTOiB0cnVlLAogICAgLy8g5aaC5p6c6K+05omA55Sf5oiQ55qE6aG16Z2i5Lit5bim5pyJ6Leo5Z+f55qE5Zu+54mH77yM6L+Z5LiqdXNlQ29yc+mcgOimgeiuvue9ruS4ulRydWUg5ZCm5YiZ55S75biD6KKr5rGh5p+T5LiN5Lya5pi+56S6CiAgICBsb2dnaW5nOiBmYWxzZQogIH0pLnRoZW4oZnVuY3Rpb24gKGNhbnZhcykgewogICAgLy8gbGV0IFtpbWdYLCBpbWdZXSA9IFs1OTUuMjgsIDg0MS44OV07CiAgICAvLyBsZXQgcGRmID0gbmV3IGpzUERGKCdwJywgJ3B0JywgJ2E0Jyk7CiAgICAvLyBmb3IgKGxldCBbaW5kZXgsIGl0ZW1dIG9mIHBhZ2VMaXN0LmVudHJpZXMoKSkgewogICAgLy8gICBmb3IgKGxldCBqID0gMDsgaiA8IGl0ZW0uaW1hZ2VMaXN0Lmxlbmd0aDsgaisrKSB7CiAgICAvLyAgICAgY29uc3QgaW1hZ2UgPSBpdGVtLmltYWdlTGlzdFtqXTsKICAgIC8vICAgICBsZXQgaW1nSGVpZ2h0ID0gaW1nWCAvIChpbWFnZS53aWR0aCAvIGltYWdlLmhlaWdodCk7IC8v5qC55o2u5a695bqm6K6h566X6auY5bqmCiAgICAvLyAgICAgcGRmLmFkZEltYWdlKGltYWdlLmRhdGEsICdKUEVHJywgMCwgMCwgaW1nWCwgaW1nSGVpZ2h0KTsKICAgIC8vICAgICBwZGYuYWRkUGFnZSgpOwogICAgLy8gICB9CiAgICAvLyB9CiAgICAvLyBsZXQgdGFyZ2V0UGFnZSA9IHBkZi5pbnRlcm5hbC5nZXROdW1iZXJPZlBhZ2VzKCk7CiAgICAvLyBwZGYuZGVsZXRlUGFnZSh0YXJnZXRQYWdlKTsgLy8g5Yig6Zmk5pyA5ZCO5LiA6aG1CiAgICAvLyBwZGYuc2F2ZShg5rWL6K+VLnBkZmApOwogICAgLy8gbGV0IHBkZiA9IG5ldyBqc1BERigncCcsICdwdCcsIFtwZGZYLCBwZGZZXSk7CiAgICAvLyDnrKzkuIDkuKrlj4LmlbDvvJogbO+8muaoquWQkSAgcO+8mue6teWQkQogICAgLy8g56ys5LqM5Liq5Y+C5pWw77ya5rWL6YeP5Y2V5L2N77yIInB0Iu+8jCJtbSIsICJjbSIsICJtIiwgImluIiBvciAicHgi77yJCiAgICAvLyDnrKzkuInkuKrlj4LmlbDvvJrlj6/ku6XmmK/kuIvpnaLmoLzlvI/vvIzpu5jorqTkuLrigJxhNOKAnQogICAgdmFyIHBkZiA9IG5ldyBKU1BERihkaXJlY3Rpb24sICJtbSIsICJhNCIpOyAvLyBBNOe6uO+8jOaoquWQkQoKICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgIHZhciBhNHcgPSAxOTA7CiAgICB2YXIgYTRoID0gMjc3OyAvLyBBNOWkp+Wwj++8jDIxMG1tIHggMjk3bW3vvIzlm5vovrnlkITkv53nlZkxMG1t55qE6L656Led77yM5pi+56S65Yy65Z+fMTkweDI3NwoKICAgIGlmIChkaXJlY3Rpb24gPT0gJ2wnKSB7CiAgICAgIGE0dyA9IDI3NzsKICAgICAgYTRoID0gMTkwOwogICAgfQoKICAgIHZhciBpbWdIZWlnaHQgPSBNYXRoLmZsb29yKGE0aCAqIGNhbnZhcy53aWR0aCAvIGE0dyk7IC8vIOaMiUE05pi+56S65q+U5L6L5o2i566X5LiA6aG15Zu+5YOP55qE5YOP57Sg6auY5bqmCgogICAgdmFyIHJlbmRlcmVkSGVpZ2h0ID0gMDsKCiAgICB3aGlsZSAocmVuZGVyZWRIZWlnaHQgPCBjYW52YXMuaGVpZ2h0KSB7CiAgICAgIHZhciBwYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgICAgIHBhZ2Uud2lkdGggPSBjYW52YXMud2lkdGg7CiAgICAgIHBhZ2UuaGVpZ2h0ID0gTWF0aC5taW4oaW1nSGVpZ2h0LCBjYW52YXMuaGVpZ2h0IC0gcmVuZGVyZWRIZWlnaHQpOyAvLyDlj6/og73lhoXlrrnkuI3otrPkuIDpobUKICAgICAgLy8g55SoZ2V0SW1hZ2VEYXRh5Ymq6KOB5oyH5a6a5Yy65Z+f77yM5bm255S75Yiw5YmN6Z2i5Yib5bu655qEY2FudmFz5a+56LGh5LitCgogICAgICBwYWdlLmdldENvbnRleHQoIjJkIikucHV0SW1hZ2VEYXRhKGN0eC5nZXRJbWFnZURhdGEoMCwgcmVuZGVyZWRIZWlnaHQsIGNhbnZhcy53aWR0aCwgTWF0aC5taW4oaW1nSGVpZ2h0LCBjYW52YXMuaGVpZ2h0IC0gcmVuZGVyZWRIZWlnaHQpKSwgMCwgMCk7CiAgICAgIHBkZi5hZGRJbWFnZShwYWdlLnRvRGF0YVVSTCgiaW1hZ2UvanBlZyIsIDEuMCksICJKUEVHIiwgMTAsIDEwLCBhNHcsIE1hdGgubWluKGE0aCwgYTR3ICogcGFnZS5oZWlnaHQgLyBwYWdlLndpZHRoKSk7IC8vIOa3u+WKoOWbvuWDj+WIsOmhtemdou+8jOS/neeVmTEwbW3ovrnot50KCiAgICAgIHJlbmRlcmVkSGVpZ2h0ICs9IGltZ0hlaWdodDsKCiAgICAgIGlmIChyZW5kZXJlZEhlaWdodCA8IGNhbnZhcy5oZWlnaHQpIHsKICAgICAgICBwZGYuYWRkUGFnZSgpOwogICAgICB9IC8vIOWmguaenOWQjumdoui/mOacieWGheWuue+8jOa3u+WKoOS4gOS4quepuumhtQogICAgICAvLyBkZWxldGUgcGFnZTsKCiAgICB9CgogICAgcGRmLnNhdmUocGRmTmFtZSArIGN1cnJlbnRUaW1lKTsKICB9KTsKfTsKZXhwb3J0IHZhciBwcmV2aWV3SW1nID0gZnVuY3Rpb24gcHJldmlld0ltZyhlbGUpIHsKICB3aW5kb3cuc2Nyb2xsVG8oMCwgMCk7CiAgdmFyIGVsZVcgPSBlbGUub2Zmc2V0V2lkdGg7IC8vIOiOt+W+l+ivpeWuueWZqOeahOWuvQoKICB2YXIgZWxlSCA9IGVsZS5vZmZzZXRIZWlnaHQ7IC8vIOiOt+W+l+ivpeWuueWZqOeahOmrmAoKICB2YXIgZWxlT2Zmc2V0VG9wID0gZWxlLm9mZnNldFRvcDsgLy8g6I635b6X6K+l5a655Zmo5Yiw5paH5qGj6aG26YOo55qE6Led56a7CgogIHZhciBlbGVPZmZzZXRMZWZ0ID0gZWxlLm9mZnNldExlZnQ7IC8vIOiOt+W+l+ivpeWuueWZqOWIsOaWh+aho+acgOW3pueahOi3neemuwoKICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgdmFyIGFicyA9IDA7CiAgdmFyIHdpbl9pbiA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCB8fCBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoOyAvLyDojrflvpflvZPliY3lj6/op4bnqpflj6PnmoTlrr3luqbvvIjkuI3ljIXlkKvmu5rliqjmnaHvvIkKCiAgdmFyIHdpbl9vdXQgPSB3aW5kb3cuaW5uZXJXaWR0aDsgLy8g6I635b6X5b2T5YmN56qX5Y+j55qE5a695bqm77yI5YyF5ZCr5rua5Yqo5p2h77yJCgogIGlmICh3aW5fb3V0ID4gd2luX2luKSB7CiAgICBhYnMgPSAod2luX291dCAtIHdpbl9pbikgLyAyOyAvLyDojrflvpfmu5rliqjmnaHlrr3luqbnmoTkuIDljYoKICB9CgogIGNhbnZhcy53aWR0aCA9IGVsZVcgKiAyOwogIGNhbnZhcy5oZWlnaHQgPSBlbGVIICogMjsKICB2YXIgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogIGNvbnRleHQuc2NhbGUoMiwgMik7CiAgY29udGV4dC50cmFuc2xhdGUoLWVsZU9mZnNldExlZnQgLSBhYnMsIC1lbGVPZmZzZXRUb3ApOwogIHZhciBiYXNlU3JjID0gJyc7CiAgaHRtbDJjYW52YXMoZWxlLCB7CiAgICBkcGk6IDMwMCwKICAgIHNjYWxlOiAyLAogICAgLy/lpITnkIblm77niYfmqKHns4oKICAgIHVzZUNPUlM6IHRydWUgLy/lhYHorrhjYW52YXPnlLvluIPlhoUg5Y+v5Lul6Leo5Z+f6K+35rGC5aSW6YOo6ZO+5o6l5Zu+54mHLCDlhYHorrjot6jln5/or7fmsYLjgIIKCiAgfSkudGhlbihmdW5jdGlvbiAoY2FudmFzKSB7CiAgICB2YXIgcGFnZURhdGEgPSBjYW52YXMudG9EYXRhVVJMKCdpbWFnZS9qcGVnJywgMS4wKTsKICAgIGJhc2VTcmMgPSBwYWdlRGF0YTsKICB9KTsKICByZXR1cm4gYmFzZVNyYzsKfTsgLy8g6YeR6aKd5qC85byP5YyWCgpleHBvcnQgdmFyIG51bWJlckZvcm1hdCA9IGZ1bmN0aW9uIG51bWJlckZvcm1hdChudW1iZXIpIHsKICB2YXIgZGVjaW1hbHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IDI7CiAgdmFyIGRlY1BvaW50ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAnLic7CiAgdmFyIHRob3VzYW5kc1NlcCA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogJywnOwogIHZhciByb3VuZHRhZyA9IGFyZ3VtZW50cy5sZW5ndGggPiA0ICYmIGFyZ3VtZW50c1s0XSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzRdIDogJ3JvdW5kJzsKCiAgLyoKICAgKiDlj4LmlbDor7TmmI7vvJoKICAgKiBudW1iZXLvvJropoHmoLzlvI/ljJbnmoTmlbDlrZcKICAgKiBkZWNpbWFsc++8muS/neeVmeWHoOS9jeWwj+aVsAogICAqIGRlY19wb2ludO+8muWwj+aVsOeCueespuWPtwogICAqIHRob3VzYW5kc19zZXDvvJrljYPliIbkvY3nrKblj7cKICAgKiByb3VuZHRhZzroiI3lhaXlj4LmlbDvvIzpu5jorqQgJ2NlaWwnIOWQkeS4iuWPliwnZmxvb3In5ZCR5LiL5Y+WLCdyb3VuZCcg5Zub6IiN5LqU5YWlCiAgICogKi8KICBudW1iZXIgPSAobnVtYmVyICsgJycpLnJlcGxhY2UoL1teMC05Ky1FZS5dL2csICcnKTsKICByb3VuZHRhZyA9IHJvdW5kdGFnIHx8ICdjZWlsJzsgLy8gJ2NlaWwnLCdmbG9vcicsJ3JvdW5kJwoKICB2YXIgbiA9ICFpc0Zpbml0ZSgrbnVtYmVyKSA/IDAgOiArbnVtYmVyOwogIHZhciBwcmVjID0gIWlzRmluaXRlKCtkZWNpbWFscykgPyAwIDogTWF0aC5hYnMoZGVjaW1hbHMpOwogIHZhciBzZXAgPSB0eXBlb2YgdGhvdXNhbmRzU2VwID09PSAndW5kZWZpbmVkJyA/ICcsJyA6IHRob3VzYW5kc1NlcDsKICB2YXIgZGVjID0gdHlwZW9mIGRlY1BvaW50ID09PSAndW5kZWZpbmVkJyA/ICcuJyA6IGRlY1BvaW50OwogIHZhciBzID0gJyc7CgogIHZhciB0b0ZpeGVkRml4ID0gZnVuY3Rpb24gdG9GaXhlZEZpeChuLCBwcmVjKSB7CiAgICB2YXIgayA9IE1hdGgucG93KDEwLCBwcmVjKTsKICAgIGNvbnNvbGUubG9nKCk7CiAgICByZXR1cm4gJycgKyBwYXJzZUZsb2F0KE1hdGhbcm91bmR0YWddKHBhcnNlRmxvYXQoKG4gKiBrKS50b0ZpeGVkKHByZWMgKiAyKSkpLnRvRml4ZWQocHJlYyAqIDIpKSAvIGs7CiAgfTsKCiAgcyA9IChwcmVjID8gdG9GaXhlZEZpeChuLCBwcmVjKSA6ICcnICsgTWF0aC5yb3VuZChuKSkuc3BsaXQoJy4nKTsKICB2YXIgcmUgPSAvKC0/XGQrKShcZHszfSkvOwoKICB3aGlsZSAocmUudGVzdChzWzBdKSkgewogICAgc1swXSA9IHNbMF0ucmVwbGFjZShyZSwgJyQxJyArIHNlcCArICckMicpOwogIH0KCiAgaWYgKChzWzFdIHx8ICcnKS5sZW5ndGggPCBwcmVjKSB7CiAgICBzWzFdID0gc1sxXSB8fCAnJzsKICAgIHNbMV0gKz0gbmV3IEFycmF5KHByZWMgLSBzWzFdLmxlbmd0aCArIDEpLmpvaW4oJzAnKTsKICB9CgogIHJldHVybiBzLmpvaW4oZGVjKTsKfTsKLyoqCiAqIOiOt+WPliBibG9iCiAqIEBwYXJhbSAge1N0cmluZ30gdXJsIOebruagh+aWh+S7tuWcsOWdgAogKiBAcmV0dXJuIHtjYn0KICovCgpmdW5jdGlvbiBnZXRCbG9iKHVybCwgY2IpIHsKICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgeGhyLm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7CiAgeGhyLnJlc3BvbnNlVHlwZSA9ICdibG9iJzsKCiAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh4aHIuc3RhdHVzID09PSAyMDApIHsKICAgICAgY2IoeGhyLnJlc3BvbnNlKTsKICAgIH0KICB9OwoKICB4aHIuc2VuZCgpOwp9Ci8qKgogKiDkv53lrZgKICogQHBhcmFtICB7QmxvYn0gYmxvYgogKiBAcGFyYW0gIHtTdHJpbmd9IGZpbGVuYW1lIOaDs+imgeS/neWtmOeahOaWh+S7tuWQjeensAogKi8KCgpmdW5jdGlvbiBzYXZlQXMoYmxvYiwgZmlsZW5hbWUpIHsKICBpZiAod2luZG93Lm5hdmlnYXRvci5tc1NhdmVPck9wZW5CbG9iKSB7CiAgICBuYXZpZ2F0b3IubXNTYXZlQmxvYihibG9iLCBmaWxlbmFtZSk7CiAgfSBlbHNlIHsKICAgIHZhciBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgdmFyIGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7CiAgICBsaW5rLmhyZWYgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgIGxpbmsuZG93bmxvYWQgPSBmaWxlbmFtZTsgLy8gZml4IEZpcmVmb3gKCiAgICBsaW5rLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBib2R5LmFwcGVuZENoaWxkKGxpbmspOwogICAgbGluay5jbGljaygpOwogICAgYm9keS5yZW1vdmVDaGlsZChsaW5rKTsKICAgIHdpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKGxpbmsuaHJlZik7CiAgfQoKICA7Cn0KLyoqCiAqIOS4i+i9vQogKiBAcGFyYW0gIHtTdHJpbmd9IHVybCDnm67moIfmlofku7blnLDlnYAKICogQHBhcmFtICB7U3RyaW5nfSBmaWxlbmFtZSDmg7PopoHkv53lrZjnmoTmlofku7blkI3np7AKICovCgoKZXhwb3J0IGZ1bmN0aW9uIGRvd25sb2FkRmlsZSh1cmwsIGZpbGVuYW1lKSB7CiAgZ2V0QmxvYih1cmwsIGZ1bmN0aW9uIChibG9iKSB7CiAgICBzYXZlQXMoYmxvYiwgZmlsZW5hbWUpOwogIH0pOwp9Cjs="},null]}